{"version":3,"sources":["assets/sample_page.png","assets/download.png","components/About.js","components/ClonalTree.js","components/Migration.js","utils/DefaultDict.js","components/SummaryGraph.js","components/SummaryPanel.js","components/HelpPopup.js","components/NoSolutionsPopup.js","components/Viz.js","components/Home.js","App.js","reportWebVitals.js","index.js"],"names":["module","exports","__webpack_require__","p","About","React","createElement","className","Link","to","style","textDecoration","color","columns","href","src","sample_page","alt","id","findCorresponding","clonalMap","currNode","clonal","corrNodes","forEach","row","push","getSubtree","tree","nodes","edges","edge","includes","Cytoscape","use","COSEBilkent","dagre","ClonalTree","props","console","log","hexColorRegex","colorPalette","ncolors","length","getColor","label","colorValue","coloring","find","value","undefined","test","parseInt","onlyUnique","index","array","indexOf","findLabel","node","labelPair","labeling","map","filter","_","flat","data","type","source","target","concat","migration","_useState","useState","_useState2","_slicedToArray","graphData","setGraphData","useEffect","myCyRef","styleSheet","selector","backgroundColor","width","height","overlay-padding","z-index","text-outline-width","fontSize","border-width","border-color","border-opacity","background-color","text-outline-color","line-color","target-arrow-color","target-arrow-shape","curve-style","line-fill","line-gradient-stop-colors","line-gradient-stop-positions","layout","name","fit","directed","padding","animate","animationDuration","avoidOverlap","nodeDimensionsIncludeLabels","ready","evtbus","addListener","eventName","eventData","getElementById","nodeId","$","css","trigger","eventParams","useMemo","CytoscapeComponent","elements","normalizeElements","zoomingEnabled","maxZoom","minZoom","autounselectify","boxSelectionEnabled","stylesheet","cy","on","event","div","document","setAttribute","innerHTML","nodePos","position","container","zoomLevel","zoom","containerRect","getBoundingClientRect","absoluteX","left","x","pan","absoluteY","top","y","body","appendChild","labeltag","querySelector","opacity","zIndex","fontWeight","fireEvent","contains","removeChild","sink","Migration","_ref","rightcol","rotated","found","_step","clsource","cltarget","_iterator","_createForOfIteratorHelper","entries","s","n","done","_ref2","_ref3","i","err","e","f","_step2","_iterator2","_ref4","_ref5","shape","text-valign","text-halign","queryParameters","URLSearchParams","window","location","hash","split","is_rotated","get","circle","transform","mu","gamma","sessionStorage","setItem","DefaultDict","defaultVal","_classCallCheck","this","Proxy","SummaryGraph","coloringDict","title","onDeleteSummaryEdge","onRequireSummaryEdge","roots","requiredEdges","addEventListener","key","classList","add","remove","filterOut","filterJson","JSON","parse","getItem","_toConsumableArray","Set","_i","_filterOut","Object","keys","root","rootedge","arrow-scale","edge-distances","line-style","search","object","font-weight","arrowScale","off","evt","action","originalEvent","shiftKey","onEdgeTapped","selected","SummaryPanel","setType","insertParam","usedData","evtBus","muSum","clearData","deletedEdges","deletedRoots","requiredRoots","setDeletedEdges","setRequiredEdges","setDeletedRoots","setRequiredRoots","filterStack","setFilterStack","tooltip","setTooltip","findColor","dict","summaryGraph","onClick","_recent$split","pop","_recent$split2","item","elem","onMouseEnter","onMouseLeave","Fragment","stack","_edge$split","_edge$split2","sourceColor","targetColor","sourceStyle","display","borderRadius","targetStyle","generateTag","HelpPopup","isPopupOpen","togglePopup","Popup","open","overlayStyle","background","animationType","modal","close","NoSolutionsPopup","onClose","findRoot","edgeList","indegreeMap","Map","dest","has","set","indegree","Error","fetchRootLocation","_step3","_iterator3","entry","fetchRoots","solutions","arr","frequencyDict","constructFrequencyDictionary","soln","_step4","_iterator4","urlParams","toString","Viz","setMu","_useState3","_useState4","setGamma","_useState5","_useState6","mu2","setMu2","_useState7","_useState8","gamma2","setGamma2","_useState9","_useState10","setMuSum","_useState11","_useState12","gammaSum","setGammaSum","jsonContents","_useState13","_useState14","_useState15","_useState16","_useState17","_useState18","refreshCounter","setRefreshCounter","_useState19","_useState20","clonalL","setClonalL","_useState21","_useState22","clonalR","setClonalR","_useState23","_useState24","setRoots","_useState25","_useState26","_useState27","_useState28","_useState29","_useState30","updateUsedData","_useState31","_useState32","setUsedData","wholeData","tempUsedData","original","summary","treeEntry","labelingEntry","migrationEntry","rootLocation","foundDeletedEdge","foundRequiredRoot","foundDeletedRoot","requiredEdgeCounter","j","migrationEdgeString","k","tempSolution","stringify","edgeInSummary","tempSummaryElement","slice","last_edit","toggleNoSolutionsPopup","tempNames","setData","data2","setData2","_useState33","_useState34","labelNames","setLabelNames","labelName","labelName2","_useState35","_useState36","setLabeling","_useState37","_useState38","labeling2","setLabeling2","_useState39","_useState40","rotate","setRotate","_useState41","_useState42","rotate2","setRotate2","_useState43","_useState44","originalTree","originalLabeling","_useState45","_useState46","_useState47","_useState48","_useState49","_useState50","setTree","_useState51","_useState52","tree_labeling","setTreeLabeling","_useState53","_useState54","setMigration","_useState55","_useState56","tree2","setTree2","_useState57","_useState58","tree_labeling2","setTreeLabeling2","_useState59","_useState60","migration2","setMigration2","_useState61","_useState62","setClonalMap","_useState63","_useState64","clonalMap2","setClonalMap2","origExists","_unused","_useState65","_useState66","setColoring","formattedLabels","self","coord_map","closeTab","tabIndex","protocol","host","prevCounter","resetFn","resetClonal","handleKeyPress","_useState67","listeners","callback","removeListener","listener","_useState68","_useState69","_useState70","isHelpPopupOpen","setIsHelpPopupOpen","_useState71","_useState72","isNoSolutionsPopupOpen","setIsNoSolutionsPopupOpen","toggleHelpPopup","edge_id","_edge_id$split","_edge_id$split2","updatedEdges","_edge_id$split3","_edge_id$split4","htmlFor","onChange","l","bind","rotated2","Home","json_dict","A7","A10","A22","A29","A31","A32","patient1_LOv","patient1_ROv","patient2","patient3_LOv","patient3_ROv","patient4_LOv","patient4_ROv","patient7_LOv","patient7_ROv","patient9_LOv","patient9_ROv","patient10","tracerx","default_patients","default_dirs","div_elements","which_color","_loop","current_directory","current_color","link","URLs","current_patient","download","url","filename","axios","responseType","then","res","fileDownload","accept","json_contents","reader","FileReader","file","files","onload","readerEvt","jsonString","result","labelnames","readAsText","App","createBrowserHistory","basename","Switch","Route","path","exact","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","createRoot","render","StrictMode","Router"],"mappings":"6EAAAA,EAAAC,QAAiBC,EAAAC,EAAuB,2nBCAxCH,EAAAC,QAAA,wlkpNCmDeG,MAxCf,WACI,OACIC,IAAAC,cAAA,OAAKC,UAAU,SACXF,IAAAC,cAAA,OAAKC,UAAU,eACXF,IAAAC,cAAA,OAAKC,UAAU,kBACXF,IAAAC,cAAA,KAAGC,UAAU,aAAYF,IAAAC,cAAA,SAAGD,IAAAC,cAACE,IAAI,CAACC,GAAG,GAAGC,MAAO,CAAEC,eAAgB,OAAQC,MAAO,UAAU,iBAC1FP,IAAAC,cAAA,MAAIC,UAAU,cAAa,iBAE/BF,IAAAC,cAAA,SAAGD,IAAAC,cAAA,SAAG,SAAS,+KACfD,IAAAC,cAAA,SAAGD,IAAAC,cAAA,SAAG,+CAA+C,kLACrDD,IAAAC,cAAA,SAAGD,IAAAC,cAAA,SAAG,0BACND,IAAAC,cAAA,SAAG,kNACHD,IAAAC,cAAA,MAAII,MAAO,CAACG,QAAS,IACjBR,IAAAC,cAAA,UAAID,IAAAC,cAAA,SAAGD,IAAAC,cAAA,SAAG,4BAA4B,gMACtCD,IAAAC,cAAA,MAAII,MAAO,CAACG,QAAS,IACjBR,IAAAC,cAAA,UAAID,IAAAC,cAAA,SAAGD,IAAAC,cAAA,SAAG,+BAA+B,qKACzCD,IAAAC,cAAA,UAAID,IAAAC,cAAA,SAAGD,IAAAC,cAAA,SAAG,gCAAgC,sFAAmFD,IAAAC,cAAA,KAAGQ,KAAK,mEAAkE,qBAAqB,kMAEhOT,IAAAC,cAAA,UAAID,IAAAC,cAAA,SAAGD,IAAAC,cAAA,SAAG,mBAAmB,6LAEjCD,IAAAC,cAAA,SAAG,mGACHD,IAAAC,cAAA,OAAKC,UAAU,mBAGXF,IAAAC,cAAA,OAAKC,UAAU,WAAWQ,IAAKC,IAAaC,IAAI,iBAEpDZ,IAAAC,cAAA,SAAGD,IAAAC,cAAA,SAAG,uBAAuB,sBAAmBD,IAAAC,cAAA,KAAGQ,KAAK,gDAA+C,oBAAoB,sEAAmET,IAAAC,cAAA,SAAG,SAAS,kCAA+BD,IAAAC,cAAA,SAAG,aAAa,yBAAsBD,IAAAC,cAAA,SAAG,SAAS,gJAA6ID,IAAAC,cAAA,KAAGQ,KAAK,oEAAmE,UAAU,yIAC7fT,IAAAC,cAAA,SAAGD,IAAAC,cAAA,SAAG,uBACND,IAAAC,cAAA,MAAIY,GAAG,aACHb,IAAAC,cAAA,UAAID,IAAAC,cAAA,SAAG,sBAAmBD,IAAAC,cAAA,KAAGQ,KAAK,gCAA+B,yBAAyB,MAC1FT,IAAAC,cAAA,UAAID,IAAAC,cAAA,SAAG,kBAAeD,IAAAC,cAAA,KAAGQ,KAAK,gCAA+B,yBAAyB,MACtFT,IAAAC,cAAA,UAAID,IAAAC,cAAA,SAAG,eAAYD,IAAAC,cAAA,KAAGQ,KAAK,8BAA6B,uBAAuB,MAC/ET,IAAAC,cAAA,UAAID,IAAAC,cAAA,SAAG,mBAAgBD,IAAAC,cAAA,KAAGQ,KAAK,gCAA+B,yBAAyB,MACvFT,IAAAC,cAAA,UAAID,IAAAC,cAAA,SAAG,sBAAmBD,IAAAC,cAAA,KAAGQ,KAAK,gCAA+B,yBAAyB,mFCjC9G,SAASK,EAAkBC,EAAWC,EAAUC,GAC9C,GAAIA,EAAQ,CACV,IAAIC,EAAY,GAMhB,OALAH,EAAUI,QAAQ,SAACC,GACbA,EAAI,KAAOJ,GACbE,EAAUG,KAAKD,EAAI,MAGhBF,EAEPH,EAAUI,QAAQ,SAACC,GACjB,GAAIA,EAAI,KAAOJ,EACb,MAAO,CAACI,EAAI,MAMpB,SAASE,EAAWC,EAAMC,GACxB,IAAIC,EAAQ,GAQZ,OANAF,EAAKJ,QAAQ,SAACO,GACRF,EAAMG,SAASD,EAAK,KAAOF,EAAMG,SAASD,EAAK,KACjDD,EAAMJ,KAAKK,KAIRD,EA9BTG,IAAUC,IAAIC,KACdF,IAAUC,IAAIE,KA8eCC,MApcf,SAAoBC,GAClBC,QAAQC,IAAIF,EAAMlB,WAClB,IAIIqB,EAAgB,6BAOdC,EAAe,CACnB,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAEIC,EAAUD,EAAaE,OAS7B,SAASC,EAASC,GAMhB,IAAKA,EAAO,MAAO,OAEnB,IAAIC,EAAaT,EAAMU,SAASC,KAAK,SAAAC,GAAK,OAAIA,EAAM,KAAOJ,IAEvDlC,EAAQmC,EAAaA,EAAW,QAAKI,EAEzC,OAAOV,EAAcW,KAAKxC,GACtBA,EACA8B,EAAaW,SAASzC,GAAS+B,GAIrC,SAASW,EAAWJ,EAAOK,EAAOC,GAChC,OAAOA,EAAMC,QAAQP,KAAWK,EAQlC,SAASG,EAAUC,GAIjB,IAAIC,EAAYtB,EAAMuB,SAASZ,KAAK,SAAAC,GAAK,OAAIA,EAAM,KAAOS,IAE1D,OAAOC,EAAYA,EAAU,QAAKT,EAIpC,IAAItB,EAAQS,EAAMV,KAAKkC,IAAI,SAAAN,GAGzB,OAAOA,EAAMO,OAAO,SAACC,EAAGT,GAAK,OAAe,IAAVA,MACjCU,OAAOF,OAAOT,GAAYQ,IAAI,SAACZ,EAAOK,GACvC,MAAO,CAAEW,KAAM,CAAEhD,GAAIgC,EAAOJ,MAAOY,EAAUR,GAAQiB,KAAM,SAEzDrC,EAAQQ,EAAMV,KAAKkC,IAAI,SAACZ,EAAOK,GACjC,MAAO,CAAEW,KAAM,CAAEE,OAAQlB,EAAM,GAAImB,OAAQnB,EAAM,GAAIJ,MAAK,GAAAwB,OAAKpB,EAAM,GAAE,MAAAoB,OAAKpB,EAAM,IAAMqB,UAAS,GAAAD,OAAKZ,EAAUR,EAAM,IAAG,MAAAoB,OAAKZ,EAAUR,EAAM,SAGhJsB,EACkCC,mBAAS,CACzC5C,MAAOA,EACPC,MAAOA,IACP4C,EAAAC,YAAAH,EAAA,GAHKI,EAASF,EAAA,GAAEG,EAAYH,EAAA,GAM9BI,oBAAU,WAERjD,EAAQS,EAAMV,KAAKkC,IAAI,SAAAN,GACrB,OAAOA,EAAMO,OAAO,SAACC,EAAGT,GAAK,OAAe,IAAVA,MACjCU,OAAOF,OAAOT,GAAYQ,IAAI,SAACZ,EAAOK,GACvC,MAAO,CAAEW,KAAM,CAAEhD,GAAIgC,EAAOJ,MAAOY,EAAUR,GAAQiB,KAAM,SAG7DrC,EAAQQ,EAAMV,KAAKkC,IAAI,SAACZ,EAAOK,GAC7B,MAAO,CAAEW,KAAM,CAAEE,OAAQlB,EAAM,GAAImB,OAAQnB,EAAM,GAAIJ,MAAK,GAAAwB,OAAKpB,EAAM,GAAE,MAAAoB,OAAKpB,EAAM,IAAMqB,UAAS,GAAAD,OAAKZ,EAAUR,EAAM,IAAG,MAAAoB,OAAKZ,EAAUR,EAAM,SAIhJ2B,EAAa,CACXhD,MAAOA,EACPC,MAAOA,KAIR,CAACQ,EAAMV,KAAMU,EAAMuB,WAGtB,IAoEIkB,EApEAC,EAAa,CACf,CACEC,SAAU,OACVvE,MAAO,CACLwE,gBAAiB,UACjBC,MAAO,GACPC,OAAQ,GACRtC,MAAO,WACPuC,kBAAmB,MACnBC,UAAW,KACXC,qBAAsB,MACtB3E,MAAO,QACP4E,SAAU,KAGd,CACEP,SAAU,gBACVvE,MAAO,CACL+E,eAAgB,MAChBC,eAAgB,UAChBC,iBAAkB,MAClBC,mBAAoB,UACpBT,MAAO,GACPC,OAAQ,GAGRS,qBAAsB,UACtBN,qBAAsB,IAG1B,CACEN,SAAU,OACVvE,MAAO,CACLyE,MAAO,EACPW,aAAc,UACdC,qBAAsB,UACtBC,qBAAsB,WACtBC,cAAe,YAMrB3D,EAAMU,SAASxB,QAAQ,SAAC0B,EAAOK,GAC7ByB,EAAWtD,KAAK,CACduD,SAAQ,eAAAX,OAAiBpB,EAAM,GAAE,MACjCxC,MAAO,CACLwE,gBAAiBzC,EAAcW,KAAKF,EAAM,IAAMA,EAAM,GAAKR,EAAaW,SAASH,EAAM,IAAMP,QAMnGb,EAAMN,QAAQ,SAAC0B,EAAOK,GACpB,IAAIa,EAASlB,EAAMgB,KAAKE,OACpBC,EAASnB,EAAMgB,KAAKG,OACxBW,EAAWtD,KAAK,CACduD,SAAQ,eAAAX,OAAiBF,EAAM,MAAAE,OAAKD,EAAM,MAC1C3D,MAAO,CACLwF,YAAa,kBACbC,4BAA2B,GAAA7B,OAAKzB,EAASa,EAAUU,IAAQ,KAAAE,OAAIzB,EAASa,EAAUW,KAClF+B,+BAAgC,UAChCL,qBAAoB,GAAAzB,OAAKzB,EAASa,EAAUW,UAOlD,IAAMgC,EAAS,CACbC,KAAM,QACNC,KAAK,EAELC,UAAU,EACVC,QAAS,GAETC,SAAS,EACTC,kBAAmB,IACnBC,cAAc,EACdC,6BAA6B,EAC7BC,MAAO,WA0HLxE,EAAMyE,OAAOC,YAxHI,SAACC,EAAWC,GAG3B,GAAkB,iBAAdD,EAA8B,CAChC,IAAMtD,EAAOoB,EAAQoC,eAAeD,EAAUE,QAC9CrC,EAAQsC,EAAC,mBAAA/C,OAAoB4C,EAAUE,OAAM,OAAME,IAAI,CACrDnC,MAAO,KAETxB,EAAK4D,QAAQ,UAEf,GAAkB,mBAAdN,EAAgC,CAClC,IAAMtD,EAAOoB,EAAQoC,eAAeD,EAAUE,QAC9CrC,EAAQsC,EAAC,mBAAA/C,OAAoB4C,EAAUE,OAAM,OAAME,IAAI,CACrDnC,MAAO,IAETxB,EAAK4D,QAAQ,UAYf,GAVkB,gBAAdN,GACFlC,EAAQsC,EAAC,mBAAA/C,OAAoB4C,EAAUE,OAAM,MAAA9C,OAAK4C,EAAUE,OAAM,OAAME,IAAI,CAC1EnC,MAAO,KAGO,kBAAd8B,GACFlC,EAAQsC,EAAC,mBAAA/C,OAAoB4C,EAAUE,OAAM,MAAA9C,OAAK4C,EAAUE,OAAM,OAAME,IAAI,CAC1EnC,MAAO,IAGO,iBAAd8B,EAA8B,CAChC,IAAMtD,EAAOoB,EAAQoC,eAAeD,EAAUE,QAC1CtE,EAAQoE,EAAUpE,MAEtBiC,EAAQsC,EAAC,eAAA/C,OAAgBxB,EAAK,OAAMwE,IAAI,CACtCnC,MAAO,KAETxB,EAAK4D,QAAQ,UAEf,GAAkB,mBAAdN,EAAgC,CAClC,IAAMtD,EAAOoB,EAAQoC,eAAeD,EAAUE,QAC1CtE,EAAQoE,EAAUpE,MAEtBiC,EAAQsC,EAAC,eAAA/C,OAAgBxB,EAAK,OAAMwE,IAAI,CACtCnC,MAAO,IAETxB,EAAK4D,QAAQ,UAEf,GAAkB,gBAAdN,EAA6B,CAC/B,IAAMtD,EAAOoB,EAAQoC,eAAeD,EAAUE,QAC1ChD,EAAS8C,EAAUE,OAEvBrC,EAAQsC,EAAC,YAAA/C,OAAaF,EAAM,OAAMkD,IAAI,CACpCnC,MAAO,GACPC,OAAQ,KAEVzB,EAAK4D,QAAQ,UAEf,GAAkB,kBAAdN,EAA+B,CACjC,IAAMtD,EAAOoB,EAAQoC,eAAeD,EAAUE,QAC1ChD,EAAS8C,EAAUE,OAEvBrC,EAAQsC,EAAC,YAAA/C,OAAaF,EAAM,OAAMkD,IAAI,CACpCnC,MAAO,GACPC,OAAQ,KAEVzB,EAAK4D,QAAQ,UAWf,GATkB,gBAAdN,GACUC,EAAU3D,QACRjB,EAAMiB,OAClBsB,EAAa,CACXhD,MAAOA,EACPC,MAAOA,IAIK,gBAAdmF,EAA6B,CAC/B,IAAI1F,EAAY2F,EAAUM,YAC1BjF,QAAQC,IAAIF,EAAMiB,YAEAJ,IAAd5B,IACFA,EAAUC,QAAQ,SAAC4C,GACjB,IAAMT,EAAOoB,EAAQoC,eAAeD,EAAUE,QAC9CrC,EAAQsC,EAAC,YAAA/C,OAAaF,EAAM,OAAMkD,IAAI,CACpCnC,MAAO,GACPC,OAAQ,KAEVzB,EAAK4D,QAAQ,YAGD5F,EAAWW,EAAMV,KAAML,GAC7BC,QAAQ,SAACO,GACfgD,EAAQsC,EAAC,eAAA/C,OAAgBvC,EAAK,GAAE,MAAAuC,OAAKvC,EAAK,GAAE,OAAMuF,IAAI,CACpDnC,MAAO,QAMf,GAAkB,kBAAd8B,EAA+B,CACjC,IAAI1F,EAAY2F,EAAUM,YAC1BjF,QAAQC,IAAIF,EAAMiB,YAEAJ,IAAd5B,IACFA,EAAUC,QAAQ,SAAC4C,GACjB,IAAMT,EAAOoB,EAAQoC,eAAeD,EAAUE,QAC9CrC,EAAQsC,EAAC,YAAA/C,OAAaF,EAAM,OAAMkD,IAAI,CACpCnC,MAAO,GACPC,OAAQ,KAEVzB,EAAK4D,QAAQ,YAGD5F,EAAWW,EAAMV,KAAML,GAC7BC,QAAQ,SAACO,GACfgD,EAAQsC,EAAC,eAAA/C,OAAgBvC,EAAK,GAAE,MAAAuC,OAAKvC,EAAK,GAAE,OAAMuF,IAAI,CACpDnC,MAAO,YA4InB,OAjI6BsC,kBAAQ,kBAAQpH,IAAAC,cAACoH,IAAkB,CAChEC,SAAUD,IAAmBE,kBAAkBhD,GAC/ClE,MAAO,CAAEyE,MAhUG,OAgUWC,OA/TV,QAgUbyC,gBAAgB,EAChBC,QAAS,EACTC,QAAS,GACTC,iBAAiB,EACjBC,qBAAqB,EACrB5B,OAAQA,EACR6B,WAAYlD,EACZmD,GAAI,SAAAA,GACFpD,EAAUoD,EAGVA,EAAGC,GAAG,YAAa,OAAQ,SAASC,GAElC,IAAI1E,EAAO0E,EAAMhE,OACbvB,EAAQa,EAAKO,KAAK,SAGlBoE,EAAMC,SAASjI,cAAc,OACjCgI,EAAIE,aAAa,QAAS,eAE1BF,EAAIG,UAAS,MAAAnE,OAASxB,EAAK,cAG3B,IAAM4F,EAAU/E,EAAKgF,WAGfC,EAAYT,EAAGS,YACfC,EAAYV,EAAGW,OAIfC,EAAgBH,EAAUI,wBAGhCV,EAAI5H,MAAMiI,SAAW,WACrB,IAAMM,EAAYF,EAAcG,KAAOR,EAAQS,EAAIN,EAAYV,EAAGiB,MAAMD,EAAI,GACtEE,EAAYN,EAAcO,IAAMZ,EAAQa,EAAIV,EAAYV,EAAGiB,MAAMG,EAAI,GAE3EjB,EAAI5H,MAAM4I,IAAMD,EAAY,KAC5Bf,EAAI5H,MAAMwI,KAAOD,EAAY,KAG7BV,SAASiB,KAAKC,YAAYnB,GAE1B,IAAMlB,EAASiB,EAAMhE,OAAOnD,KAGxBwI,EAAWnB,SAASoB,cAAa,IAAArF,OAAKxB,IAU1C,GATiB,OAAb4G,IACFA,EAAShJ,MAAMkJ,QAAU,EACzBF,EAAShJ,MAAMmJ,OAAS,IACxBH,EAAShJ,MAAMoJ,WAAa,QAI9BxH,EAAMyE,OAAOgD,UAAU,cAAe,CAAE3C,WAEpC9E,EAAMlB,YAAc,GAAI,CAC1B,IAAIoG,EAAcrG,EAAkBmB,EAAMlB,UAAWgG,EAAQ9E,EAAMhB,QACnEgB,EAAMyE,OAAOgD,UAAU,cAAe,CAAEvC,mBAI5CW,EAAGC,GAAG,WAAY,OAAQ,SAASC,GAEjC,IAAIC,EAAMC,SAASoB,cAAc,gBAC7BpB,SAASiB,KAAKQ,SAAS1B,IACzBC,SAASiB,KAAKS,YAAY3B,GAG5B,IAAMlB,EAASiB,EAAMhE,OAAOnD,KAGxB4B,EADOuF,EAAMhE,OACAH,KAAK,SAElBwF,EAAWnB,SAASoB,cAAa,IAAArF,OAAKxB,IAU1C,GATiB,OAAb4G,IACFA,EAAShJ,MAAMkJ,QAAU,GACzBF,EAAShJ,MAAMmJ,OAAS,EACxBH,EAAShJ,MAAMoJ,WAAa,UAI9BxH,EAAMyE,OAAOgD,UAAU,gBAAiB,CAAE3C,WAEtC9E,EAAMlB,YAAc,GAAI,CAC1B,IAAIoG,EAAcrG,EAAkBmB,EAAMlB,UAAWgG,EAAQ9E,EAAMhB,QACnEgB,EAAMyE,OAAOgD,UAAU,gBAAiB,CAAEvC,mBAI9CW,EAAGC,GAAG,YAAa,OAAQ,SAASC,GAAO,IACjChE,EAAWgE,EAAXhE,OAGRA,EAAOiD,IAAI,CACTnC,MAAO,KAET,IAAMiC,EAASiB,EAAMhE,OAAOnD,KACxBkD,EAASV,EAAUW,EAAOH,OAAOE,QACjC8F,EAAOxG,EAAUW,EAAOH,OAAOG,QAC/BvB,EAAQuB,EAAOH,OAAOpB,MAG1BR,EAAMyE,OAAOgD,UAAU,aAAc,CAAE3C,SAAQhD,SAAQ8F,OAAM7F,WAC7D/B,EAAMyE,OAAOgD,UAAU,eAAgB,CAAE3C,SAAQhD,SAAQ8F,OAAM7F,SAAQvB,YAGzEqF,EAAGC,GAAG,WAAY,OAAQ,SAASC,GAAO,IAChChE,EAAWgE,EAAXhE,OAGRA,EAAOiD,IAAI,CACTnC,MAAO,IAET,IAAMiC,EAASiB,EAAMhE,OAAOnD,KACxBkD,EAASV,EAAUW,EAAOH,OAAOE,QACjC8F,EAAOxG,EAAUW,EAAOH,OAAOG,QAC/BvB,EAAQuB,EAAOH,OAAOpB,MAG1BR,EAAMyE,OAAOgD,UAAU,eAAgB,CAAE3C,SAAQhD,SAAQ8F,OAAM7F,WAC/D/B,EAAMyE,OAAOgD,UAAU,iBAAkB,CAAE3C,SAAQhD,SAAQ8F,OAAM7F,SAAQvB,gBAGxE,CAAC8B,4hCC5eV3C,IAAUC,IAAIE,KACdH,IAAUC,IAAIC,KAiYCgI,MApXf,SAAkBC,GAAqE,IAAlExI,EAAIwI,EAAJxI,KAAMiC,EAAQuG,EAARvG,SAAUb,EAAQoH,EAARpH,SAAUuB,EAAS6F,EAAT7F,UAAWwC,EAAMqD,EAANrD,OAAQsD,EAAQD,EAARC,SAAUC,EAAOF,EAAPE,QAClE7H,EAAgB,6BAEdC,EAAe,CACnB,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAEIC,EAAUD,EAAaE,OAK7B,SAASU,EAAWJ,EAAOK,EAAOC,GAChC,OAAOA,EAAMC,QAAQP,KAAWK,EAGlC,SAASG,EAAUC,GACjB,IAAM4G,EAAQ1G,EAASZ,KAAK,SAAAC,GAAK,OAAIA,EAAM,KAAOS,IAClD,OAAO4G,EAAQA,EAAM,QAAKpH,EAK5B,SAASN,EAASC,GAKhB,IAAIlC,EAAQoC,EAASC,KAAK,SAAAC,GAAK,OAAIA,EAAM,KAAOJ,IAMhD,OAJIlC,IACFA,EAAQA,EAAM,IAGT6B,EAAcW,KAAKxC,GAASA,EAAQ8B,EAAaW,SAASzC,GAAS+B,GAI5E,IASuC6H,EATnC3I,EAAQD,EAAKkC,IAAI,SAAAN,GAEnB,OAAOA,EAAMO,OAAO,SAACC,EAAGT,GAAK,OAAe,IAAVA,MACjCU,OAAOF,OAAOT,GAAYQ,IAAI,SAACZ,EAAOK,GACvC,MAAO,CAAEW,KAAM,CAAEhD,GAAKwC,EAAUR,GAAQJ,MAAOY,EAAUR,GAAQiB,KAAM,SAErErC,EAAQyC,EAAUT,IAAI,SAACZ,EAAOK,GAChC,MAAO,CAAEW,KAAM,CAAEE,OAAQlB,EAAM,GAAImB,OAAQnB,EAAM,GAAIJ,MAAOI,EAAM,GAAIhC,GAAE,GAAAoD,OAAKpB,EAAM,GAAE,MAAAoB,OAAKpB,EAAM,IAAMuH,SAAUvH,EAAM,GAAIwH,SAAUxH,EAAM,OAC1IyH,EAAAC,EACsB9I,EAAM+I,WAAS,IAAvC,IAAAF,EAAAG,MAAAN,EAAAG,EAAAI,KAAAC,MAAyC,KAAAC,EAAAT,EAAAtH,MAAAgI,EAAAvG,YAAAsG,EAAA,GAA7BE,EAACD,EAAA,GAEY,GAFNA,EAAA,GAERhH,KAAKpB,QACZhB,EAAMqJ,GAAGjH,KAAKpB,MAAQ,KAEzB,MAAAsI,GAAAT,EAAAU,EAAAD,GAAA,QAAAT,EAAAW,IAAA,IAOGvG,EAPHP,EAEiCC,mBAAS,CACzC5C,MAAOA,EACPC,MAAOA,IACP4C,EAAAC,YAAAH,EAAA,GAHKI,EAASF,EAAA,GAAEG,EAAYH,EAAA,GAQ9BI,oBAAU,WACR,IASuCyG,EATnC1J,EAAQD,EAAKkC,IAAI,SAAAN,GAEnB,OAAOA,EAAMO,OAAO,SAACC,EAAGT,GAAK,OAAe,IAAVA,MACjCU,OAAOF,OAAOT,GAAYQ,IAAI,SAACZ,EAAOK,GACvC,MAAO,CAAEW,KAAM,CAAEhD,GAAKwC,EAAUR,GAAQJ,MAAOY,EAAUR,GAAQiB,KAAM,SAErErC,EAAQyC,EAAUT,IAAI,SAACZ,EAAOK,GAChC,MAAO,CAAEW,KAAM,CAAEE,OAAQlB,EAAM,GAAImB,OAAQnB,EAAM,GAAIJ,MAAOI,EAAM,GAAIhC,GAAE,GAAAoD,OAAKpB,EAAM,GAAE,MAAAoB,OAAKpB,EAAM,IAAMuH,SAAUvH,EAAM,GAAIwH,SAAUxH,EAAM,OAC1IsI,EAAAZ,EACsB9I,EAAM+I,WAAS,IAAvC,IAAAW,EAAAV,MAAAS,EAAAC,EAAAT,KAAAC,MAAyC,KAAAS,EAAAF,EAAArI,MAAAwI,EAAA/G,YAAA8G,EAAA,GAA7BN,EAACO,EAAA,GAEY,GAFNA,EAAA,GAERxH,KAAKpB,QACZhB,EAAMqJ,GAAGjH,KAAKpB,MAAQ,KAEzB,MAAAsI,GAAAI,EAAAH,EAAAD,GAAA,QAAAI,EAAAF,IACDzG,EAAa,CACXhD,MAAOA,EACPC,MAAOA,KAER,CAACF,EAAMiC,EAAUU,EAAW+F,IAE/B,IAAItF,EAAa,CACf,CACEC,SAAU,OACVvE,MAAO,CACLwE,gBAAiB,OACjBO,eAAgB,GAChBkG,MAAO,YACPxG,MAAO,IACPC,OAAQ,GACRtC,MAAO,cAMPuC,kBAAmB,MACnBC,UAAW,KAGXC,qBAAsB,MACtB3E,MAAO,QACP4E,SAAU,GACVoG,cAAe,SACfC,cAAe,WAGnB,CACE5G,SAAU,gBACVvE,MAAO,CACL+E,eAAgB,MAChBC,eAAgB,UAChBC,iBAAkB,MAClBC,mBAAoB,UACpBT,MAAO,GACPC,OAAQ,GAERS,qBAAsB,UACtBN,qBAAsB,IAG1B,CACEN,SAAU,sBACVvE,MAAO,CACLiL,MAAO,cAGX,CACE1G,SAAU,OACVvE,MAAO,CACLyE,MAAO,EAEPrC,MAAO,cACPiD,qBAAsB,UACtBC,qBAAsB,WACtBC,cAAe,SACfV,qBAAsB,MACtB3E,MAAO,QACP4E,SAAU,MAKhBxC,EAASxB,QAAQ,SAAC0B,EAAOK,GACvByB,EAAWtD,KAAK,CACduD,SAAQ,eAAAX,OAAiBpB,EAAM,GAAE,MACjCxC,MAAO,CACLgF,eAAgBjD,EAAcW,KAAKF,EAAM,IAAMA,EAAM,GAAKR,EAAaW,SAASH,EAAM,IAAMP,QAKlGb,EAAMN,QAAQ,SAAC0B,EAAOK,GACpB,IAAIa,EAASlB,EAAMgB,KAAKE,OACpBC,EAASnB,EAAMgB,KAAKG,OACxBW,EAAWtD,KAAK,CACduD,SAAQ,YAAAX,OAAcF,EAAM,MAAAE,OAAKD,EAAM,MACvC3D,MAAO,CACLwF,YAAa,kBACbC,4BAA2B,GAAA7B,OAAKzB,EAASuB,GAAO,KAAAE,OAAIzB,EAASwB,IAC7D+B,+BAAgC,UAChCL,qBAAoB,GAAAzB,OAAKzB,EAASwB,SAMxC,IAAMyH,EAAkB,IAAIC,gBAAgBC,OAAOC,SAASC,KAAKC,MAAM,KAAK,IACxEC,EAAa/B,EAA+C,SAApCyB,EAAgBO,IAAI,YAA4D,SAAnCP,EAAgBO,IAAI,WAC1E,OAAfD,IACFA,GAAa,GAGf,IAAM/F,EAAS,CACbC,KAAM,QACNC,KAAK,EACL+F,QAAQ,EACR9F,UAAU,EACVC,QAAS,GAETC,SAAS,EACTC,kBAAmB,IACnBC,cAAc,EACdC,6BAA6B,EAG7B0F,UAAW,SAAC5I,EAAMgF,GAChB,MAAO,CACLQ,EAAGmB,GAAW,EAAE3B,EAASY,EAAIZ,EAASQ,EACtCI,EAAGe,EAAU3B,EAASQ,EAAIR,EAASY,IAIvCzC,MAAO,WA2DLC,EAAOC,YA1DU,SAACC,EAAWC,GAG3B,GAAkB,eAAdD,EAA4B,CAC9B,IAAMtD,EAAOoB,EAAQoC,eAAeD,EAAUE,QAC1ChD,EAAS8C,EAAU9C,OACnBC,EAAS6C,EAAUgD,KACvBnF,EAAQsC,EAAC,YAAA/C,OAAaF,EAAM,MAAAE,OAAKD,EAAM,OAAMiD,IAAI,CAC/CnC,MAAO,KAETxB,EAAK4D,QAAQ,UAEf,GAAkB,iBAAdN,EAA8B,CAChC,IAAMtD,EAAOoB,EAAQoC,eAAeD,EAAUE,QAC1ChD,EAAS8C,EAAU9C,OACnBC,EAAS6C,EAAUgD,KACvBnF,EAAQsC,EAAC,YAAA/C,OAAaF,EAAM,MAAAE,OAAKD,EAAM,OAAMiD,IAAI,CAC/CnC,MAAO,IAETxB,EAAK4D,QAAQ,UAEf,GAAkB,kBAAdN,EAA+B,CACjC,IAAMlF,EAAOgD,EAAQoC,eAAeD,EAAUE,QAC9CrC,EAAQsC,EAAC,YAAA/C,OAAa4C,EAAUE,OAAM,OAAME,IAAI,CAC9CnC,MAAO,KAETpD,EAAKwF,QAAQ,UAEf,GAAkB,oBAAdN,EAAiC,CACnC,IAAMlF,EAAOgD,EAAQoC,eAAeD,EAAUE,QAC9CrC,EAAQsC,EAAC,YAAA/C,OAAa4C,EAAUE,OAAM,OAAME,IAAI,CAC9CnC,MAAO,IAETpD,EAAKwF,QAAQ,UAEf,GAAkB,iBAAdN,EAA8B,CAChC,IAAMlF,EAAOgD,EAAQoC,eAAeD,EAAUE,QAC9CrC,EAAQsC,EAAC,YAAA/C,OAAa4C,EAAUE,OAAM,OAAME,IAAI,CAC9C7B,eAAgB,KAElB1D,EAAKwF,QAAQ,UAEf,GAAkB,mBAAdN,EAAgC,CAClC,IAAMlF,EAAOgD,EAAQoC,eAAeD,EAAUE,QAC9CrC,EAAQsC,EAAC,YAAA/C,OAAa4C,EAAUE,OAAM,OAAME,IAAI,CAC9C7B,eAAgB,KAElB1D,EAAKwF,QAAQ,UAEG,mBAAdN,IACuB,IAApBC,EAAU3D,QAAgB8G,GAAkC,IAApBnD,EAAU3D,OAAe8G,IACpExF,EAAa,CACXhD,MAAOA,EACPC,MAAOA,QAcf0K,EAAK,EACLC,EAAQ3K,EAAMc,OA8FhB,OA7FFd,EAAMN,QAAQ,SAACO,GAEU,IAAnBA,EAAKmC,KAAKpB,MACZ0J,GAAM,EAENA,GAAMnJ,SAAStB,EAAKmC,KAAKpB,SAKxBuH,GAIHqC,eAAeC,QAAQ,MAAOH,GAC9BE,eAAeC,QAAQ,SAAUF,KAJjCC,eAAeC,QAAQ,KAAMH,GAC7BE,eAAeC,QAAQ,QAASF,IAMHhF,kBAAQ,kBAAQpH,IAAAC,cAACoH,IAAkB,CAChEC,SAAUD,IAAmBE,kBAAkBhD,GAE/ClE,MAAO,CAAEyE,MAtRG,OAsRWC,OArRV,QAsRbyC,gBAAgB,EAChBC,QAAS,EACTC,QAAS,GACTC,iBAAiB,EACjBC,qBAAqB,EACrB5B,OAAQA,EACR6B,WAAYlD,EACZmD,GAAI,SAAAA,GACFpD,EAAUoD,EAEVA,EAAGC,GAAG,YAAa,OAAQ,SAASC,GAAO,IACjChE,EAAWgE,EAAXhE,OACRA,EAAOiD,IAAI,CACTnC,MAAO,KAET,IAAMiC,EAASiB,EAAMhE,OAAOnD,KAC5B6F,EAAOgD,UAAU,gBAAiB,CAAE3C,SAAQ/C,WAC5C0C,EAAOgD,UAAU,eAAgB,CAAE3C,SAAQ/C,aAG7C8D,EAAGC,GAAG,YAAa,OAAQ,SAASC,GACfA,EAAXhE,OACDiD,IAAI,CACT7B,eAAgB,KAElB,IAAM2B,EAASiB,EAAMhE,OAAOnD,KAC5B6F,EAAOgD,UAAU,eAAgB,CAAE3C,WACnCL,EAAOgD,UAAU,cAAe,CAAE3C,WAElC,IACItE,EADOuF,EAAMhE,OACAH,KAAK,SAElBwF,EAAWnB,SAASoB,cAAa,IAAArF,OAAKxB,IACzB,OAAb4G,IACFA,EAAShJ,MAAMkJ,QAAU,EACzBF,EAAShJ,MAAMmJ,OAAS,IACxBH,EAAShJ,MAAMoJ,WAAa,UAIhC3B,EAAGC,GAAG,WAAY,OAAQ,SAASC,GACdA,EAAXhE,OACDiD,IAAI,CACT7B,eAAgB,KAElB,IAAM2B,EAASiB,EAAMhE,OAAOnD,KAC5B6F,EAAOgD,UAAU,iBAAkB,CAAE3C,WACrCL,EAAOgD,UAAU,gBAAiB,CAAE3C,WAEpC,IACItE,EADOuF,EAAMhE,OACAH,KAAK,SAElBwF,EAAWnB,SAASoB,cAAa,IAAArF,OAAKxB,IACzB,OAAb4G,IACFA,EAAShJ,MAAMkJ,QAAU,GACzBF,EAAShJ,MAAMmJ,OAAS,EACxBH,EAAShJ,MAAMoJ,WAAa,YAIhC3B,EAAGC,GAAG,WAAY,OAAQ,SAASC,GAAO,IAChChE,EAAWgE,EAAXhE,OACRA,EAAOiD,IAAI,CACTnC,MAAO,IAET,IAAMiC,EAASiB,EAAMhE,OAAOnD,KAC5B6F,EAAOgD,UAAU,kBAAmB,CAAE3C,SAAQ/C,WAC9C0C,EAAOgD,UAAU,iBAAkB,CAAE3C,SAAQ/C,iBAG5C,CAACO,aC7XCgI,EAPX,SAAAA,EAAYC,GACR,OADoBC,YAAAC,KAAAH,GACb,IAAII,MAAM,GAAI,CACrBX,IAAK,SAAChI,EAAQiC,GAAI,OAAKA,KAAQjC,EAASA,EAAOiC,GAAQuG,6hCCG/D5K,IAAUC,IAAIE,KACdH,IAAUC,IAAIC,KAkeC8K,MApdf,SAAqB7C,GAAuG,IAArGlG,EAAIkG,EAAJlG,KAAMgJ,EAAY9C,EAAZ8C,aAAcnG,EAAMqD,EAANrD,OAAQoG,EAAK/C,EAAL+C,MAAOC,EAAmBhD,EAAnBgD,oBAAqBC,EAAoBjD,EAApBiD,qBAAsBC,EAAKlD,EAALkD,MAAOC,EAAanD,EAAbmD,cAExGhF,SAASiF,iBAAiB,UAAW,SAASnF,GAC1B,UAAdA,EAAMoF,KACRlF,SAASiB,KAAKkE,UAAUC,IAAI,iBAIhCpF,SAASiF,iBAAiB,QAAS,SAASnF,GACxB,UAAdA,EAAMoF,KACRlF,SAASiB,KAAKkE,UAAUE,OAAO,iBAKnC,IAAIC,EAAY,GACZC,EAAaC,KAAKC,MAAMtB,eAAeuB,QAAQ,aACnD,GAAId,IAAUW,EAAkB,MAC9B,IAAK,IAAIL,KAAOK,EACF,UAARL,GAAoBK,EAAWL,IACjCI,EAAUnM,KAAK+L,EAAItB,MAAM,WA6B/B,IANoB3I,EAWhB3B,GAXgB2B,EASKU,EAAKJ,IAAI,SAACZ,EAAOK,GAAK,MAAK,CAACL,EAAM,GAAIA,EAAM,MAAKe,OARxEiK,YAAW,IAAIC,IAAI3K,KAUDM,IAAI,SAACZ,EAAOK,GAC5B,MAAO,CAAEW,KAAM,CAAEhD,GAAKgC,EAAOJ,MAAOI,EAAOiB,KAAM,SAGjDrC,EAAQoC,EAAKH,OAAO,SAAAsH,GACtB,QAAA+C,EAAA,EAAAC,EAAcR,EAASO,EAAAC,EAAAzL,OAAAwL,IAAE,CAApB,IAAI9C,EAAC+C,EAAAD,GACR,GAAI9C,EAAE,KAAOD,EAAE,IAAMC,EAAE,KAAOD,EAAE,GAC9B,OAAO,EAGX,OAAO,IACNvH,IAAI,SAACZ,EAAOK,GACb,MAAO,CAAEW,KAAM,CAAEE,OAAQlB,EAAM,GAAImB,OAAQnB,EAAM,GAAIJ,MAAOI,EAAM,GAAIhC,GAAE,GAAAoD,OAAKpB,EAAM,GAAE,MAAAoB,OAAKpB,EAAM,IAAMuH,SAAUvH,EAAM,GAAIwH,SAAUxH,EAAM,OAM5I,GAAIoL,OAAOC,KAAKjB,GAAO1K,OAAS,EAG9B,IAAK,IAAI4L,KAFT3M,EAAMH,KAAK,CAAEwC,KAAM,CAAEhD,GAAI,QAAS4B,MAAO,QAASqB,KAAM,KAAMqK,KAAM,UAEnDlB,EACfxL,EAAMJ,KAAK,CACTwC,KAAM,CACJE,OAAQ,QACRC,OAAQmK,EACR1L,MAAOwK,EAAMkB,GACbtN,GAAE,UAAAoD,OAAYkK,GACd/D,SAAU,QACVC,SAAU8D,EACVC,SAAU,UAOlB,IACuCjE,EADvCG,EAAAC,EACwB9I,EAAM+I,WAAS,IAAvC,IAAAF,EAAAG,MAAAN,EAAAG,EAAAI,KAAAC,MAAyC,KAAAC,EAAAT,EAAAtH,MAAAgI,EAAAvG,YAAAsG,EAAA,GAA7BE,EAACD,EAAA,GAEY,GAFNA,EAAA,GAERhH,KAAKpB,QACZhB,EAAMqJ,GAAGjH,KAAKpB,MAAQ,KAO1B,MAAAsI,GAAAT,EAAAU,EAAAD,GAAA,QAAAT,EAAAW,IAEA,IAsGIvG,EAtGAH,EAAY,CACd/C,MAAOA,EACPC,MAAOA,GAKLkD,EAAa,CACb,CACEC,SAAU,OACVvE,MAAO,CACLwE,gBAAiB,OACjBO,eAAgB,GAChBkG,MAAO,YACPxG,MAAO,IACPC,OAAQ,GACRtC,MAAO,cACPuC,kBAAmB,MACnBC,UAAW,KACXC,qBAAsB,MACtB3E,MAAO,QACP4E,SAAU,GACVoG,cAAe,SACfC,cAAe,WAGnB,CACE5G,SAAU,gBACVvE,MAAO,CACL+E,eAAgB,MAChBC,eAAgB,UAChBC,iBAAkB,MAClBC,mBAAoB,UACpBT,MAAO,GACPC,OAAQ,GACRS,qBAAsB,UACtBN,qBAAsB,IAG1B,CACEN,SAAU,sBACVvE,MAAO,CACLiL,MAAO,cAGX,CACE1G,SAAU,OACVvE,MAAO,CACLyE,MAAO,EACPrC,MAAO,cACPiD,qBAAsB,UACtBC,qBAAsB,WACtB0I,cAAe,EACfzI,cAAe,SACf0I,iBAAkB,gBAClBpJ,qBAAsB,MACtB3E,MAAO,QACP4E,SAAU,KAGd,CACEP,SAAU,oBACVvE,MAAO,CACLgF,eAAgB,SAGpB,CACET,SAAU,wBACVvE,MAAO,CACLkO,aAAc,YAKtB,IAAK,IAAInB,KAAOP,EAAc,CAC5B,IAAIhK,EAAQgK,EAAaO,GACzBzI,EAAWtD,KAAK,CACduD,SAAQ,eAAAX,OAAiBmJ,EAAG,MAC5B/M,MAAO,CAELgF,eAAgBxC,KAKtBpB,EAAMgC,IAAI,SAACZ,EAAOc,GACd,IAAII,EAASlB,EAAMgB,KAAKE,OACpBC,EAASnB,EAAMgB,KAAKG,OAYxB,OAVAW,EAAWtD,KAAK,CACduD,SAAQ,YAAAX,OAAcF,EAAM,MAAAE,OAAKD,EAAM,MACvC3D,MAAO,CACLwF,YAAa,kBACbC,4BAA2B,GAAA7B,OAAKzB,EAASuB,GAAO,KAAAE,OAAIzB,EAASwB,IAC7D+B,+BAAgC,UAChCL,qBAAoB,GAAAzB,OAAKzB,EAASwB,OAI/B,IAMX,IACIiG,EAAgD,SAD5B,IAAIyB,gBAAgBC,OAAOC,SAAS4C,QAC9BxC,IAAI,cAClB,OAAZ/B,IACAA,GAAU,GAGd,IAAMjE,EAAS,CACXC,KAAM,SACNC,KAAK,EACL+F,QAAQ,EACR9F,UAAU,EACVC,QAAS,GAETC,SAAS,EACTC,kBAAmB,IACnBC,cAAc,EACdC,6BAA6B,EAC7BC,MAAO,WAmDLC,EAAOC,YAlDU,SAACC,EAAWC,GAG3B,GAAkB,eAAdD,EAA4B,CAC9B,IAAMtD,EAAOoB,EAAQoC,eAAeD,EAAUE,QAC1ChD,EAAS8C,EAAU9C,OACnBC,EAAS6C,EAAUgD,KACvBnF,EAAQsC,EAAC,YAAA/C,OAAaF,EAAM,MAAAE,OAAKD,EAAM,OAAMiD,IAAI,CAC/CnC,MAAO,KAETxB,EAAK4D,QAAQ,UAEf,GAAkB,iBAAdN,EAA8B,CAChC,IAAMtD,EAAOoB,EAAQoC,eAAeD,EAAUE,QAC1ChD,EAAS8C,EAAU9C,OACnBC,EAAS6C,EAAUgD,KACvBnF,EAAQsC,EAAC,YAAA/C,OAAaF,EAAM,MAAAE,OAAKD,EAAM,OAAMiD,IAAI,CAC/CnC,MAAO,IAETxB,EAAK4D,QAAQ,UAEf,GAAkB,kBAAdN,EAA+B,CACjC1E,QAAQC,IAAI0E,EAAU4H,QACtB,IAAI/M,EAAOgD,EAAQsC,EAAC,YAAA/C,OAAa4C,EAAU4H,OAAM,OACjD/M,EAAKuF,IAAI,CACPyH,cAAe,SACf5J,MAAO,EACP6J,WAAY,IAEdjN,EAAKmC,KAAK,WAAY,SAExB,GAAkB,gBAAd+C,EAA6B,CAC/B,IAAIlF,EAAOgD,EAAQsC,EAAC,YAAA/C,OAAa4C,EAAU4H,OAAM,OACjD/M,EAAKuF,IAAI,CACPyH,cAAe,SACf5J,MAAO,GACP6J,WAAY,IAEdjN,EAAKmC,KAAK,WAAY,QAExB,GAAkB,eAAd+C,EAA4B,CAC9B,IAAInF,EAAQiD,EAAQsC,EAAC,QACrBvF,EAAMwF,IAAI,CACRyH,cAAe,SACf5J,MAAO,EACP6J,WAAY,IAEdlN,EAAMoC,KAAK,WAAY,cAQ7BsI,EAAK,EACLC,EAAQ3K,EAAMc,OAkBlB,SAASC,EAASC,GAChB,MAAc,UAAVA,EACK,OAEGoK,EAAapK,GAgKzB,OArLFhB,EAAMgC,IAAI,SAAC/B,GAWT,MAVyB,UAArBA,EAAKmC,KAAKE,SAEW,IAAnBrC,EAAKmC,KAAKpB,MACZ0J,GAAM,EAENA,GAAMnJ,SAAStB,EAAKmC,KAAKpB,QAKtB,IAGT4J,eAAeC,QAAQ,QAASH,GAChCE,eAAeC,QAAQ,WAAYF,GAmBJhF,kBAAQ,kBAAQpH,IAAAC,cAACoH,IAAkB,CAC9DC,SAAUD,IAAmBE,kBAAkBhD,GAE/ClE,MAAO,CAAEyE,MAhRC,OAgRaC,OA/QZ,QAgRXyC,gBAAgB,EAChBC,QAAS,EACTC,QAAS,GACTC,iBAAiB,EACjBC,qBAAqB,EACrB5B,OAAQA,EACR6B,WAAYlD,EACZmD,GAAI,SAAAA,GACFpD,EAAUoD,EAEVA,EAAG8G,IAAI,SAAU,QACjB9G,EAAGC,GAAG,SAAU,OAAQ,SAAA8G,MAIxB/G,EAAG8G,IAAI,MAAO,QACd9G,EAAGC,GAAG,MAAO,OAAQ,SAAA8G,GACnB,IAAIC,EAAS,UACTD,EAAIE,cAAcC,WACpBF,EAAS,UAGX,IAAIpN,EAAOmN,EAAI7K,QAIW,IAtClC,SAAsBtC,EAAMoN,GAC1B,MAAe,YAAXA,EACK9B,EAAqBtL,EAAKb,MAE1BkM,EAAoBrL,EAAKb,MAgCLoO,CAAavN,EAAMoN,IAKzB,YAAXA,IAEG5B,EAAcvL,SAASD,EAAKb,OAU/Ba,EAAKuF,IAAI,CACPyH,cAAe,SACf5J,MAAO,EACP6J,WAAY,IAEdjN,EAAKmC,KAAK,WAAY,WAbtBnC,EAAKuF,IAAI,CACPyH,cAAe,OACf5J,MAAO,GACP6J,WAAY,IAEdjN,EAAKmC,KAAK,WAAY,YAc9BiE,EAAG8G,IAAI,YAAa,QACpB9G,EAAGC,GAAG,YAAa,OAAQ,SAASC,GAAO,IACjChE,EAAWgE,EAAXhE,OACuB,SAA3BA,EAAOH,OAAOqL,SAChBlL,EAAOiD,IAAI,CACTnC,MAAO,EACP6J,WAAY,KAId3K,EAAOiD,IAAI,CACTnC,MAAO,GACP6J,WAAY,OAGhB,IAAM5H,EAASiB,EAAMhE,OAAOnD,KAC5B6F,EAAOgD,UAAU,gBAAiB,CAAE3C,SAAQ/C,WAC5C0C,EAAOgD,UAAU,eAAgB,CAAE3C,SAAQ/C,aAQ7C8D,EAAG8G,IAAI,YAAa,QACpB9G,EAAGC,GAAG,YAAa,OAAQ,SAASC,GACfA,EAAXhE,OACDiD,IAAI,CACT7B,eAAgB,KAElB,IAAM2B,EAASiB,EAAMhE,OAAOnD,KAC5B6F,EAAOgD,UAAU,eAAgB,CAAE3C,WACnCL,EAAOgD,UAAU,cAAe,CAAE3C,WAElC,IACItE,EADOuF,EAAMhE,OACAH,KAAK,SAElBwF,EAAWnB,SAASoB,cAAa,IAAArF,OAAKxB,IACzB,OAAb4G,IACFA,EAAShJ,MAAMkJ,QAAU,EACzBF,EAAShJ,MAAMmJ,OAAS,IACxBH,EAAShJ,MAAMoJ,WAAa,UAIhC3B,EAAG8G,IAAI,WAAY,QACnB9G,EAAGC,GAAG,WAAY,OAAQ,SAASC,GACdA,EAAXhE,OACDiD,IAAI,CACT7B,eAAgB,KAElB,IAAM2B,EAASiB,EAAMhE,OAAOnD,KAC5B6F,EAAOgD,UAAU,iBAAkB,CAAE3C,WACrCL,EAAOgD,UAAU,gBAAiB,CAAE3C,WAEpC,IACItE,EADOuF,EAAMhE,OACAH,KAAK,SAElBwF,EAAWnB,SAASoB,cAAa,IAAArF,OAAKxB,IACzB,OAAb4G,IACFA,EAAShJ,MAAMkJ,QAAU,GACzBF,EAAShJ,MAAMmJ,OAAS,EACxBH,EAAShJ,MAAMoJ,WAAa,YAIhC3B,EAAG8G,IAAI,WAAY,QACnB9G,EAAGC,GAAG,WAAY,OAAQ,SAASC,GAAO,IAChChE,EAAWgE,EAAXhE,OACuB,SAA3BA,EAAOH,OAAOqL,SAChBlL,EAAOiD,IAAI,CACTnC,MAAO,EAEP6J,WAAY,IAGd3K,EAAOiD,IAAI,CACTnC,MAAO,GACP6J,WAAY,IAGhB,IAAM5H,EAASiB,EAAMhE,OAAOnD,KAC5B6F,EAAOgD,UAAU,kBAAmB,CAAE3C,SAAQ/C,WAC9C0C,EAAOgD,UAAU,iBAAkB,CAAE3C,SAAQ/C,iBAM9C,CAACH,KC3RGsL,MAvMf,SAAqBpF,GAsBlB,IArBCjG,EAAIiG,EAAJjG,KACAsL,EAAOrF,EAAPqF,QACAC,EAAWtF,EAAXsF,YACAC,EAAQvF,EAARuF,SACA3M,EAAQoH,EAARpH,SAEA4M,GADKxF,EAALyF,MACMzF,EAANwF,QACAxC,EAAmBhD,EAAnBgD,oBACAC,EAAoBjD,EAApBiD,qBACAyC,EAAS1F,EAAT0F,UACAxC,EAAKlD,EAALkD,MACAyC,EAAY3F,EAAZ2F,aACAxC,EAAanD,EAAbmD,cACAyC,EAAY5F,EAAZ4F,aACAC,EAAa7F,EAAb6F,cACAC,EAAe9F,EAAf8F,gBACAC,EAAgB/F,EAAhB+F,iBACAC,EAAehG,EAAfgG,gBACAC,EAAgBjG,EAAhBiG,iBACAC,EAAWlG,EAAXkG,YACAC,EAAcnG,EAAdmG,eAAc/L,EAEgBC,oBAAS,GAAMC,EAAAC,YAAAH,EAAA,GAAtCgM,EAAO9L,EAAA,GAAE+L,EAAU/L,EAAA,GAa1B,SAASgM,EAAUC,EAAMlD,GACrB,IAEM/K,EAAe,CACjB,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAEEC,EAAUD,EAAaE,OAEzBM,EAAQyN,EAAKlD,GAEjB,MApBoB,6BAoBCrK,KAAKF,GAASA,EAAQR,EAAaW,SAASH,GAASP,GAkG9E,IAAIiO,EAAejB,EAAkB,QAAa,eAE7BxM,IAAjByN,IACAA,EAAejB,EAAkB,SAIrC,IADA,IAAIzC,EAAe,GACV/B,EAAI,EAAGA,EAAInI,EAASJ,OAAQuI,IACjC+B,EAAalK,EAASmI,GAAG,IAAMnI,EAASmI,GAAG,GAG/C,OACI9K,IAAAC,cAAA,OAAKC,UAAS,cAAA+D,OAAyB,WAATH,EAAoB,MAAQ,QACtD9D,IAAAC,cAAA,OAAKC,UAAU,gBACXF,IAAAC,cAAA,MAAIC,UAAU,eAAcF,IAAAC,cAAA,SAAG,YAC/BD,IAAAC,cAAA,KAAGC,UAAU,iBAAgBF,IAAAC,cAAA,SAAG,uBAChCD,IAAAC,cAAA,QAAMuQ,QAlJC,SAACxI,GAChByH,IACa,WAAT3L,GACAsL,EAAQ,OACRC,EAAY,OAAQ,SAEpBD,EAAQ,WACRC,EAAY,OAAQ,aA2IahP,MAAO,CAAEC,eAAgB,OAAQC,MAAO,UAAWP,IAAAC,cAAA,KAAGC,UAAU,oBAAmBF,IAAAC,cAAA,SAAG,UAEvHD,IAAAC,cAAA,OAAKC,UAAU,gCACXF,IAAAC,cAAA,KAAGC,UAAU,cAAaF,IAAAC,cAAA,SAAG,oBAC7BD,IAAAC,cAAA,KAAGC,UAAU,iBAAe,cAAA+D,OAAgBqL,EAAoB,UAAE/M,SACjE0N,EAAY1N,OAAS,EAAIvC,IAAAC,cAAA,KACtBC,UAAU,aACVsQ,QA1EhB,WACIJ,GAAW,GACX,IAA8BK,EAAjBR,EAAYS,MACW5E,MAAM,KAAI6E,EAAArM,YAAAmM,EAAA,GAAzC3B,EAAM6B,EAAA,GAAEC,EAAID,EAAA,GAAElC,EAAMkC,EAAA,GAEV,aAAX7B,IACa,SAAT8B,GACAZ,EAAiBJ,EAAclM,OAAO,SAAAmN,GAAI,OAAIA,IAASpC,KAG9C,SAATmC,IACAd,EAAiB5C,EAAcxJ,OAAO,SAAAmN,GAAI,OAAIA,IAASpC,KACvDc,EAAO7F,UAAU,gBAAiB,CAAE+E,aAI7B,YAAXK,IACa,SAAT8B,GACAb,EAAgBJ,EAAajM,OAAO,SAAAmN,GAAI,OAAIA,IAASpC,KAG5C,SAATmC,GACAf,EAAgBH,EAAahM,OAAO,SAAAmN,GAAI,OAAIA,IAASpC,MAI9C,oBAAXK,IACAe,EAAgBH,EAAahM,OAAO,SAAAmN,GAAI,OAAIA,IAASpC,KACrDqB,EAAgB,GAAA7L,OAAA4J,YAAKX,GAAa,CAAEuB,KACpCc,EAAO7F,UAAU,cAAe,CAAE+E,YAGvB,YAAXK,IACAgB,EAAgB,GAAA7L,OAAA4J,YAAKX,GAAa,CAAEuB,KACpCc,EAAO7F,UAAU,cAAe,CAAE+E,YAGtCvM,QAAQC,IAAI2M,GACZ5M,QAAQC,IAAIyO,GACZ1O,QAAQC,IAAIsM,IAoCAqC,aAAc,kBAAMV,GAAW,IAC/BW,aAAc,kBAAMX,GAAW,KAClC,UAAQpQ,IAAAC,cAAAD,IAAAgR,SAAA,MACRb,EA1Hb,SAAqBc,EAAOX,GACxB,GAAIW,EAAM1O,QAAU,EAChB,OAAOvC,IAAAC,cAAAD,IAAAgR,SAAA,MAGX,IACIlF,EADiBmF,EAAMA,EAAM1O,OAAS,GACjBuJ,MAAM,KACGoF,EAAvBpF,EAAMA,EAAMvJ,OAAS,GACJuJ,MAAM,MAAKqF,EAAA7M,YAAA4M,EAAA,GAAlCnN,EAAMoN,EAAA,GAAEnN,EAAMmN,EAAA,GACfC,EAAcf,EAAUC,EAAMvM,GAC9BsN,EAAchB,EAAUC,EAAMtM,GAGjB,oBAAb8H,EAAM,KACNA,EAAM,GAAK,WAGf5J,QAAQC,IAAIkO,EAAUC,EAAMvM,IAE5B,IAAMuN,EAAc,CAChBC,QAAS,eACT1M,gBAAiBuM,EACjBhL,QAAS,MACToL,aAAc,MACdjR,MAAO,SAGLkR,EAAc,CAChBF,QAAS,eACT1M,gBAAiBwM,EACjBjL,QAAS,MACToL,aAAc,MACdjR,MAAO,SAGX,OACIP,IAAAC,cAAA,OAAKC,UAAU,uBACXF,IAAAC,cAAA,SAAGD,IAAAC,cAAA,SAAG,8BACND,IAAAC,cAAA,KAAGC,UAAU,gBAAgB4L,EAAM,GAAG,IAAEA,EAAM,IAC9C9L,IAAAC,cAAA,KAAGC,UAAU,gBAAeF,IAAAC,cAAA,QAAMI,MAAOiR,GAAcvN,GAAc,IAAC/D,IAAAC,cAAA,QAAMI,MAAOoR,GAAczN,KAmFtF0N,CAAYzB,EAAapD,GAAgB7M,IAAAC,cAAAD,IAAAgR,SAAA,MACpDhR,IAAAC,cAAA,UAAQ6D,KAAK,SAAS5D,UAAU,4BAA4BsQ,QArCxE,WACIN,EAAe,IACfL,EAAgB,IAChBC,EAAiB,IACjBC,EAAgB,IAChBC,EAAiB,IACjBT,EAAO7F,UAAU,gBA+BqE,SAC9E1J,IAAAC,cAAC2M,EAAY,CACT/I,KAAM0M,EACN1D,aAAcA,EACdnG,OAAQ6I,EACRzC,MAAOwC,EAAe,KACtBvC,oBAAqBA,EACrBC,qBAAsBA,EACtBC,MAAOA,EACPC,cAAeA,eChMpB,SAASyE,EAAS5H,GAA+B,IAA5B6H,EAAW7H,EAAX6H,YAAaC,EAAW9H,EAAX8H,YAC7C,OACI7R,IAAAC,cAAC6R,IAAK,CAACC,KAAMH,EAAaC,YAAaA,EAAaG,aAAc,CAAEC,WAAY,qBAAsBzI,OAAQ,MAAQ0I,cAAc,OAAOC,OAAK,GAC3I,SAAAC,GAAK,OACFpS,IAAAC,cAAA,OAAKC,UAAU,mBAIXF,IAAAC,cAAA,OAAKC,UAAU,UAAS,QAGxBF,IAAAC,cAAA,KAAGC,UAAU,wBAAuB,8JACpCF,IAAAC,cAAA,KAAGC,UAAU,wBAAuB,8EACpCF,IAAAC,cAAA,KAAGC,UAAU,wBAAuB,gIAEpCF,IAAAC,cAAA,UACIC,UAAU,eACVsQ,QAAS,WACTtO,QAAQC,IAAI,iBACZ0P,MAEH,YCrBN,SAASQ,EAAgBtI,GAA6B,IAA3B6H,EAAW7H,EAAX6H,YAAaC,EAAW9H,EAAX8H,YACnD,OACI7R,IAAAC,cAAC6R,IAAK,CAACC,KAAMH,EAAaU,QAAST,EAAaG,aAAc,CAAEC,WAAY,qBAAsBzI,OAAQ,MAAQ0I,cAAc,OAAOC,OAAK,GACvI,SAAAC,GAAK,OACFpS,IAAAC,cAAA,OAAKC,UAAU,0BAIXF,IAAAC,cAAA,OAAKC,UAAU,UAAS,SAGxBF,IAAAC,cAAA,KAAGC,UAAU,wBAAuB,oDAEpCF,IAAAC,cAAA,UACIC,UAAU,eACVsQ,QAAS4B,GACZ,miCCGrB,SAASG,EAASC,GAEhB,IAGkCrI,EAW9BgE,EAdEsE,EAAc,IAAIC,IAExBpI,EAAAC,EAC0BiI,GAAQ,IAAlC,IAAAlI,EAAAG,MAAAN,EAAAG,EAAAI,KAAAC,MAAoC,KAAAZ,EAAAI,EAAAtH,MAAA+H,EAAAtG,YAAAyF,EAAA,GAAxBrJ,EAAGkK,EAAA,GAAE+H,EAAI/H,EAAA,GACd6H,EAAYG,IAAIlS,IACnB+R,EAAYI,IAAInS,EAAK,GAElB+R,EAAYG,IAAID,IACnBF,EAAYI,IAAIF,EAAM,GAExBF,EAAYI,IAAIF,EAAMF,EAAYzG,IAAI2G,GAAQ,IAGhD,MAAA5H,GAAAT,EAAAU,EAAAD,GAAA,QAAAT,EAAAW,IAYA,GAVAwH,EAAYtR,QAAQ,SAAC2R,EAAUxP,GAC7B,GAAiB,IAAbwP,EAAgB,CAClB,GAAI3E,EAEF,MAAM,IAAI4E,MAAM,gCAElB5E,EAAO7K,UAIER,IAATqL,EAEF,MAAM,IAAI4E,MAAM,+BAGlB,OAAO5E,EA+BT,SAAS6E,EAAkBzR,EAAMiC,GAC/B,IAE4ByP,EAFxB9E,EAAOoE,EAAShR,GAAM2R,EAAA3I,EAEN/G,GAAQ,IAA5B,IAAA0P,EAAAzI,MAAAwI,EAAAC,EAAAxI,KAAAC,MAA8B,KAAnBwI,EAAKF,EAAApQ,MACd,GAAIsQ,EAAM,KAAOhF,EACf,OAAOgF,EAAM,IAEhB,MAAApI,GAAAmI,EAAAlI,EAAAD,GAAA,QAAAmI,EAAAjI,IAED,OAAO,KAOT,SAASmI,EAAWvP,GAElB,IAAIwP,EAAYxP,EAAgB,UAgBhC,OAtDF,SAAsCyP,GACpC,IAEsBpI,EAFhBqI,EAAgB,GAAGpI,EAAAZ,EAEN+I,GAAG,IAAtB,IAAAnI,EAAAV,MAAAS,EAAAC,EAAAT,KAAAC,MAAwB,KAAbiG,EAAI1F,EAAArI,MACT0Q,EAAc3C,GAChB2C,EAAc3C,KAEd2C,EAAc3C,GAAQ,GAEzB,MAAA7F,GAAAI,EAAAH,EAAAD,GAAA,QAAAI,EAAAF,IAED,OAAOsI,EA2CAC,CAfKH,EAAU5P,IAAI,SAACgQ,GAAI,OAAKA,EAAW,OAG7BhQ,IAAI,SAAClC,GAAI,OAAKgR,EAAShR,KACfkC,IAAI,SAAC0K,EAAMjL,GAAU,IACGwQ,EADHC,EAAApJ,EACzB8I,EAAUnQ,GAAiB,UAAC,IAAhD,IAAAyQ,EAAAlJ,MAAAiJ,EAAAC,EAAAjJ,KAAAC,MAAkD,KAAvCwI,EAAKO,EAAA7Q,MACd,GAAIsQ,EAAM,KAAOhF,EACf,OAAOgF,EAAM,IAGjB,MAAApI,GAAA4I,EAAA3I,EAAAD,GAAA,QAAA4I,EAAA1I,IACA,OAAO,KAQX,SAASoE,EAAYjC,EAAKvK,GAExB,IAAI+Q,EAAY,IAAIlI,gBAAgBC,OAAOC,SAASC,KAAKC,MAAM,KAAK,IACpE8H,EAAUf,IAAIzF,EAAKvK,GAGnB8I,OAAOC,SAASnL,KAAO,SAAWmT,EAAUC,WA4rB/BC,MAzrBf,SAAa7R,GAAO,IAAAkC,EACEC,mBAAS,GAAEC,EAAAC,YAAAH,EAAA,GAAxBgI,EAAE9H,EAAA,GAAE0P,EAAK1P,EAAA,GAAA2P,EACU5P,mBAAS,GAAE6P,EAAA3P,YAAA0P,EAAA,GAA9B5H,EAAK6H,EAAA,GAAEC,EAAQD,EAAA,GAAAE,EACA/P,mBAAS,GAAEgQ,EAAA9P,YAAA6P,EAAA,GAA1BE,EAAGD,EAAA,GAAEE,EAAMF,EAAA,GAAAG,EACUnQ,mBAAS,GAAEoQ,EAAAlQ,YAAAiQ,EAAA,GAAhCE,EAAMD,EAAA,GAAEE,EAASF,EAAA,GAAAG,EACEvQ,mBAAS,GAAEwQ,EAAAtQ,YAAAqQ,EAAA,GAA9BnF,EAAKoF,EAAA,GAAEC,EAAQD,EAAA,GAAAE,EACU1Q,mBAAS,GAAE2Q,EAAAzQ,YAAAwQ,EAAA,GAApCE,EAAQD,EAAA,GAAEE,EAAWF,EAAA,GACtBG,EAAe7I,eAAeuB,QAAQ,aAE5CuH,EACwC/Q,mBAAS,IAAGgR,EAAA9Q,YAAA6Q,EAAA,GAA7CzF,EAAY0F,EAAA,GAAEvF,EAAeuF,EAAA,GAAAC,EACMjR,mBAAS,IAAGkR,EAAAhR,YAAA+Q,EAAA,GAA/CnI,EAAaoI,EAAA,GAAExF,EAAgBwF,EAAA,GAEtCC,EAC4CnR,mBAAS,GAAEoR,EAAAlR,YAAAiR,EAAA,GAAhDE,EAAcD,EAAA,GAAEE,EAAiBF,EAAA,GAGxCG,EAC8BvR,oBAAS,GAAMwR,EAAAtR,YAAAqR,EAAA,GAAtCE,EAAOD,EAAA,GAAEE,GAAUF,EAAA,GAAAG,GACI3R,oBAAS,GAAM4R,GAAA1R,YAAAyR,GAAA,GAAtCE,GAAOD,GAAA,GAAEE,GAAUF,GAAA,GAE1BG,GAC0B/R,mBAAS,IAAGgS,GAAA9R,YAAA6R,GAAA,GAA/BlJ,GAAKmJ,GAAA,GAAEC,GAAQD,GAAA,GAAAE,GACoBlS,mBAAS,IAAGmS,GAAAjS,YAAAgS,GAAA,GAA/C1G,GAAa2G,GAAA,GAAEvG,GAAgBuG,GAAA,GAAAC,GACEpS,mBAAS,IAAGqS,GAAAnS,YAAAkS,GAAA,GAA7C7G,GAAY8G,GAAA,GAAE1G,GAAe0G,GAAA,GAEpCC,GACsCtS,mBAAS,IAAGuS,GAAArS,YAAAoS,GAAA,GAA3CzG,GAAW0G,GAAA,GAAEzG,GAAcyG,GAAA,GAalClS,oBAAU,WACRmS,MACC,CAAClH,EAAcxC,EAAeyC,GAAcC,KAmE9C,IAAAiH,GAE+BzS,mBAASsJ,KAAKC,MAAMuH,IAAc4B,GAAAxS,YAAAuS,GAAA,GAA3DvH,GAAQwH,GAAA,GAAEC,GAAWD,GAAA,GAE5B,SAASF,KAaP,IAXA,IAAMI,EAAYtJ,KAAKC,MAAMuH,GAEzB+B,EAAe,CACjBhR,KAAQ+Q,EAAgB,KACxBE,SAAYF,EAAoB,SAChC3D,UAAa,GACb8D,QAAW,CACTjT,UAAa,KAIR4G,EAAI,EAAGA,EAAIkM,EAAqB,UAAEzU,OAAQuI,IAAK,CAkBtD,IAjBA,IAAIsM,EAAYJ,EAAqB,UAAElM,GAAS,KAC5CuM,EAAgBL,EAAqB,UAAElM,GAAa,SACpDwM,EAAiBN,EAAqB,UAAElM,GAAc,UAEtDyM,EAAevE,EAAkBoE,EAAWC,GAE5CG,GAAmB,EAGnBC,EAA6C,IAAzB7H,GAAcrN,QAAgBqN,GAAcjO,SAAS4V,GAGzEG,EAA4C,IAAxB/H,GAAapN,QAAgBoN,GAAahO,SAAS4V,GAGvEI,EAAsB,EAEjBC,EAAI,EAAGA,EAAIN,EAAe/U,OAAQqV,IAAK,CAK9C,IAHA,IAAIC,EAAsBP,EAAeM,GAAG,GACxC,KACAZ,EAAqB,UAAElM,GAAc,UAAE8M,GAAG,GACrCE,EAAI,EAAGA,EAAIpI,EAAanN,OAAQuV,IAEnCD,IAAwBnI,EAAaoI,KACvCN,GAAmB,GAIvB,IAAK,IAAIM,EAAI,EAAGA,EAAI5K,EAAc3K,OAAQuV,IACpCD,IAAwB3K,EAAc4K,IACxCH,IAKN,IAAKD,GAAoBD,IAAsBD,GAAqBG,IAAwBzK,EAAc3K,OAAS,CACjH,IAAMwV,EAAerK,KAAKC,MAAMD,KAAKsK,UAAUhB,EAAqB,UAAElM,KACtEmM,EAAwB,UAAE5V,KAAK0W,IAKnC,IAAK,IAAIjN,EAAI,EAAGA,EAAImM,EAAwB,UAAE1U,OAAQuI,IACpD,IAAK,IAAI8M,EAAI,EAAGA,EAAIX,EAAwB,UAAEnM,GAAc,UAAEvI,OAAQqV,IAAK,CAGzE,IAFA,IAAIK,GAAgB,EAEXH,EAAI,EAAGA,EAAIb,EAAsB,QAAa,UAAE1U,OAAQuV,IAE3Db,EAAsB,QAAa,UAAEa,GAAG,KAAOb,EAAwB,UAAEnM,GAAc,UAAE8M,GAAG,IAC3FX,EAAsB,QAAa,UAAEa,GAAG,KAAOb,EAAwB,UAAEnM,GAAc,UAAE8M,GAAG,KAC/FK,GAAgB,EAChBhB,EAAsB,QAAa,UAAEa,GAAG,IAAM,GAGlD,IAAKG,EAAe,CAClB,IAAIC,EAAkB,GAAAjU,OAAA4J,YAAOoJ,EAAwB,UAAEnM,GAAc,UAAE8M,GAAGO,MAAM,GAAI,IAAE,CAAE,IACxFlB,EAAsB,QAAa,UAAE5V,KAAK6W,IAKhD,GAAoD,IAAhDjB,EAAsB,QAAa,UAAE1U,OAAa,CAGpD,IAAM6V,EAAYnI,GAAYA,GAAY1N,OAAS,GAiBnD,OAhBA2N,GAAeD,GAAYkI,MAAM,GAAI,IACN,iBAA3BC,EAAUD,MAAM,EAAG,KACrBjW,QAAQC,IAAI,8CACZ0N,EAAgBH,EAAayI,MAAM,GAAI,KACH,iBAA3BC,EAAUD,MAAM,EAAG,KAC5BjW,QAAQC,IAAI,8CACZ0N,EAAgBF,GAAawI,MAAM,GAAI,KACF,kBAA5BC,EAAUD,MAAM,EAAG,KAC5BjW,QAAQC,IAAI,+CACZ0N,EAAgBD,GAAcuI,MAAM,GAAI,MAExCjW,QAAQC,IAAI,+CACZ2N,EAAiB5C,EAAciL,MAAM,GAAI,KAG3CE,MACQ,EAGPrB,EAAoB,WACrBC,EAAuB,SAAIvJ,KAAKC,MAAMD,KAAKsK,UAAUhB,EAAoB,YAG3ED,GAAYE,GACZZ,GAASjD,EAAW6D,IAEpB,IAAIqB,EAAYrB,EAAwB,UAAExT,IAAI,SAACZ,EAAOK,GAAY,OAAOL,EAAY,OAUrF,OARKyV,EAAU3W,SAASkC,GAAW,OACjC0U,GAAQtB,EAAwB,UAAEvT,OAAO,SAACkN,GAAW,OAAOA,EAAW,OAAM0H,EAAU,KAAM,SAGjFxV,IAAV0V,IAAwBF,EAAU3W,SAAS6W,GAAY,OACzDC,GAASxB,EAAwB,UAAEvT,OAAO,SAACkN,GAAW,OAAOA,EAAW,OAAM0H,EAAU,KAAM,IAGzF,EACR,IAAAI,GAEmCtU,mBAASkL,GAAoB,UAAE7L,IAAI,SAACZ,EAAOK,GAAY,OAAOL,EAAY,QAAK8V,GAAArU,YAAAoU,GAAA,GAA5GE,GAAUD,GAAA,GAAEE,GAAaF,GAAA,GAE1BlN,GAAkB,IAAIC,gBAAgBC,OAAOC,SAASC,KAAKC,MAAM,KAAK,IAExEgN,GAAYrN,GAAgBO,IAAI,YAChC+M,GAAatN,GAAgBO,IAAI,aAAagN,GAElB5U,mBAAS0U,IAAUG,GAAA3U,YAAA0U,GAAA,GAA5CxV,GAAQyV,GAAA,GAAEC,GAAWD,GAAA,GAAAE,GACM/U,mBAAS2U,IAAWK,GAAA9U,YAAA6U,GAAA,GAA/CE,GAASD,GAAA,GAAEE,GAAYF,GAAA,GAAAG,GAEFnV,mBAA4C,SAAnCqH,GAAgBO,IAAI,YAAsBwN,GAAAlV,YAAAiV,GAAA,GAAxEE,GAAMD,GAAA,GAAEE,GAASF,GAAA,GAAAG,GACMvV,mBAA6C,SAApCqH,GAAgBO,IAAI,aAAuB4N,GAAAtV,YAAAqV,GAAA,GAA3EE,GAAOD,GAAA,GAAEE,GAAUF,GAAA,GAAAG,GAEF3V,mBAASqH,GAAgBO,IAAI,SAAQgO,GAAA1V,YAAAyV,GAAA,GAAtDjW,GAAIkW,GAAA,GAAE5K,GAAO4K,GAAA,GAEF,cAAdlB,KACFzJ,EAAY,WAAYC,GAAoB,UAAE,GAAS,MACvD4J,GAAY5J,GAAoB,UAAE,GAAS,OAE1B,cAAfyJ,KACF1J,EAAY,YAAaC,GAAoB,UAAE,GAAS,MACxDgK,GAAahK,GAAoB,UAAE,GAAS,OAG9CjD,eAAeC,QAAQ,WAAYoB,KAAKsK,UAAU,IAAIzL,EAAY,KAClEF,eAAeC,QAAQ,aAAcoB,KAAKsK,UAAU,IAAIzL,EAAY,KAAK,IAkBrE0N,GACAC,GAnBqEC,GAIjD/V,mBAASkL,GAAoB,UAAE5L,OAAO,SAACkN,GAAW,OAAOA,EAAW,OAAMpN,KAAY,IAAG4W,GAAA9V,YAAA6V,GAAA,GAA1GtW,GAAIuW,GAAA,GAAE7B,GAAO6B,GAAA,GAAAC,GACMjW,mBAASkL,GAAoB,UAAE5L,OAAO,SAACkN,GAAW,OAAOA,EAAW,OAAMyI,KAAa,IAAGiB,GAAAhW,YAAA+V,GAAA,GAA7G7B,GAAK8B,GAAA,GAAE7B,GAAQ6B,GAAA,GAAAC,GACEnW,mBAASP,GAAW,MAAE2W,GAAAlW,YAAAiW,GAAA,GAAvChZ,GAAIiZ,GAAA,GAAEC,GAAOD,GAAA,GAAAE,GACqBtW,mBAASP,GAAe,UAAE8W,GAAArW,YAAAoW,GAAA,GAA5DE,GAAaD,GAAA,GAAEE,GAAeF,GAAA,GAAAG,GACH1W,mBAASP,GAAgB,WAAEkX,GAAAzW,YAAAwW,GAAA,GAAtD5W,GAAS6W,GAAA,GAAEC,GAAYD,GAAA,GAAAE,GACJ7W,mBAAS,IAAG8W,GAAA5W,YAAA2W,GAAA,GAA/BE,GAAKD,GAAA,GAAEE,GAAQF,GAAA,GAAAG,GACqBjX,mBAAS,IAAGkX,GAAAhX,YAAA+W,GAAA,GAAhDE,GAAcD,GAAA,GAAEE,GAAgBF,GAAA,GAAAG,GACHrX,mBAAS,IAAGsX,GAAApX,YAAAmX,GAAA,GAAzCE,GAAUD,GAAA,GAAEE,GAAaF,GAAA,GAAAG,GACEzX,mBAAS,IAAG0X,GAAAxX,YAAAuX,GAAA,GAAvC9a,GAAS+a,GAAA,GAAEC,GAAYD,GAAA,GAAAE,GACM5X,mBAAS,IAAG6X,GAAA3X,YAAA0X,GAAA,GAAzCE,GAAUD,GAAA,GAAEE,GAAaF,GAAA,GAI5BG,IAAa,EAGjB,IACEnC,GAAe3K,GAAmB,SAAQ,KAC1C4K,GAAmB5K,GAAmB,SAAY,SAClD,MAAA+M,IACAD,IAAa,EAGf,IAAAE,GACgClY,mBAASkL,GAAmB,UAAEiN,GAAAjY,YAAAgY,GAAA,GAAvD3Z,GAAQ4Z,GAAA,GAAEC,GAAWD,GAAA,GAEtBla,GAAe,CACnB,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAGF,QAAiBS,IAAbH,IAA8C,IAApBA,GAASJ,OAAc,CAGnD,IAQMka,GARS5Y,GAAe,SAAEJ,IAAI,SAACmN,GAAI,OAAKA,EAAK,KAGvBlN,OAAO,SAACb,EAAOK,EAAOwZ,GAChD,OAAOA,EAAKtZ,QAAQP,KAAWK,IAIIO,IAAI,SAAChB,EAAOS,GAAK,MAAK,CAACT,EAAK,GAAAwB,OAAK5B,GAAaa,EAAQb,GAAaE,YAExGL,QAAQC,IAAIsa,IAGZD,GAAYC,IAId,IAAI5P,GAAe,GAEnBpI,oBAAU,WACR,IAAK,IAAIqG,EAAI,EAAGA,EAAInI,GAASJ,OAAQuI,IACnC+B,GAAalK,GAASmI,GAAG,IAAMnI,GAASmI,GAAG,IAE5C,CAACnI,KAEJ8B,oBAAU,WACRmS,KACA6D,GAAQ5W,GAAW,MACnBgX,GAAgBhX,GAAe,UAC/BmX,GAAanX,GAAgB,WAC7BkQ,EAAM1H,eAAeuB,QAAQ,OAC7BsG,EAAS7H,eAAeuB,QAAQ,eAEJ9K,IAAxBe,GAAkB,aACpBkY,GAAalY,GAAkB,cAEhC,CAACL,KAEJiB,oBAAU,WACRoU,GAAcvJ,GAAoB,UAAE7L,IAAI,SAACZ,EAAOK,GAAY,OAAOL,EAAY,SAC9E,CAACyM,KAEJ7K,oBAAU,WACHmU,GAAWjX,SAAS6B,MACvB6L,EAAY,WAAYuJ,GAAW,IACnCM,GAAYN,GAAW,KAGpBA,GAAWjX,SAAS0X,MACvBhK,EAAY,YAAauJ,GAAW,IACpCU,GAAaV,GAAW,MAEzB,CAACA,KAEJ,IAAI+D,GAAYrN,GAAc,IA8B1BsN,GAAW,SAACC,GACD,YAAT/Y,IAA+B,WAATA,IACxBsL,GAAiB,YAATtL,GAAqB,MAAQ,UACpB,IAAb+Y,IACFtE,GAAQC,IACRU,GAAYG,IACZK,GAAUG,IACVY,GAAQjC,GAAY,MACpBqC,GAAgBrC,GAAgB,UAChCwC,GAAaxC,GAAiB,gBAED1V,IAAzB0V,GAAmB,aACrBuD,GAAalY,GAAkB,cAGnCwL,EAAY,OAAQ,QAEpB1D,OAAOC,SAAQ,GAAA3H,OAAM0H,OAAOC,SAASkR,SAAQ,MAAA7Y,OAAK0H,OAAOC,SAASmR,KAAI,kBAI1EtY,oBAAU,WACJ+T,KACF4C,GAAS5C,GAAY,MACrBgD,GAAiBhD,GAAgB,UACjCoD,GAAcpD,GAAiB,gBAEF1V,IAAzB0V,GAAmB,aACrB2D,GAActY,GAAkB,eAGnC,CAAC2U,KAEJ/T,oBAAU,WACR6P,EAAOjI,eAAeuB,QAAQ,QAC9B8G,EAAUrI,eAAeuB,QAAQ,YAChC,CAACuN,KAGJ1W,oBAAU,WACRiR,EAAkB,SAAAsH,GAAW,OAAIA,EAAc,KAC9C,CAAClZ,KAEJ,IAsBImZ,GAAU,SAAC/Z,GACbqM,GAAO7F,UAAU,iBAAkB,CAAExG,WAGnCga,GAAc,SAACha,GACjBqM,GAAO7F,UAAU,cAAe,CAACxG,WAGnCuB,oBAAU,WACRsP,EAAM1H,eAAeuB,QAAQ,OAC7BsG,EAAS7H,eAAeuB,QAAQ,UAChC0G,EAAOjI,eAAeuB,QAAQ,QAC9B8G,EAAUrI,eAAeuB,QAAQ,WACjCiH,EAASxI,eAAeuB,QAAQ,UAChCqH,EAAY5I,eAAeuB,QAAQ,aACnCgJ,KAEA1O,SAASiF,iBAAiB,UAAWgQ,KACpC,IAGH,IAAAC,GAC4BhZ,mBAAS,CACnCiZ,UAAW,GACX1W,YAAW,SAAC2W,GACV5Q,KAAK2Q,UAAUhc,KAAKic,IAEtBC,eAAc,SAACD,GACb5Q,KAAK2Q,UAAY3Q,KAAK2Q,UAAU3Z,OAAO,SAAA8Z,GAAQ,OAAIA,IAAaF,KAElE5T,UAAS,SAAC9C,EAAWC,GACnB6F,KAAK2Q,UAAUlc,QAAQ,SAACqc,GACtBA,EAAS5W,EAAWC,QAGxB4W,GAAAnZ,YAAA8Y,GAAA,GAbK7N,GAAMkO,GAAA,GAebC,IAfwBD,GAAA,GAgBsBrZ,oBAAS,IAAMuZ,GAAArZ,YAAAoZ,GAAA,GAAtDE,GAAeD,GAAA,GAAEE,GAAkBF,GAAA,GAAAG,GACkB1Z,oBAAS,GAAM2Z,GAAAzZ,YAAAwZ,GAAA,GAApEE,GAAsBD,GAAA,GAAEE,GAAyBF,GAAA,GAExD,SAAS1F,KACP4F,IAA2BD,IAG7B,SAASE,KACPL,IAAoBD,IAOtB,SAAST,GAAenV,GACJ,MAAdA,EAAMoF,MAERlL,QAAQC,IAAI,kBACZ+b,MAQJ,OACEle,IAAAC,cAAA,OAAKC,UAAU,OACbF,IAAAC,cAAC0R,EAAS,CAACC,YAAagM,GAAiB/L,YAAaqM,KACtDle,IAAAC,cAACoS,EAAgB,CAACT,YAAaoM,GAAwBnM,YAAawG,KAC1D,WAATvU,IAA8B,WAATA,GACpB9D,IAAAC,cAAA,OAAKC,UAAU,iBAAiBsQ,QA5FpB,SAACxI,GACJ,YAATlE,IACFsL,GAAQ,UACRC,EAAY,OAAQ,YAEpBD,GAAQ,UACRC,EAAY,OAAQ,aAsFoCrP,IAAAC,cAAA,KAAGC,UAAU,aAAYF,IAAAC,cAAA,SAAG,OAChFD,IAAAC,cAAAD,IAAAgR,SAAA,MACO,WAATlN,IAA8B,WAATA,GACrB9D,IAAAC,cAACkP,EAAY,CACX/B,IAAKqI,EACL3R,KAAMA,GACNsL,QAASA,GACTC,YAAaA,EACbC,SAAUA,GACV3M,SAAUA,GACV6M,MAAOA,EACPwF,SAAUA,EACVzF,OAAQA,GACRxC,oBA7eR,SAA6BoR,GAAS,IAAAC,EACbD,EAAQrS,MAAM,MAAKuS,EAAA/Z,YAAA8Z,EAAA,GAArCra,EAAMsa,EAAA,GAAEra,EAAMqa,EAAA,GACnB,GAAe,UAAXta,EAAoB,CAGtB,GAFA7B,QAAQC,IAAI,UAER+K,EAAcvL,SAASwc,GAAU,CACnC,IAAMG,EAAepR,EAAcxJ,OAAO,SAAChC,GAAI,OAAKA,IAASyc,IAC7DrO,EAAiBwO,GACjBpO,GAAc,GAAAjM,OAAA4J,YAAKoC,IAAW,yBAAAhM,OAA0Bka,WAExDjO,GAAc,GAAAjM,OAAA4J,YAAKoC,IAAW,iBAAAhM,OAAkBka,MAGlDtO,EAAe,GAAA5L,OAAA4J,YAAK6B,GAAY,CAAEyO,UAElCjc,QAAQC,IAAI,eACZD,QAAQC,IAAIwN,IACZO,GAAc,GAAAjM,OAAA4J,YAAKoC,IAAW,iBAAAhM,OAAkBD,MAChD+L,GAAe,GAAA9L,OAAA4J,YAAK8B,IAAY,CAAE3L,MA4d9BgJ,qBAxdR,SAA8BmR,GAAS,IAAAI,EACdJ,EAAQrS,MAAM,MAAK0S,EAAAla,YAAAia,EAAA,GAArCxa,EAAMya,EAAA,GAAExa,EAAMwa,EAAA,GACnB,GAAe,UAAXza,EACF,GAAImJ,EAAcvL,SAASwc,GAAU,CACnCjc,QAAQC,IAAI,SAEZ,IAAMmc,EAAepR,EAAcxJ,OAAO,SAAChC,GAAI,OAAKA,IAASyc,IAC7DrO,EAAiBwO,GACjBpO,GAAc,GAAAjM,OAAA4J,YAAKoC,IAAW,iBAAAhM,OAAkBka,WAEhDjc,QAAQC,IAAI,WACZ+N,GAAc,GAAAjM,OAAA4J,YAAKoC,IAAW,kBAAAhM,OAAmBka,MACjDrO,EAAgB,GAAA7L,OAAA4J,YAAKX,GAAa,CAAEiR,UAGtCjc,QAAQC,IAAI,gBACZ+N,GAAc,GAAAjM,OAAA4J,YAAKoC,IAAW,kBAAAhM,OAAmBD,MACjDgM,GAAgB,GAAA/L,OAAA4J,YAAK+B,IAAa,CAAE5L,MAwchCyL,UApcR,WACEI,EAAgB,IAChBC,EAAiB,IACjBC,GAAgB,IAChBC,GAAiB,IACjBE,GAAe,KAgcTjD,MAAOA,GACPyC,aAAcA,EACdxC,cAAeA,EACfyC,aAAcA,GACdC,cAAeA,GACfC,gBAAiBA,EACjBC,iBAAkBA,EAClBC,gBAAiBA,GACjBC,iBAAkBA,GAClBC,YAAaA,GACbC,eAAgBA,KACblQ,IAAAC,cAAAD,IAAAgR,SAAA,MACPhR,IAAAC,cAAA,OAAKC,UAAS,cAAA+D,OAAyB,YAATH,GAAqB,MACxC,WAATA,GAAoB,UACT,WAATA,GAAoB,UAClB,KAEJ9D,IAAAC,cAAA,OAAKC,UAAU,gBACbF,IAAAC,cAAA,SAAOC,UAAU,iBAAiBue,QAAQ,aACxCze,IAAAC,cAAA,SAAGD,IAAAC,cAAA,SAAG,iBACJD,IAAAC,cAAA,UACEgG,KAAK,YACLpF,GAAG,YACH6d,SA1MU,SAAC1W,GACvBqH,EAAY,WAAYrH,EAAMhE,OAAOnB,OACrCqW,GAAYlR,EAAMhE,OAAOnB,OACzB0V,GAAQjJ,GAAoB,UAAE5L,OAAO,SAACkN,GAAW,OAAOA,EAAW,OAAM5I,EAAMhE,OAAOnB,QAAS,KAwMnFA,MAAOW,IAENoV,GAAWnV,IAAI,SAAAkb,GAAC,OAAI3e,IAAAC,cAAA,UAAQmN,IAAKuR,EAAG9b,MAAO8b,GAAIA,SAK3C,YAAT7a,IAA+B,WAATA,IAA8B,WAATA,GAC3C9D,IAAAC,cAAA,KAAGC,UAAU,iBAAgBF,IAAAC,cAAA,SAAG,gCAChCD,IAAAC,cAAAD,IAAAgR,SAAA,MACQ,WAATlN,GACC9D,IAAAC,cAAA,QAAMuQ,QAASoM,GAASgC,KAAK,KAAM,GAAIve,MAAO,CAAEC,eAAgB,OAAQC,MAAO,UAAUP,IAAAC,cAAA,KAAGC,UAAU,oBAAmBF,IAAAC,cAAA,SAAG,SAC1HD,IAAAC,cAAAD,IAAAgR,SAAA,OAENhR,IAAAC,cAAA,OAAKC,eAAyB4C,IAAd6Z,GAA0B,sBAAwB,cAChE3c,IAAAC,cAAA,OAAKC,UAAS,uBAAA+D,OAAmC,YAATH,IAA+B,WAATA,GAAqB,OAAS,KAC1F9D,IAAAC,cAAA,KAAGC,UAAU,cAAaF,IAAAC,cAAA,SAAG,oBAC7BD,IAAAC,cAAA,KAAGC,UAAU,iBAAe,WAAA+D,OAAakI,IACzCnM,IAAAC,cAAA,KAAGC,UAAU,oBAAkB,WAAA+D,OAAamI,IAC5CpM,IAAAC,cAAA,UAAQ6D,KAAK,SAAS5D,UAAU,oBAAoBsQ,QA7I/C,SAACxI,GACd,IAAIiC,EAA6C,SAAnCwB,GAAgBO,IAAI,WAClCqD,EAAY,WAAYpF,GACxByP,IAAWzP,KA0IoE,UACvEjK,IAAAC,cAAA,UAAQ6D,KAAK,SAAS5D,UAAU,0BAA0BsQ,QAAS,kBAAMyM,GAAQ,KAAI,SACrFjd,IAAAC,cAAC6J,EAAS,CAACsD,IAAKqI,EAAgBlU,KAAMA,GAAMiC,SAAUoX,GAAejY,SAAUA,GAAUuB,UAAWA,GAAWwC,OAAQ6I,GAAQtF,QAASwP,MAE1IzZ,IAAAC,cAAA,OAAKC,UAAS,mBAAA+D,OAA+B,YAATH,IAA+B,WAATA,GAAqB,OAAS,KACxF9D,IAAAC,cAAA,KAAGC,UAAU,cACRkc,GAECpc,IAAAC,cAAAD,IAAAgR,SAAA,KACEhR,IAAAC,cAAA,UACEI,MAAO,CAAEoJ,WAAaoM,EAAmB,SAAT,QAChCrF,QA/elB,WACMqF,GAASC,IAAYD,KA+eV,eAES,IAAI,IACZ,IACF7V,IAAAC,cAAA,UACEI,MAAO,CAAEoJ,WAAYoM,EAAU,OAAS,UACxCrF,QA1flB,WACOqF,GAASC,IAAYD,KA0fX,eAMH7V,IAAAC,cAAA,SAAG,gBAGPD,IAAAC,cAAA,UAAQ6D,KAAK,SAAS5D,UAAU,2BAA2BsQ,QAAS,kBAAM0M,GAAY,KAAI,SAC1Fld,IAAAC,cAAC+B,EAAU,CACToL,IAAKqI,EACLlU,KAAOsU,EAAiBoE,GAAP1Y,GACjBiC,SAAWqS,EAA0BqE,GAAhBU,GACrBjY,SAAUA,GACV+D,OAAQ6I,GACRvF,SAAmB,WAATlG,IAA8B,WAATA,GAC/BZ,MAAO,EACPnC,UAAWA,GACXE,OAAQ4U,OAIL,YAAT/R,IAA+B,WAATA,GACtB9D,IAAAC,cAAA,OAAKC,UAAS,cAAA+D,OAAyB,YAATH,GAAqB,UAAY,cAC7D9D,IAAAC,cAAA,OAAKC,UAAU,gBACbF,IAAAC,cAAA,SAAOC,UAAU,iBAAiBue,QAAQ,aACxCze,IAAAC,cAAA,SAAGD,IAAAC,cAAA,SAAG,iBACJD,IAAAC,cAAA,UACEgG,KAAK,YACLpF,GAAG,YACH6d,SA1QS,SAAC1W,GACxBqH,EAAY,YAAarH,EAAMhE,OAAOnB,OACtCyW,GAAatR,EAAMhE,OAAOnB,OAC1B4V,GAASnJ,GAAoB,UAAE5L,OAAO,SAACkN,GAAW,OAAOA,EAAW,OAAM5I,EAAMhE,OAAOnB,QAAS,KAwQlFA,MAAOwW,IAENT,GAAWnV,IAAI,SAAAkb,GAAC,OAAI3e,IAAAC,cAAA,UAAQmN,IAAKuR,EAAG9b,MAAO8b,GAAIA,SAKtD3e,IAAAC,cAAA,QAAMuQ,QAASoM,GAASgC,KAAK,KAAM,GAAIve,MAAO,CAAEC,eAAgB,OAAQC,MAAO,UAAWP,IAAAC,cAAA,KAAGC,UAAU,oBAAmBF,IAAAC,cAAA,SAAG,UAE/HD,IAAAC,cAAA,OAAKC,eAAyB4C,IAAd6Z,GAA0B,sBAAwB,cAChE3c,IAAAC,cAAA,OAAKC,UAAS,uBAAA+D,OAAmC,YAATH,IAA+B,WAATA,GAAqB,OAAS,KAC1F9D,IAAAC,cAAA,KAAGC,UAAU,cAAaF,IAAAC,cAAA,SAAG,oBAC7BD,IAAAC,cAAA,KAAGC,UAAU,iBAAe,WAAA+D,OAAaoQ,IACzCrU,IAAAC,cAAA,KAAGC,UAAU,oBAAkB,WAAA+D,OAAawQ,IAC5CzU,IAAAC,cAAA,UAAQ6D,KAAK,SAAS5D,UAAU,oBAAoBsQ,QAxMhD,SAACxI,GACf,IAAI6W,EAA+C,SAApCpT,GAAgBO,IAAI,YACnCqD,EAAY,YAAawP,GACzB/E,IAAY+E,KAqMsE,UACxE7e,IAAAC,cAAA,UAAQ6D,KAAK,SAAS5D,UAAU,0BAA0BsQ,QAAS,kBAAMyM,GAAQ,KAAI,SACrFjd,IAAAC,cAAC6J,EAAS,CAACsD,IAAKqI,EAAgBlU,KAAM4Z,GAAO3X,SAAU+X,GAAgB5Y,SAAUA,GAAUuB,UAAWyX,GAAYjV,OAAQ6I,GAAQvF,UAAU,EAAMC,QAAS4P,MAE7J7Z,IAAAC,cAAA,OAAKC,UAAS,mBAAA+D,OAA+B,YAATH,IAA+B,WAATA,GAAqB,OAAS,KACtF9D,IAAAC,cAAA,KAAGC,UAAU,cAAckc,GAEzBpc,IAAAC,cAAAD,IAAAgR,SAAA,KACEhR,IAAAC,cAAA,UACEI,MAAO,CAAEoJ,WAAawM,GAAmB,SAAT,QAChCzF,QAviBlB,WACMyF,IAASC,IAAYD,MAuiBV,eAES,IAAI,IACZ,IACFjW,IAAAC,cAAA,UACEI,MAAO,CAAEoJ,WAAYwM,GAAU,OAAS,UACxCzF,QAljBlB,WACOyF,IAASC,IAAYD,MAkjBX,eAMHjW,IAAAC,cAAA,SAAG,gBAELD,IAAAC,cAAA,UAAQ6D,KAAK,SAAS5D,UAAU,2BAA2BsQ,QAAS,kBAAM0M,GAAY,KAAI,SAC1Fld,IAAAC,cAAC+B,EAAU,CACToL,IAAKqI,EACLlU,KAAO0U,GAAkBgE,GAARkB,GACjB3X,SAAWyS,GAA2BiE,GAAjBqB,GACrB5Y,SAAUA,GACV+D,OAAQ6I,GACRvF,UAAU,EACV9G,MAAO,EACPnC,UAAWmb,GACXjb,OAAQgV,QAIhBjW,IAAAC,cAAAD,IAAAgR,SAAA,MACQ,YAATlN,IAA+B,WAATA,GACrB9D,IAAAC,cAAA,OAAKC,UAAU,gBAAgBsQ,QA7TxB,SAACxI,GAEC,WAATlE,IACFuL,EAAY,OAAQ,UACpBD,GAAQ,YAERC,EAAY,OAAQ,WACpBD,GAAQ,YAEVC,EAAY,YAAa7L,IACzB8V,GAAa9V,IACbiV,GAASnJ,GAAoB,UAAE5L,OAAO,SAACkN,GAAW,OAAOA,EAAW,OAAMpN,KAAY,IACtF8Q,EAAOjI,eAAeuB,QAAQ,QAC9B8G,EAAUrI,eAAeuB,QAAQ,aAgTmB5N,IAAAC,cAAA,KAAGC,UAAU,aAAYF,IAAAC,cAAA,SAAG,OAC1ED,IAAAC,cAAAD,IAAAgR,SAAA,sPCxlBK8N,OAzLf,WAMI,IAUIC,EAAY,CACdC,GAAMA,EACNC,IAAOA,EACPC,IAAOA,EACPC,IAAOA,EACPC,IAAOA,EACPC,IAAOA,EACPC,aAAgBA,GAChBC,aAAgBA,GAChBC,SAAYA,GACZC,aAAgBA,GAChBC,aAAgBA,GAChBC,aAAgBA,GAChBC,aAAgBA,GAChBC,aAAgBA,GAChBC,aAAgBA,GAChBC,aAAgBA,GAChBC,aAAgBA,GAChBC,UAAaA,GACbC,QAAWA,IAITC,EAAmB,CAAC,KAAM,MAAO,MAAO,MAAO,MAAO,MAAO,eAAgB,eAAgB,WAAY,eAAgB,eAAgB,eAAgB,eAAgB,eAAgB,eAAgB,eAAgB,eAAgB,YAAa,WACtPC,EAAe,CAAC,eAAgB,cAAe,cAAe,cAAe,cAAe,cAAe,iBAAkB,iBAAkB,iBAAkB,iBAAkB,iBAAkB,iBAAkB,iBAAkB,iBAAkB,iBAAkB,iBAAkB,iBAAkB,iBAAkB,WACnUC,EAAe,GACfC,GAAc,EAKlBjU,eAAeC,QAAQ,WAAYoB,KAAKsK,UAAU,IAAIzL,EAAY,KAClEF,eAAeC,QAAQ,aAAcoB,KAAKsK,UAAU,IAAIzL,EAAY,KAGpE,IADA,IAAAgU,EAAA,SAAAzV,GAGQ0V,EAAoBJ,EAAatV,GACjC2V,EAAiBH,EAXV,UACA,UAYPI,EAAOC,EAJPC,EAAkBT,EAAiBrV,IAMvCuV,EAAahf,KACXrB,IAAAC,cAACE,IAAI,CAACC,GAAIsgB,EAAMxgB,UAAU,eAAesQ,QAAS,WAAOnE,eAAeC,QAAQ,YAAaoB,KAAKsK,UAAU+G,EAAUoB,EAAiBrV,QACrI9K,IAAAC,cAAA,OAAKC,UAAU,qBACbF,IAAAC,cAAA,OAAKC,UAAU,cAAcG,MAAO,CAAEwE,gBAAiB4b,IACnDzgB,IAAAC,cAAA,SAAGD,IAAAC,cAAA,SAAIugB,KAEXxgB,IAAAC,cAAA,OAAKC,UAAU,eAAeG,MAAO,CAAEwE,gBAAiB4b,IACpDzgB,IAAAC,cAAA,KAAGC,UAAU,UAASF,IAAAC,cAAA,SAAI2gB,IAC5B5gB,IAAAC,cAAA,OACEC,UAAU,UACVQ,IAAKmgB,IACLjgB,IAAI,WACJ4P,QAAS,kBAhEDsQ,EAgEqB,2EAAA7c,OAA4Ekc,EAAiBrV,GAAE,KAAA7G,OAAIkc,EAAiBrV,GAAE,SAhEtIiW,EAgEsI,GAAA9c,OAAYkc,EAAiBrV,GAAE,cA/D9LkW,IAAMhV,IAAI8U,EAAK,CACbG,aAAc,SAEfC,KAAK,SAACC,GACLC,IAAaD,EAAItd,KAAMkd,KALN,IAACD,EAAKC,SAwEvBT,GAAeA,GA3BVxV,EAAI,EAAGA,EAAIqV,EAAiB5d,OAAQuI,IAAG,KAAA8V,EAAAJ,EAAAC,EAAAC,EAAAH,EAAAzV,GA6DhD,OACI9K,IAAAC,cAAA,OAAKC,UAAU,QACXF,IAAAC,cAAA,OAAKC,UAAU,cACXF,IAAAC,cAAA,OAAKC,UAAU,iBACbF,IAAAC,cAAA,UAAID,IAAAC,cAAA,SAAG,sBAEPD,IAAAC,cAAA,OAAKC,UAAU,cACbF,IAAAC,cAAA,SAAGD,IAAAC,cAAA,SAAG,uCAAoCD,IAAAC,cAAA,KAAGQ,KAAK,qDAAoD,aAAa,YAAY,gSAG/HT,IAAAC,cAACE,IAAI,CAACC,GAAG,QAAQC,MAAO,CAAEC,eAAgB,OAAQC,MAAO,UACvDP,IAAAC,cAAA,UAAQC,UAAU,gBAAe,kBAOvCF,IAAAC,cAAA,OAAKC,UAAU,iBACbF,IAAAC,cAAA,OAAKC,UAAU,gCACbF,IAAAC,cAAA,UAAI,YACJD,IAAAC,cAAA,OAAKC,UAAU,qBACXF,IAAAC,cAAA,OAAKC,UAAU,cAAcG,MAAO,CAAEwE,gBAAiB,YACnD7E,IAAAC,cAAA,KAAGC,UAAU,eAAeG,MAAO,CAACE,MAAO,UAAUP,IAAAC,cAAA,SAAG,aAE5DD,IAAAC,cAAA,OAAKC,UAAU,cAAcG,MAAO,CAAEwE,gBAAiB,YACrD7E,IAAAC,cAACE,IAAI,CAACC,GAAIsgB,EAAMrgB,MAAO,CAAEC,eAAgB,OAAQC,MAAO,UACtDP,IAAAC,cAAA,KAAGC,UAAU,eAAeG,MAAO,CAACE,MAAO,UAAUP,IAAAC,cAAA,SAAG,gBAKlED,IAAAC,cAAA,OAAKC,UAAU,0BASXmgB,EAAa5c,IAAI,SAACoN,EAAM3N,GAAK,OAC3BlD,IAAAC,cAACD,IAAMgR,SAAQ,CAAC5D,IAAKlK,GAClB2N,QAQf7Q,IAAAC,cAAA,WACED,IAAAC,cAAA,SACE6D,KAAK,OACLjD,GAAG,cACHoF,KAAK,cACLob,OAAO,mBACP3C,SAnFO,SAAC1T,GAElB,IAEIsW,EAFEC,EAAS,IAAIC,WACbC,EAAOzW,EAAEhH,OAAO0d,MAAM,GAG5BH,EAAOI,OAAS,SAASC,GAEvB,IAAIC,EAAaD,EAAU5d,OAAO8d,OAClCR,EAAgBO,EAChB,IAGIE,EAHSrU,KAAKC,MAAM2T,GAGS,UAAE7d,IAAI,SAACZ,EAAOK,GAAW,OAAOL,EAAY,OAG7EwJ,eAAeC,QAAQ,YAAagV,GAGpC3V,OAAOC,SAAWD,OAAOC,SAAQ,gBAAA3H,OAAmB8d,EAAW,KAGjER,EAAOS,WAAWP,MA8DVzhB,IAAAC,cAAA,SAAOwe,QAAQ,eACbze,IAAAC,cAAA,OAAKY,GAAG,SAASX,UAAU,OACzBF,IAAAC,cAAA,MAAIC,UAAU,QAAO,KACrBF,IAAAC,cAAA,QAAMC,UAAU,eAAcF,IAAAC,cAAA,SAAG,6CCrKpCgiB,OA/Bf,WAKE,OAJAC,aAAqB,CACnBC,SAAU,iBAIVniB,IAAAC,cAAA,OAAKC,UAAU,OACXF,IAAAC,cAACmiB,KAAM,KACLpiB,IAAAC,cAACoiB,KAAK,CAACC,KAAK,UACVtiB,IAAAC,cAACF,EAAK,OAERC,IAAAC,cAACoiB,KAAK,CAACC,KAAK,QACVtiB,IAAAC,cAAC6T,EAAG,OAEN9T,IAAAC,cAACoiB,KAAK,CAACC,KAAK,oBACVtiB,IAAAC,cAACF,EAAK,OAERC,IAAAC,cAACoiB,KAAK,CAACC,KAAK,kBACVtiB,IAAAC,cAAC6T,EAAG,OAEN9T,IAAAC,cAACoiB,KAAK,CAACC,KAAK,cACVtiB,IAAAC,cAAC6e,GAAI,OAEP9e,IAAAC,cAACoiB,KAAK,CAACE,OAAK,EAACD,KAAK,KAChBtiB,IAAAC,cAAC6e,GAAI,UC3BF0D,GAZS,SAAAC,GAClBA,GAAeA,aAAuBC,UACxC7iB,EAAAmL,EAAA,GAAAkW,KAAArhB,EAAA+e,KAAA,WAAqBsC,KAAK,SAAAnX,GAAiD,IAA9C4Y,EAAM5Y,EAAN4Y,OAAQC,EAAM7Y,EAAN6Y,OAAQC,EAAM9Y,EAAN8Y,OAAQC,EAAM/Y,EAAN+Y,OAAQC,EAAOhZ,EAAPgZ,QAC3DJ,EAAOF,GACPG,EAAOH,GACPI,EAAOJ,GACPK,EAAOL,GACPM,EAAQN,MCCDO,IAASC,WAAW/a,SAASpB,eAAe,SACpDoc,OACHljB,IAAAC,cAACD,IAAMmjB,WAAU,KACfnjB,IAAAC,cAACmjB,IAAM,CAACjB,SAAS,cACfniB,IAAAC,cAACgiB,GAAG,SAQVO","file":"static/js/main.ffbc6996.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/sample_page.802f465b.png\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAj0lEQVR4nO2USwrEIBAF6xJp5kg5dyQM+aySRfa5iMNAC0ISBE0v8nnQKCpVoI3wtLSAsxQ4oLEUXD8d8LUUeK1XcKMraoARkB2B6F5RV/UKnBUYBKJrXs9kRyJQGON5EBelAqYIHmoBPqXwI0kWPPUNCDBoSeLHdZYt6I845oJ15yF9Zv1Zm9QnSVZl3SQ/PmdfIXJmioIAAAAASUVORK5CYII=\"","import React from 'react';\nimport {\n    Link\n  } from \"react-router-dom\";\n\n// Figures\nimport sample_page from \"../assets/sample_page.png\";\n\n/**\n * This page is simply a description of the application with a contact list\n */\nfunction About() {\n    return (\n        <div className='about'>\n            <div className='panel about'>\n                <div className='aboutcontainer'>\n                    <p className='backarrow'><b><Link to=\"\" style={{ textDecoration: 'none', color: 'black'}}>&#8592; home</Link></b></p>\n                    <h1 className='abouttitle'>Instructions</h1>\n                </div>\n                <p><b>MACH2</b> is a personalized tool to visualize cancer metastasis. It is a sequel to MACHINA, an algorithm designed to solve the Parsimonious Migration History Problem (PMH problem).</p>\n                <p><b>The Parsimonious Migration History Problem:</b> Given current oncological mutations at their respective anatomical sites, how can we infer their mutation tree as well as a network of anatomical sites inferring metastases?</p>\n                <p><b>Visualization Format:</b></p>\n                <p>Upon selecting one of the examples on the home page, you will be redirected to the visualization page. The page showcases multiple panels. The descriptions along with an image of the panels are shown below:</p>\n                <ul style={{columns: 1}}>\n                    <li><p><b>MACH2 Solutions (right):</b>The solutions computed by MACH2 are displayed here. Change between possible solutions by selecting the drop down menu at the top of the panel. Each graph in this panel is described below:</p></li>\n                    <ul style={{columns: 1}}>\n                        <li><p><b>Clonal Tree (bottom right):</b> This is a tree of oncological mutations. Each node in this tree is a variant allele in the cancer patient. Each edge is a mutation from one variant to another.</p></li>\n                        <li><p><b>Migration Graph (top right):</b> Each node in the clonal tree has a tag with an anatomical location inferred using <a href='https://en.wikipedia.org/wiki/Maximum_parsimony_(phylogenetics)'>Maximum Parsimony</a>. The clonal tree is compressed into a migration graph where each node represents an anatomical location, and each edge is a metastasis (e.g. a migration) between two anatomical locations.</p></li>   \n                    </ul>\n                    <li><p><b>Summary (left):</b> You can also view a summary migration graph that is computed by unioning edges across migration graphs in each solution. Edges are weighted by the number of solutions they appear in.</p></li>\n                </ul>\n                <p>You can click on the long gray bars on the sides of the visualization page to add extra panels.</p>\n                <div className=\"image-container\">\n                    {/* <img className=\"aboutimg\" src={clonal} alt=\"Image 1\"/>\n                    <img className=\"aboutimg\" src={migration} alt=\"Image 2\"/> */}\n                    <img className='aboutimg' src={sample_page} alt=\"Sample Page\"></img>\n                </div>\n                <p><b>Generating inputs: </b>We have provided a <a href=\"https://github.com/vikramr2/json_compression\">json compression</a> program that takes an output directory from MACHINA that contains <b>.tree</b> files and their corresponding <b>.labeling</b> files, and returns a <b>.json</b> file that can be used as input for this visualizer. Click the \"+\" icon in the home page to use this feature. For more information, see this <a href='https://github.com/vikramr2/json_compression/blob/main/README.md'>README</a>. Output from any algorithm that solves the PMH problem will be accepted provided that it is in a JSON format as shown in the README.</p>\n                <p><b>Questions? Contact</b></p>\n                <ul id=\"singlecol\">\n                    <li><p>Vikram Ramavarapu (<a href=\"mailto:vikramr2@illinois.edu\">vikramr2@illinois.edu</a>)</p></li>\n                    <li><p>Roman Mineyev (<a href=\"mailto:mineyev2@illinois.edu\">mineyev2@illinois.edu</a>)</p></li>\n                    <li><p>Akul Joshi (<a href=\"mailto:akulj2@illinois.edu\">akulj2@illinois.edu</a>)</p></li>\n                    <li><p>Mrinmoy Roddur (<a href=\"mailto:mroddur2@illinois.edu\">mroddur2@illinois.edu</a>)</p></li>\n                    <li><p>Mohammed El-Kebir (<a href=\"mailto:melkebir@illinois.edu\">melkebir@illinois.edu</a>)</p></li>\n                </ul>\n            </div>\n        </div>\n    );\n}\n\nexport default About;","import React, { useEffect, useMemo } from 'react'\nimport { useState } from \"react\";\nimport CytoscapeComponent from 'react-cytoscapejs';\nimport Cytoscape from 'cytoscape';\nimport COSEBilkent from 'cytoscape-cose-bilkent';\nimport dagre from 'cytoscape-dagre';\n\n// Load Cytoscape submodules\nCytoscape.use(COSEBilkent);\nCytoscape.use(dagre);\n\nfunction findCorresponding(clonalMap, currNode, clonal) {\n  if (clonal) {\n    let corrNodes = [];\n    clonalMap.forEach((row) => {\n      if (row[1] === currNode) {\n        corrNodes.push(row[0]);\n      }\n    })\n    return corrNodes;\n  } else {\n    clonalMap.forEach((row) => {\n      if (row[0] === currNode) {\n        return [row[1]];\n      }\n    })\n  }\n}\n\nfunction getSubtree(tree, nodes) {\n  let edges = [];\n\n  tree.forEach((edge) => {\n    if (nodes.includes(edge[0]) && nodes.includes(edge[1])) {\n      edges.push(edge)\n    }\n  })\n\n  return edges;\n}\n\n/** This component contains the clonal tree showing the tumor phylogeny\n * \n * @param {*} props The JSX props used on this tag\n *  - coloring: (array) The coloring scheme of the tree\n *  - labeling: (array) The anatomical labels of each clone\n *  - tree:     (array) The tree topology as an edgelist\n *  - evtbus:   (obj) The event handler that is shared between graph structures\n *  - rightcol: (boolean) is this tree in the right column (for dual visualizations)\n * @returns The JSX/HTML structure of the component\n */\nfunction ClonalTree(props) {\n  console.log(props.clonalMap)\n  const width = \"100%\";\n  const height = \"100%\";\n\n  // Regex to check whether a string is a hex value representing a color\n  var hexColorRegex = /^#(?:[0-9a-fA-F]{3}){1,2}$/;\n\n  /* Default color palette\n  \n  Colorings can be specified as either:\n  - [node, index (int)]       : The second element is an index (mod length) chosen from the default color palette\n  - [node, hex color (string)]: The second element is a custom hex color */\n  const colorPalette = [\n    \"#a6cee3\",\n    \"#1f78b4\",\n    \"#b2df8a\",\n    \"#33a02c\",\n    \"#fb9a99\",\n    \"#e31a1c\",\n    \"#fdbf6f\",\n    \"#ff7f00\",\n    \"#cab2d6\",\n    \"#6a3d9a\",\n    \"#ffff99\",\n    \"#b15928\"\n  ]\n  const ncolors = colorPalette.length;\n\n  // DEFINE FUNCTIONS HERE\n\n  /** Given a clonal label, find its corresponding color in the graph\n   * \n   * @param {*} label (string) the clonal label\n   * @returns the hex value string of the color corresponding to the label\n   */\n  function getColor(label) {\n    // if (!label) return '#000';\n    // let color = props.coloring.map((value, index) => {\n    //   if (value[0] === label) return value[1]}).filter((item) => {return item != undefined})[0];\n    // return hexColorRegex.test(color) ? color : colorPalette[parseInt(color) % ncolors]\n\n    if (!label) return '#000';\n  \n    let colorValue = props.coloring.find(value => value[0] === label);\n    \n    let color = colorValue ? colorValue[1] : undefined;\n  \n    return hexColorRegex.test(color) \n      ? color \n      : colorPalette[parseInt(color) % ncolors];\n  }\n\n  /** Filter an array into only unique elements*/\n  function onlyUnique(value, index, array) {\n    return array.indexOf(value) === index;\n  }\n\n  /** Find corresponding anatomical label of clone\n   * \n   * @param {*} node clone ID\n   * @returns anatomical location of clone\n   */\n  function findLabel(node) {\n    // return props.labeling.map((value, index) => {\n    //   if (value[0] === node) return value[1]}).filter((item) => {return item != undefined})[0];\n\n    let labelPair = props.labeling.find(value => value[0] === node);\n  \n    return labelPair ? labelPair[1] : undefined;\n  }\n\n  // Define the nodes and edges of the graph\n  let nodes = props.tree.map(array => {\n    // Entry structure in tree [u, v, time] s.t. time is the temporal value of the clonal mutation \n    // Create a new array excluding the third element since \n    return array.filter((_, index) => index !== 2);\n  }).flat().filter(onlyUnique).map((value, index) => {\n    return { data: { id: value, label: findLabel(value), type: \"ip\"} };\n  });\n  let edges = props.tree.map((value, index) => {\n    return { data: { source: value[0], target: value[1], label: `${value[0]}->${value[1]}`, migration: `${findLabel(value[0])}->${findLabel(value[1])}`} }\n  })\n\n  // Set the graph as a React state\n  const [graphData, setGraphData] = useState({\n    nodes: nodes,\n    edges: edges\n  });\n\n  // Handle graph changes (this is for when we switch the solution)\n  useEffect(() => {\n    // Reset nodes and labeling\n    nodes = props.tree.map(array => {\n      return array.filter((_, index) => index !== 2);\n    }).flat().filter(onlyUnique).map((value, index) => {\n      return { data: { id: value, label: findLabel(value), type: \"ip\"} }\n    });\n\n    edges = props.tree.map((value, index) => {\n      return { data: { source: value[0], target: value[1], label: `${value[0]}->${value[1]}`, migration: `${findLabel(value[0])}->${findLabel(value[1])}`} }\n    })\n\n    // Set the graph state\n    setGraphData({\n      nodes: nodes,\n      edges: edges\n    })\n  \n  // Set this change dependent on the tree or labeling change\n  }, [props.tree, props.labeling])\n\n  // This is like CSS for the Cytoscape graph\n  let styleSheet = [\n    {\n      selector: \"node\",\n      style: {\n        backgroundColor: \"#4a56a6\",\n        width: 15,\n        height: 15,\n        label: \"data(id)\",\n        \"overlay-padding\": \"6px\",\n        \"z-index\": \"10\",\n        \"text-outline-width\": \"2px\",\n        color: \"white\",\n        fontSize: 15\n      }\n    },\n    {\n      selector: \"node:selected\",\n      style: {\n        \"border-width\": \"6px\",\n        \"border-color\": \"#AAD8FF\",\n        \"border-opacity\": \"0.5\",\n        \"background-color\": \"#77828C\",\n        width: 50,\n        height: 50,\n\n        //text props\n        \"text-outline-color\": \"#77828C\",\n        \"text-outline-width\": 8\n      }\n    },\n    {\n      selector: \"edge\",\n      style: {\n        width: 3,\n        \"line-color\": \"#AAD8FF\",\n        \"target-arrow-color\": \"#6774cb\",\n        \"target-arrow-shape\": \"triangle\",\n        \"curve-style\": \"bezier\"\n      }\n    }\n  ];\n\n  // Set the coloring dynamically in the stylesheet using the coloring props\n  props.coloring.forEach((value, index) => {\n    styleSheet.push({\n      selector: `node[label='${value[0]}']`,\n      style: {\n        backgroundColor: hexColorRegex.test(value[1]) ? value[1] : colorPalette[parseInt(value[1]) % ncolors]\n      }\n    })\n  })\n\n  // Style the edges dynamically via gradients based on the node colors\n  edges.forEach((value, index) => {\n    let source = value.data.source;\n    let target = value.data.target;\n    styleSheet.push({\n      selector: `edge[label='${source}->${target}']`,\n      style: {\n        'line-fill': 'linear-gradient',\n        'line-gradient-stop-colors': `${getColor(findLabel(source))} ${getColor(findLabel(target))}`,\n        'line-gradient-stop-positions': '33% 66%',\n        \"target-arrow-color\": `${getColor(findLabel(target))}`\n      }\n    })\n  })\n\n  // The layout encompasses node positions on load, animations, and events\n  let myCyRef;\n  const layout = {\n    name: \"dagre\",  // Dagre: Layout graph like a DAG (this is good for trees!)\n    fit: true,\n    // circle: true,\n    directed: true,\n    padding: 10,\n    // spacingFactor: 1.5,\n    animate: true,\n    animationDuration: 1000,\n    avoidOverlap: true,\n    nodeDimensionsIncludeLabels: false,\n    ready: function() {\n      // Event listener\n      const listener = (eventName, eventData) => {\n        // Respond to event from other graph here\n        // When a node ge\n        if (eventName === 'selectNodeCl') {\n          const node = myCyRef.getElementById(eventData.nodeId);\n          myCyRef.$(`edge[migration='${eventData.nodeId}']`).css({\n            width: 10\n          })\n          node.trigger('select');\n        }\n        if (eventName === 'deselectNodeCl') {\n          const node = myCyRef.getElementById(eventData.nodeId);\n          myCyRef.$(`edge[migration='${eventData.nodeId}']`).css({\n            width: 3\n          })\n          node.trigger('select');\n        }\n        if (eventName === 'hoverNodeCl') {\n          myCyRef.$(`edge[migration='${eventData.nodeId}->${eventData.nodeId}']`).css({\n            width: 10\n          })\n        }\n        if (eventName === 'dehoverNodeCl') {\n          myCyRef.$(`edge[migration='${eventData.nodeId}->${eventData.nodeId}']`).css({\n            width: 3\n          })\n        }\n        if (eventName === 'selectNodeSC') {\n          const node = myCyRef.getElementById(eventData.nodeId);\n          let label = eventData.label;\n\n          myCyRef.$(`edge[label='${label}']`).css({\n            width: 10\n          })\n          node.trigger('select');\n        }\n        if (eventName === 'deselectNodeSC') {\n          const node = myCyRef.getElementById(eventData.nodeId);\n          let label = eventData.label;\n\n          myCyRef.$(`edge[label='${label}']`).css({\n            width: 3\n          })\n          node.trigger('select');\n        }\n        if (eventName === 'hoverNodeSC') {\n          const node = myCyRef.getElementById(eventData.nodeId);\n          let source = eventData.nodeId;\n\n          myCyRef.$(`node[id='${source}']`).css({\n            width: 25,\n            height: 25\n          })\n          node.trigger('select');\n        }\n        if (eventName === 'dehoverNodeSC') {\n          const node = myCyRef.getElementById(eventData.nodeId);\n          let source = eventData.nodeId;\n\n          myCyRef.$(`node[id='${source}']`).css({\n            width: 15,\n            height: 15\n          })\n          node.trigger('select');\n        }\n        if (eventName === 'resetClonal') {\n          let index = eventData.index\n          if (index === props.index) {\n            setGraphData({\n              nodes: nodes,\n              edges: edges\n            })\n          }\n        }\n        if (eventName === 'clonalHover') {\n          let corrNodes = eventData.eventParams\n          console.log(props.index)\n\n          if (corrNodes !== undefined) {\n            corrNodes.forEach((source) => {\n              const node = myCyRef.getElementById(eventData.nodeId);\n              myCyRef.$(`node[id='${source}']`).css({\n                width: 25,\n                height: 25\n              })\n              node.trigger('select');\n            })\n\n            let subtree = getSubtree(props.tree, corrNodes);\n            subtree.forEach((edge) => {\n              myCyRef.$(`edge[label='${edge[0]}->${edge[1]}']`).css({\n                width: 10\n              })\n            })\n          }\n        }\n\n        if (eventName === 'clonalDehover') {\n          let corrNodes = eventData.eventParams\n          console.log(props.index)\n\n          if (corrNodes !== undefined) {\n            corrNodes.forEach((source) => {\n              const node = myCyRef.getElementById(eventData.nodeId);\n              myCyRef.$(`node[id='${source}']`).css({\n                width: 15,\n                height: 15\n              })\n              node.trigger('select');\n            })\n\n            let subtree = getSubtree(props.tree, corrNodes);\n            subtree.forEach((edge) => {\n              myCyRef.$(`edge[label='${edge[0]}->${edge[1]}']`).css({\n                width: 3\n              })\n            })\n          }\n        }\n      };\n      props.evtbus.addListener(listener);\n    }\n  };\n\n  // Memoization: Log the graph layout so that when states change, we dont have to recompute everything\n  const memoizedGraphComponent = useMemo(() => ( <CytoscapeComponent\n    elements={CytoscapeComponent.normalizeElements(graphData)}\n    style={{ width: width, height: height }}\n    zoomingEnabled={true}\n    maxZoom={3}\n    minZoom={0.1}\n    autounselectify={true}\n    boxSelectionEnabled={true}\n    layout={layout}\n    stylesheet={styleSheet}\n    cy={cy => {\n      myCyRef = cy;\n\n      // Here we handle events on the graph\n      cy.on('mouseover', 'node', function(event) {\n        // Get the node information\n        var node = event.target;\n        var label = node.data('label');\n        \n        // Create the div element\n        var div = document.createElement(\"div\");\n        div.setAttribute(\"class\", \"panel popup\");\n\n        div.innerHTML = `<p>${label}&nbsp;</p>`;\n      \n        // Position the div element near the node\n        const nodePos = node.position();\n        \n        // Get the container element\n        const container = cy.container();\n        const zoomLevel = cy.zoom();\n\n\n        // Get the container's absolute position on the webpage\n        const containerRect = container.getBoundingClientRect();\n\n\n        div.style.position = \"absolute\";\n        const absoluteX = containerRect.left + nodePos.x * zoomLevel + cy.pan().x + 15;\n        const absoluteY = containerRect.top + nodePos.y * zoomLevel + cy.pan().y - 15;\n\n        div.style.top = absoluteY + 'px';\n        div.style.left = absoluteX + 'px';\n      \n        // Add the div element to the page\n        document.body.appendChild(div);\n\n        const nodeId = event.target.id();\n\n        // Style the anatomical location tag on hover\n        var labeltag = document.querySelector(`#${label}`);\n        if (labeltag !== null) {\n          labeltag.style.opacity = 1;\n          labeltag.style.zIndex = 100;\n          labeltag.style.fontWeight = 'bold';\n        }\n\n        // Enlarge the node on hover\n        props.evtbus.fireEvent('hoverNodeSC', { nodeId });\n\n        if (props.clonalMap !== []) {\n          let eventParams = findCorresponding(props.clonalMap, nodeId, props.clonal);\n          props.evtbus.fireEvent('clonalHover', { eventParams })\n        }\n      });\n\n      cy.on('mouseout', 'node', function(event){\n        // Remove the div element on mouseout\n        var div = document.querySelector('.panel.popup');\n        if (document.body.contains(div)) {\n          document.body.removeChild(div);\n        }\n\n        const nodeId = event.target.id();\n\n        var node = event.target;\n        var label = node.data('label');\n\n        var labeltag = document.querySelector(`#${label}`);\n        if (labeltag !== null) {\n          labeltag.style.opacity = 0.7;\n          labeltag.style.zIndex = 1;\n          labeltag.style.fontWeight = 'normal';\n        }\n\n        // Shrink the node back to size\n        props.evtbus.fireEvent('dehoverNodeSC', { nodeId });\n\n        if (props.clonalMap !== []) {\n          let eventParams = findCorresponding(props.clonalMap, nodeId, props.clonal);\n          props.evtbus.fireEvent('clonalDehover', { eventParams })\n        }\n      });\n\n      cy.on('mouseover', 'edge', function(event) {\n        const { target } = event;\n\n        // Enlarge the edge\n        target.css({\n          width: 10\n        })\n        const nodeId = event.target.id();\n        let source = findLabel(target.data().source);\n        let sink = findLabel(target.data().target);\n        let label = target.data().label;\n\n        // Widen the edge in the migration graph as well\n        props.evtbus.fireEvent('selectNode', { nodeId, source, sink, target});\n        props.evtbus.fireEvent('selectNodeSC', { nodeId, source, sink, target, label});\n      });\n\n      cy.on('mouseout', 'edge', function(event) {\n        const { target } = event;\n\n        // Shrink edge back\n        target.css({\n          width: 3\n        })\n        const nodeId = event.target.id();\n        let source = findLabel(target.data().source);\n        let sink = findLabel(target.data().target);\n        let label = target.data().label;\n\n        // Shrink migration edge back\n        props.evtbus.fireEvent('deselectNode', { nodeId, source, sink, target});\n        props.evtbus.fireEvent('deselectNodeSC', { nodeId, source, sink, target, label});\n      });\n    }}\n    />), [graphData] )\n    return memoizedGraphComponent;\n}\n\nexport default ClonalTree;","import React, { useEffect, useMemo } from 'react'\nimport { useState } from \"react\";\nimport CytoscapeComponent from 'react-cytoscapejs';\nimport Cytoscape from 'cytoscape';\nimport COSEBilkent from 'cytoscape-cose-bilkent';\nimport dagre from 'cytoscape-dagre';\n\nCytoscape.use(dagre);\nCytoscape.use(COSEBilkent);\n\n/** Migration graph showing the anatomical cancer metastases\n * \n * @param {*} props \n * - labeling:  anatomic labeling for the nodes\n * - coloring:  coloring scheme\n * - tree:      clonal tree edgelist\n * - migration: precomputed migration graph\n * - rightcol:  Is this a dualviz right column migration graph?\n * - rotated:   Is the graph rotated?\n * @returns JSX/HTML\n */\nfunction Migration({ tree, labeling, coloring, migration, evtbus, rightcol, rotated }) {\n      var hexColorRegex = /^#(?:[0-9a-fA-F]{3}){1,2}$/;\n\n      const colorPalette = [\n        \"#a6cee3\",\n        \"#1f78b4\",\n        \"#b2df8a\",\n        \"#33a02c\",\n        \"#fb9a99\",\n        \"#e31a1c\",\n        \"#fdbf6f\",\n        \"#ff7f00\",\n        \"#cab2d6\",\n        \"#6a3d9a\",\n        \"#ffff99\",\n        \"#b15928\"\n      ]\n      const ncolors = colorPalette.length;\n    \n      const width = \"100%\";\n      const height = \"100%\";\n    \n      function onlyUnique(value, index, array) {\n        return array.indexOf(value) === index;\n      }\n    \n      function findLabel(node) {\n        const found = labeling.find(value => value[0] === node);\n        return found ? found[1] : undefined;\n        // return labeling.map((value, index) => {\n          // if (value[0] === node) return value[1]}).filter((item) => {return item !== undefined})[0];\n      }\n\n      function getColor(label) {\n        // let color = coloring.map((value, index) => {\n        //   if (value[0] === label) return value[1]}).filter((item) => {return item !== undefined})[0];\n        // return hexColorRegex.test(color) ? color : colorPalette[parseInt(color) % ncolors]\n\n        let color = coloring.find(value => value[0] === label);\n        \n        if (color) {\n          color = color[1];\n        }\n\n        return hexColorRegex.test(color) ? color : colorPalette[parseInt(color) % ncolors];\n      }\n    \n      // The difference between this and the Clonal Tree is that the nodes are anatomical locations instead of clones\n      let nodes = tree.map(array => {\n        // Create a new array excluding the third element\n        return array.filter((_, index) => index !== 2);\n      }).flat().filter(onlyUnique).map((value, index) => {\n        return { data: { id:  findLabel(value), label: findLabel(value), type: \"ip\"} };\n      });\n      let edges = migration.map((value, index) => {\n        return { data: { source: value[0], target: value[1], label: value[2], id: `${value[0]}->${value[1]}`, clsource: value[0], cltarget: value[1] } }\n      })\n      for (const [i, edge] of edges.entries()) {\n        // eslint-disable-next-line eqeqeq\n        if (edge.data.label == 1) {\n          edges[i].data.label = \"\";\n        }\n      }\n    \n      const [graphData, setGraphData] = useState({\n        nodes: nodes,\n        edges: edges\n      });\n\n      let myCyRef;\n\n      // Likewise switch the graph data when any of the props values change\n      useEffect(() => {\n        let nodes = tree.map(array => {\n          // Create a new array excluding the third element\n          return array.filter((_, index) => index !== 2);\n        }).flat().filter(onlyUnique).map((value, index) => {\n          return { data: { id:  findLabel(value), label: findLabel(value), type: \"ip\"} };\n        });\n        let edges = migration.map((value, index) => {\n          return { data: { source: value[0], target: value[1], label: value[2], id: `${value[0]}->${value[1]}`, clsource: value[0], cltarget: value[1] } }\n        })\n        for (const [i, edge] of edges.entries()) {\n          // eslint-disable-next-line eqeqeq\n          if (edge.data.label == 1) {\n            edges[i].data.label = \"\";\n          }\n        }\n        setGraphData({\n          nodes: nodes,\n          edges: edges\n        })\n      }, [tree, labeling, migration, rotated])\n\n      let styleSheet = [\n        {\n          selector: \"node\",\n          style: {\n            backgroundColor: \"#fff\",\n            'border-width': 10,\n            shape: \"rectangle\",\n            width: 100,\n            height: 50,\n            label: \"data(label)\",\n    \n            // \"width\": \"mapData(score, 0, 0.006769776522008331, 20, 60)\",\n            // \"height\": \"mapData(score, 0, 0.006769776522008331, 20, 60)\",\n            // \"text-valign\": \"center\",\n            // \"text-halign\": \"center\",\n            \"overlay-padding\": \"6px\",\n            \"z-index\": \"10\",\n            //text props\n            //\"text-outline-color\": \"#4a56a6\",\n            \"text-outline-width\": \"2px\",\n            color: \"white\",\n            fontSize: 15,\n            'text-valign': 'center',\n            'text-halign': 'center'\n          }\n        },\n        {\n          selector: \"node:selected\",\n          style: {\n            \"border-width\": \"6px\",\n            \"border-color\": \"#AAD8FF\",\n            \"border-opacity\": \"0.5\",\n            \"background-color\": \"#77828C\",\n            width: 50,\n            height: 50,\n            //text props\n            \"text-outline-color\": \"#77828C\",\n            \"text-outline-width\": 8\n          }\n        },\n        {\n          selector: \"node[type='device']\",\n          style: {\n            shape: \"rectangle\"\n          }\n        },\n        {\n          selector: \"edge\",\n          style: {\n            width: 3,\n            // \"line-color\": \"#6774cb\",\n            label: \"data(label)\",\n            \"target-arrow-color\": \"#6774cb\",\n            \"target-arrow-shape\": \"triangle\",\n            \"curve-style\": \"bezier\",\n            \"text-outline-width\": \"2px\",\n            color: \"white\",\n            fontSize: 15\n          }\n        }\n      ];\n      \n      coloring.forEach((value, index) => {\n        styleSheet.push({\n          selector: `node[label='${value[0]}']`,\n          style: {\n            'border-color': hexColorRegex.test(value[1]) ? value[1] : colorPalette[parseInt(value[1]) % ncolors]\n          }\n        });\n      });\n\n      edges.forEach((value, index) => {\n        let source = value.data.source;\n        let target = value.data.target;\n        styleSheet.push({\n          selector: `edge[id='${source}->${target}']`,\n          style: {\n            'line-fill': 'linear-gradient',\n            'line-gradient-stop-colors': `${getColor(source)} ${getColor(target)}`,\n            'line-gradient-stop-positions': '33% 66%',\n            \"target-arrow-color\": `${getColor(target)}`\n          }\n        })\n      })\n\n      // Is the migration graph rotated?\n      const queryParameters = new URLSearchParams(window.location.hash.split(\"?\")[1]);\n      let is_rotated = rightcol ? queryParameters.get(\"rotated2\") === \"true\" : queryParameters.get(\"rotated\") === \"true\";\n      if (is_rotated === null) {\n        is_rotated = false;\n      }\n\n      const layout = {\n        name: \"dagre\",\n        fit: true,\n        circle: true,\n        directed: true,\n        padding: 10,\n        // spacingFactor: 1.5,\n        animate: true,\n        animationDuration: 1000,\n        avoidOverlap: true,\n        nodeDimensionsIncludeLabels: false,\n\n        // Position the nodes based on the rotated parameter\n        transform: (node, position) => {\n          return {\n            x: rotated ? -2*position.y : position.x,\n            y: rotated ? position.x : position.y\n          }\n        },\n\n        ready: function() {\n          const listener = (eventName, eventData) => {\n            // Respond to event from other graph here\n            // For example:\n            if (eventName === 'selectNode') {\n              const node = myCyRef.getElementById(eventData.nodeId);\n              let source = eventData.source;\n              let target = eventData.sink;\n              myCyRef.$(`edge[id='${source}->${target}']`).css({\n                width: 10\n              })\n              node.trigger('select');\n            }\n            if (eventName === 'deselectNode') {\n              const node = myCyRef.getElementById(eventData.nodeId);\n              let source = eventData.source;\n              let target = eventData.sink;\n              myCyRef.$(`edge[id='${source}->${target}']`).css({\n                width: 3\n              })\n              node.trigger('select');\n            }\n            if (eventName === 'selectNodeSum') {\n              const edge = myCyRef.getElementById(eventData.nodeId);\n              myCyRef.$(`edge[id='${eventData.nodeId}']`).css({\n                width: 10\n              })\n              edge.trigger('select');\n            }\n            if (eventName === 'deselectNodeSum') {\n              const edge = myCyRef.getElementById(eventData.nodeId);\n              myCyRef.$(`edge[id='${eventData.nodeId}']`).css({\n                width: 3\n              })\n              edge.trigger('select');\n            }\n            if (eventName === 'hoverNodeSum') {\n              const edge = myCyRef.getElementById(eventData.nodeId);\n              myCyRef.$(`node[id='${eventData.nodeId}']`).css({\n                'border-width': 20,\n              })\n              edge.trigger('select');\n            }\n            if (eventName === 'dehoverNodeSum') {\n              const edge = myCyRef.getElementById(eventData.nodeId);\n              myCyRef.$(`node[id='${eventData.nodeId}']`).css({\n                'border-width': 10,\n              })\n              edge.trigger('select');\n            }\n            if (eventName === 'resetMigration') {\n              if ((eventData.index === 1 && !rightcol) || (eventData.index === 2 && rightcol)) {\n                setGraphData({\n                  nodes: nodes,\n                  edges: edges\n                })\n              }\n            }\n          };\n          evtbus.addListener(listener);\n        }\n      };\n\n      /** Parameter definitions\n       * \n       * Migration Number (Mu):       Sum of the edge weights\n       * Comigration Number (Gamma):  Number of unique migrations\n       */\n      let mu = 0;\n      let gamma = edges.length;\n      edges.forEach((edge) => {\n        // eslint-disable-next-line eqeqeq\n        if (edge.data.label == '') {\n          mu += 1;\n        } else {\n          mu += parseInt(edge.data.label);\n        }\n      })\n\n      // Which mu and gamma are we setting (this is for dualviz)\n      if (!rightcol) {\n        sessionStorage.setItem(\"mu\", mu);\n        sessionStorage.setItem(\"gamma\", gamma);\n      } else {\n        sessionStorage.setItem(\"mu2\", mu);\n        sessionStorage.setItem(\"gamma2\", gamma);\n      }\n    \n      const memoizedGraphComponent = useMemo(() => ( <CytoscapeComponent\n        elements={CytoscapeComponent.normalizeElements(graphData)}\n        // pan={{ x: 200, y: 200 }}\n        style={{ width: width, height: height }}\n        zoomingEnabled={true}\n        maxZoom={3}\n        minZoom={0.1}\n        autounselectify={true}\n        boxSelectionEnabled={true}\n        layout={layout}\n        stylesheet={styleSheet}\n        cy={cy => {\n          myCyRef = cy;\n\n          cy.on('mouseover', 'edge', function(event) {\n            const { target } = event;\n            target.css({\n              width: 10\n            })\n            const nodeId = event.target.id();\n            evtbus.fireEvent('selectNodeSum', { nodeId, target});\n            evtbus.fireEvent('selectNodeCl', { nodeId, target});\n          });\n\n          cy.on('mouseover', 'node', function(event) {\n            const { target } = event;\n            target.css({\n              'border-width': 20,\n            })\n            const nodeId = event.target.id();\n            evtbus.fireEvent('hoverNodeSum', { nodeId });\n            evtbus.fireEvent('hoverNodeCl', { nodeId });\n\n            var node = event.target;\n            var label = node.data('label');\n\n            var labeltag = document.querySelector(`#${label}`);\n            if (labeltag !== null) {\n              labeltag.style.opacity = 1;\n              labeltag.style.zIndex = 100;\n              labeltag.style.fontWeight = 'bold';\n            }\n          })\n\n          cy.on('mouseout', 'node', function(event) {\n            const { target } = event;\n            target.css({\n              'border-width': 10,\n            })\n            const nodeId = event.target.id();\n            evtbus.fireEvent('dehoverNodeSum', { nodeId });\n            evtbus.fireEvent('dehoverNodeCl', { nodeId });\n\n            var node = event.target;\n            var label = node.data('label');\n\n            var labeltag = document.querySelector(`#${label}`);\n            if (labeltag !== null) {\n              labeltag.style.opacity = 0.7;\n              labeltag.style.zIndex = 1;\n              labeltag.style.fontWeight = 'normal';\n            }\n          })\n    \n          cy.on('mouseout', 'edge', function(event) {\n            const { target } = event;\n            target.css({\n              width: 3\n            })\n            const nodeId = event.target.id();\n            evtbus.fireEvent('deselectNodeSum', { nodeId, target});\n            evtbus.fireEvent('deselectNodeCl', { nodeId, target});\n          });\n        }}\n        />), [graphData] )\n        return memoizedGraphComponent;\n}\n\nexport default Migration;","class DefaultDict {\n    constructor(defaultVal) {\n        return new Proxy({}, {\n        get: (target, name) => name in target ? target[name] : defaultVal\n        })\n    }\n}\n\nexport default DefaultDict;","import React, { useMemo, useState } from 'react'\nimport CytoscapeComponent from 'react-cytoscapejs';\nimport Cytoscape from 'cytoscape';\nimport COSEBilkent from 'cytoscape-cose-bilkent';\nimport dagre from 'cytoscape-dagre';\n\nCytoscape.use(dagre);\nCytoscape.use(COSEBilkent);\n\n/** For the summary visualizer. Union the migration graphs.\n * \n * Summary graphs are edge-weighted by the number of solutions that edge appears in.\n * Therefore the max weight is the number of solutions there are\n * \n * @param {*} props \n * - title:     Name of the dataset\n * - data:      Full data including all solutions\n * - coloring:  Coloring scheme for the nodes\n * - evtbus\n * @returns \n */\nfunction SummaryGraph({data, coloringDict, evtbus, title, onDeleteSummaryEdge, onRequireSummaryEdge, roots, requiredEdges}) {\n\n    document.addEventListener('keydown', function(event) {\n      if (event.key === 'Shift') {\n        document.body.classList.add('shift-click');\n      }\n    });\n    \n    document.addEventListener('keyup', function(event) {\n      if (event.key === 'Shift') {\n        document.body.classList.remove('shift-click');\n      }\n    });\n\n    // TODO: Perhaps change this since we are redoing filtration\n    var filterOut = [];\n    var filterJson = JSON.parse(sessionStorage.getItem(\"selected\"))\n    if (title === filterJson['title']) {\n      for (let key in filterJson) {\n        if (key !== 'title' && !filterJson[key]) {\n          filterOut.push(key.split(''));\n        }\n      }\n    }\n\n    var hexColorRegex = /^#(?:[0-9a-fA-F]{3}){1,2}$/;\n\n    // const colorPalette = [\n    //   \"#a6cee3\",\n    //   \"#1f78b4\",\n    //   \"#b2df8a\",\n    //   \"#33a02c\",\n    //   \"#fb9a99\",\n    //   \"#e31a1c\",\n    //   \"#fdbf6f\",\n    //   \"#ff7f00\",\n    //   \"#cab2d6\",\n    //   \"#6a3d9a\",\n    //   \"#ffff99\",\n    //   \"#b15928\"\n    // ]\n    // const ncolors = colorPalette.length;\n\n    function onlyUnique(array) {\n      return [...new Set(array)];\n    }\n\n    // const [width, setWidth] = useState(\"100%\");\n    // const [height, setHeight] = useState(\"100%\");\n    const width = \"100%\";\n    const height = \"100%\";\n\n    let nodeSet = onlyUnique(data.map((value, index) => [value[0], value[1]]).flat())\n\n    let nodes = nodeSet.map((value, index) => {\n        return { data: { id:  value, label: value, type: \"ip\"} };\n    });\n\n    let edges = data.filter(e => {\n      for (let f of filterOut) {\n        if (f[0] === e[0] && f[1] === e[1]) {\n          return false;\n        }\n      }\n      return true;\n    }).map((value, index) => {\n      return { data: { source: value[0], target: value[1], label: value[2], id: `${value[0]}->${value[1]}`, clsource: value[0], cltarget: value[1] } }\n    })\n\n    // Insert a dummy node in the graph if there exist multiple clonal roots\n    // This node will connect to all edges in the graph\n    // Edges to those roots will be weighted by the number of solutions those roots appear in\n    if (Object.keys(roots).length > 1) {\n      nodes.push({ data: { id: \"roots\", label: \"roots\", type: \"ip\", root: \"true\"}});\n\n      for (let root in roots) {\n        edges.push({\n          data: {\n            source: \"roots\",\n            target: root,\n            label: roots[root],\n            id: `roots->${root}`,\n            clsource: \"roots\",\n            cltarget: root, \n            rootedge: \"true\"\n          }\n        })\n      }\n    }\n\n    // Dont label edge weights of 1\n    // BTW Edges are weighted by the number of solutions they appear in\n    for (const [i, edge] of edges.entries()) {\n      // eslint-disable-next-line eqeqeq\n      if (edge.data.label == 1) {\n        edges[i].data.label = \"\";\n      }\n    }\n\n    // const [graphData, setGraphData] = useState({\n    //     nodes: nodes,\n    //     edges: edges\n    // });\n\n    let graphData = {\n      nodes: nodes,\n      edges: edges\n    };\n\n    // console.log(graphData)\n\n    let styleSheet = [\n        {\n          selector: \"node\",\n          style: {\n            backgroundColor: \"#fff\",\n            'border-width': 10,\n            shape: \"rectangle\",\n            width: 100,\n            height: 50,\n            label: \"data(label)\",\n            \"overlay-padding\": \"6px\",\n            \"z-index\": \"10\",\n            \"text-outline-width\": \"2px\",\n            color: \"white\",\n            fontSize: 15,\n            'text-valign': 'center',\n            'text-halign': 'center'\n          }\n        },\n        {\n          selector: \"node:selected\",\n          style: {\n            \"border-width\": \"6px\",\n            \"border-color\": \"#AAD8FF\",\n            \"border-opacity\": \"0.5\",\n            \"background-color\": \"#77828C\",\n            width: 50,\n            height: 50,\n            \"text-outline-color\": \"#77828C\",\n            \"text-outline-width\": 8\n          }\n        },\n        {\n          selector: \"node[type='device']\",\n          style: {\n            shape: \"rectangle\"\n          }\n        },\n        {\n          selector: \"edge\",\n          style: {\n            width: 3,\n            label: \"data(label)\",\n            \"target-arrow-color\": \"#6774cb\",\n            \"target-arrow-shape\": \"triangle\",\n            'arrow-scale': 1,\n            \"curve-style\": \"bezier\",\n            \"edge-distances\": \"node-position\",       \n            \"text-outline-width\": \"2px\",\n            color: \"white\",\n            fontSize: 15\n          }\n        },\n        {\n          selector: \"node[root='true']\",\n          style: {\n            'border-color': '#bbb'\n          }\n        },\n        {\n          selector: \"edge[rootedge='true']\",\n          style: {\n            'line-style': 'dashed'\n          }\n        }\n    ];\n\n    for (let key in coloringDict) {\n      let value = coloringDict[key];\n      styleSheet.push({\n        selector: `node[label='${key}']`,\n        style: {\n          // 'border-color': hexColorRegex.test(value) ? value : colorPalette[parseInt(value) % ncolors]\n          'border-color': value\n        }\n      });\n    }\n\n    edges.map((value, _) => {\n        let source = value.data.source;\n        let target = value.data.target;\n\n        styleSheet.push({\n          selector: `edge[id='${source}->${target}']`,\n          style: {\n            'line-fill': 'linear-gradient',\n            'line-gradient-stop-colors': `${getColor(source)} ${getColor(target)}`,\n            'line-gradient-stop-positions': '33% 66%',\n            \"target-arrow-color\": `${getColor(target)}`,\n          }\n        })\n\n        return 0;\n    })\n\n    let myCyRef;\n\n    // TODO: Probably remove since theres no rotation button for summary\n    const queryParameters = new URLSearchParams(window.location.search);\n    let rotated = queryParameters.get(\"rotatedsum\") === \"true\";\n    if (rotated === null) {\n        rotated = false;\n    }\n\n    const layout = {\n        name: \"circle\",\n        fit: true,\n        circle: true,\n        directed: true,\n        padding: 10,\n        // spacingFactor: 1.5,\n        animate: true,\n        animationDuration: 1000,\n        avoidOverlap: true,\n        nodeDimensionsIncludeLabels: false,\n        ready: function() {\n          const listener = (eventName, eventData) => {\n            // Respond to event from other graph here\n            // For example:\n            if (eventName === 'selectNode') {\n              const node = myCyRef.getElementById(eventData.nodeId);\n              let source = eventData.source;\n              let target = eventData.sink;\n              myCyRef.$(`edge[id='${source}->${target}']`).css({\n                width: 10\n              })\n              node.trigger('select');\n            }\n            if (eventName === 'deselectNode') {\n              const node = myCyRef.getElementById(eventData.nodeId);\n              let source = eventData.source;\n              let target = eventData.sink;\n              myCyRef.$(`edge[id='${source}->${target}']`).css({\n                width: 3\n              })\n              node.trigger('select');\n            }\n            if (eventName === 'unrequireEdge') {\n              console.log(eventData.object);\n              let edge = myCyRef.$(`edge[id='${eventData.object}']`)\n              edge.css({\n                'font-weight': 'normal',\n                width: 3,\n                arrowScale: 1\n              })\n              edge.data('selected', 'false')\n            }\n            if (eventName === 'requireEdge') {\n              let edge = myCyRef.$(`edge[id='${eventData.object}']`)\n              edge.css({\n                'font-weight': 'normal',\n                width: 10,\n                arrowScale: 1\n              })\n              edge.data('selected', 'true')\n            }\n            if (eventName === 'resetStack') {\n              let edges = myCyRef.$(`edge`)\n              edges.css({\n                'font-weight': 'normal',\n                width: 3,\n                arrowScale: 1\n              })\n              edges.data('selected', 'false')\n            }\n          };\n          evtbus.addListener(listener);\n        }\n    };\n\n    // Compute mu and gamma for the summary\n    let mu = 0;\n    let gamma = edges.length;\n    edges.map((edge) => {\n      if (edge.data.source !== 'roots') {\n        // eslint-disable-next-line eqeqeq\n        if (edge.data.label == '') {\n          mu += 1;\n        } else {\n          mu += parseInt(edge.data.label);\n          //gamma += parseInt(edge.data.label) - 1;\n        }\n      }\n\n      return 0;\n    })\n\n    sessionStorage.setItem(\"musum\", mu);\n    sessionStorage.setItem(\"gammasum\", gamma);\n\n    function getColor(label) {\n      if (label === \"roots\") {\n        return '#bbb'\n      }\n      let color = coloringDict[label];\n      // return hexColorRegex.test(color) ? color : colorPalette[parseInt(color) % ncolors];\n      return color;\n    }\n\n    function onEdgeTapped(edge, action) {\n      if (action === 'require') {\n        return onRequireSummaryEdge(edge.id());\n      } else {\n        return onDeleteSummaryEdge(edge.id());\n      }\n    }\n\n    const memoizedGraphComponent = useMemo(() => ( <CytoscapeComponent\n        elements={CytoscapeComponent.normalizeElements(graphData)}\n        // pan={{ x: 200, y: 200 }}\n        style={{ width: width, height: height }}\n        zoomingEnabled={true}\n        maxZoom={3}\n        minZoom={0.1}\n        autounselectify={true}\n        boxSelectionEnabled={true}\n        layout={layout}\n        stylesheet={styleSheet}\n        cy={cy => {\n          myCyRef = cy;\n          \n          cy.off(\"cxttap\", \"edge\");\n          cy.on(\"cxttap\", \"edge\", evt => {\n            // console.log(\"right clicked\")\n          });\n\n          cy.off(\"tap\", \"edge\");\n          cy.on(\"tap\", \"edge\", evt => {\n            let action = \"require\"\n            if (evt.originalEvent.shiftKey) {\n              action = \"delete\"\n            }\n\n            var edge = evt.target;\n\n            let edgeTappedReturn = onEdgeTapped(edge, action);\n\n            if (edgeTappedReturn === -1) {\n              return;\n            } else {\n              if (action === 'require') {\n                // console.log(edge.id())\n                if (!requiredEdges.includes(edge.id())) {\n                  // console.log('there')\n                  edge.css({\n                    'font-weight': 'bold',\n                    width: 10,\n                    arrowScale: 1\n                  })\n                  edge.data('selected', 'true')\n                } else {\n                  // console.log('here')\n                  edge.css({\n                    'font-weight': 'normal',\n                    width: 3,\n                    arrowScale: 1\n                  })\n                  edge.data('selected', 'false')\n                }\n              }\n            }\n          });\n          \n          cy.off(\"mouseover\", \"edge\");\n          cy.on('mouseover', 'edge', function(event) {\n            const { target } = event;\n            if (target.data().selected !== 'true') {\n              target.css({\n                width: 6,\n                arrowScale: 0.5,\n                // 'font-weight': 'bold',\n              })\n            } else {\n              target.css({\n                width: 13,\n                arrowScale: 0.769,\n              })\n            }\n            const nodeId = event.target.id();\n            evtbus.fireEvent('selectNodeSum', { nodeId, target});\n            evtbus.fireEvent('selectNodeCl', { nodeId, target});\n\n            // change cursor type on shift click:\n            // if (shiftPressed) {\n            //   document.body.classList.add('shift-click');\n            // }\n          });\n\n          cy.off(\"mouseover\", \"node\");\n          cy.on('mouseover', 'node', function(event) {\n            const { target } = event;\n            target.css({\n              'border-width': 20,\n            })\n            const nodeId = event.target.id();\n            evtbus.fireEvent('hoverNodeSum', { nodeId });\n            evtbus.fireEvent('hoverNodeCl', { nodeId });\n\n            var node = event.target;\n            var label = node.data('label');\n\n            var labeltag = document.querySelector(`#${label}`);\n            if (labeltag !== null) {\n              labeltag.style.opacity = 1;\n              labeltag.style.zIndex = 100;\n              labeltag.style.fontWeight = 'bold';\n            }\n          })\n\n          cy.off(\"mouseout\", \"node\");\n          cy.on('mouseout', 'node', function(event) {\n            const { target } = event;\n            target.css({\n              'border-width': 10,\n            })\n            const nodeId = event.target.id();\n            evtbus.fireEvent('dehoverNodeSum', { nodeId });\n            evtbus.fireEvent('dehoverNodeCl', { nodeId });\n\n            var node = event.target;\n            var label = node.data('label');\n\n            var labeltag = document.querySelector(`#${label}`);\n            if (labeltag !== null) {\n              labeltag.style.opacity = 0.7;\n              labeltag.style.zIndex = 1;\n              labeltag.style.fontWeight = 'normal';\n            }\n          })\n\n          cy.off(\"mouseout\", \"edge\");\n          cy.on('mouseout', 'edge', function(event) {\n            const { target } = event;\n            if (target.data().selected !== 'true') {\n              target.css({\n                width: 3,\n                // 'font-weight': 'normal',\n                arrowScale: 1,\n              })\n            } else {\n              target.css({\n                width: 10,\n                arrowScale: 1,\n              })\n            }\n            const nodeId = event.target.id();\n            evtbus.fireEvent('deselectNodeSum', { nodeId, target});\n            evtbus.fireEvent('deselectNodeCl', { nodeId, target});\n\n            // Change cursor back to normal cursor\n            // document.body.classList.remove('shift-click');\n          });\n        }}\n      />), [data] )\n      return memoizedGraphComponent;\n}\n\nexport default SummaryGraph;","import React, { useState } from \"react\"\nimport SummaryGraph from \"./SummaryGraph.js\";\n\nfunction SummaryPanel({ \n    type, \n    setType, \n    insertParam, \n    usedData, \n    coloring, \n    muSum, \n    evtBus, \n    onDeleteSummaryEdge, \n    onRequireSummaryEdge, \n    clearData, \n    roots, \n    deletedEdges,\n    requiredEdges,\n    deletedRoots,\n    requiredRoots,\n    setDeletedEdges,\n    setRequiredEdges,\n    setDeletedRoots,\n    setRequiredRoots,\n    filterStack,\n    setFilterStack\n}) {\n    const [tooltip, setTooltip] = useState(false);\n\n    let closeSummary = (event) => {\n        clearData()\n        if (type === 'sumviz') {\n            setType('viz')\n            insertParam('type', 'viz')\n        } else {\n            setType('dualviz')\n            insertParam('type', 'dualviz')\n        }\n    }\n\n    function findColor(dict, key) {\n        var hexColorRegex = /^#(?:[0-9a-fA-F]{3}){1,2}$/;\n\n        const colorPalette = [\n            \"#a6cee3\",\n            \"#1f78b4\",\n            \"#b2df8a\",\n            \"#33a02c\",\n            \"#fb9a99\",\n            \"#e31a1c\",\n            \"#fdbf6f\",\n            \"#ff7f00\",\n            \"#cab2d6\",\n            \"#6a3d9a\",\n            \"#ffff99\",\n            \"#b15928\"\n        ]\n        const ncolors = colorPalette.length;\n\n        let value = dict[key];\n\n        return hexColorRegex.test(value) ? value : colorPalette[parseInt(value) % ncolors];\n    }\n\n    function generateTag(stack, dict) {\n        if (stack.length <= 0) {\n            return <></>\n        }\n\n        const recentAction = stack[stack.length - 1];\n        let split = recentAction.split(' ')\n        let edge = split[split.length - 1]\n        let [source, target] = edge.split('->')\n        let sourceColor = findColor(dict, source);\n        let targetColor = findColor(dict, target);\n\n        // Edge case: deleting a required edge\n        if (split[0] === 'deletedrequired') {\n            split[0] = 'deleted';\n        } \n\n        console.log(findColor(dict, source));\n\n        const sourceStyle = {\n            display: 'inline-block',\n            backgroundColor: sourceColor,\n            padding: '5px',\n            borderRadius: '5px',\n            color: 'white',\n        };\n\n        const targetStyle = {\n            display: 'inline-block',\n            backgroundColor: targetColor,\n            padding: '5px',\n            borderRadius: '5px',\n            color: 'white',\n        };\n\n        return (\n            <div className=\"panel actionwrapper\">\n                <p><b>Undo Most Recent Action: </b></p>\n                <p className=\"recentAction\">{split[0]} {split[1]}</p>\n                <p className=\"recentAction\"><span style={sourceStyle}>{source}</span> <span style={targetStyle}>{target}</span></p>\n            </div>\n        )\n    }\n\n    function undoFunction() {\n        setTooltip(false)\n        let recent = filterStack.pop()\n        let [action, item, object] = recent.split(' ')\n\n        if (action === 'required') {\n            if (item === 'root') {\n                setRequiredRoots(requiredRoots.filter(elem => elem !== object))\n            }\n\n            if (item === 'edge') {\n                setRequiredEdges(requiredEdges.filter(elem => elem !== object))\n                evtBus.fireEvent('unrequireEdge', { object })\n            }\n        }\n\n        if (action === 'deleted') {\n            if (item === 'root') {\n                setDeletedRoots(deletedRoots.filter(elem => elem !== object))\n            }\n\n            if (item === 'edge') {\n                setDeletedEdges(deletedEdges.filter(elem => elem !== object))\n            }\n        }\n\n        if (action === 'deletedrequired') {\n            setDeletedEdges(deletedEdges.filter(elem => elem !== object))\n            setRequiredEdges([...requiredEdges, object])\n            evtBus.fireEvent('requireEdge', { object })\n        }\n\n        if (action === 'relaxed') {\n            setRequiredEdges([...requiredEdges, object])\n            evtBus.fireEvent('requireEdge', { object })\n        }\n\n        console.log(action)\n        console.log(item)\n        console.log(object)\n    }\n\n    function resetFn() {\n        setFilterStack([])\n        setDeletedEdges([])\n        setRequiredEdges([])\n        setDeletedRoots([])\n        setRequiredRoots([])\n        evtBus.fireEvent('resetStack')\n    }\n\n    var summaryGraph = usedData[\"summary\"][\"migration\"];\n\n    if (summaryGraph === undefined) {\n        summaryGraph = usedData[\"summary\"]\n    }\n\n    let coloringDict = {};\n    for (var i = 0; i < coloring.length; i++) {\n        coloringDict[coloring[i][0]] = coloring[i][1];\n    }\n\n    return (\n        <div className={`panel info ${type === 'sumviz' ? 'one' : 'tri'}`}>\n            <div className=\"titlewrapper\">\n                <h3 className=\"sumviztitle\"><b>Summary</b></h3>\n                <p className=\"titleelem end\"><b>Press [/] for help</b></p>\n                <span onClick={closeSummary} style={{ textDecoration: 'none', color: 'black' }}><p className='panelclosebutton'><b>[X]</b></p></span>\n            </div>\n            <div className=\"panel migration top left sum\">\n                <p className=\"paneltitle\"><b>Migration Graph</b></p>\n                <p className=\"paneltitle mu\">{`solutions: ${usedData['solutions'].length}`}</p>\n                {filterStack.length > 0 ? <p \n                    className=\"rightAlign\"\n                    onClick={undoFunction}\n                    onMouseEnter={() => setTooltip(true)}\n                    onMouseLeave={() => setTooltip(false)}\n                ></p> : <></>}\n                {tooltip ? generateTag(filterStack, coloringDict) : <></>}\n                <button type=\"button\" className=\"paneltitle button summary\" onClick={resetFn}>Reset</button>\n                <SummaryGraph\n                    data={summaryGraph}\n                    coloringDict={coloringDict}\n                    evtbus={evtBus}\n                    title={usedData['name']}\n                    onDeleteSummaryEdge={onDeleteSummaryEdge}\n                    onRequireSummaryEdge={onRequireSummaryEdge}\n                    roots={roots}\n                    requiredEdges={requiredEdges}\n                />\n            </div>\n        </div>\n    )\n}\n\nexport default SummaryPanel;","import React from 'react';\nimport Popup from 'reactjs-popup';\n\nexport default function HelpPopup( {isPopupOpen, togglePopup} ) {\n    return(\n        <Popup open={isPopupOpen} togglePopup={togglePopup} overlayStyle={{ background: 'rgba(0, 0, 0, 0.6)', zIndex: 9999 }} animationType=\"fade\" modal>\n            {close => (\n                <div className=\"popup-container\">\n                    {/* <button className=\"close-x\" onClick={close}>\n                        &times;\n                    </button> */}\n                    <div className=\"header\">\n                        Help\n                    </div>\n                    <p className=\"popup-container-text\">Click and drag around the migration graph and clonal tree. Hover over nodes in the clonal tree to find the corresponding anatomical location for the node.</p>\n                    <p className=\"popup-container-text\">Select different solutions from the dropdown on the top left of the panel.</p>\n                    <p className=\"popup-container-text\">To compare with another solution, click the [+] on the right. To view the solution space summary, click the [+] on the left.</p>\n\n                    <button\n                        className='close-button'\n                        onClick={() => {\n                        console.log('modal closed ');\n                        togglePopup();\n                        }}\n                    >\n                        Close\n                    </button>\n                </div>\n            )}\n\n        </Popup>\n    );\n}\n","import React from 'react';\nimport Popup from 'reactjs-popup';\n\nexport default function NoSolutionsPopup({isPopupOpen, togglePopup}) {\n    return(\n        <Popup open={isPopupOpen} onClose={togglePopup} overlayStyle={{ background: 'rgba(0, 0, 0, 0.6)', zIndex: 9999 }} animationType=\"fade\" modal>\n            {close => (\n                <div className=\"no-sol-popup-container\">\n                    {/* <button className=\"close-x\" onClick={close}>\n                        &times;\n                    </button> */}\n                    <div className=\"header\">\n                        ERROR\n                    </div>\n                    <p className=\"popup-container-text\">There are no solutions available for your input!</p>\n\n                    <button\n                        className='close-button'\n                        onClick={close}\n                    >\n                        Close\n                    </button>\n                </div>\n            )}\n\n        </Popup>\n    );\n}","import React, { useState, useEffect } from \"react\"\nimport ClonalTree from \"./ClonalTree.js\";\nimport Migration from \"./Migration.js\";\n// import {\n//   Link\n// } from \"react-router-dom\";\n\nimport DefaultDict from \"../utils/DefaultDict.js\";\n\n// Panels\nimport SummaryPanel from \"./SummaryPanel.js\";\n\n// Popup\nimport HelpPopup from \"./HelpPopup.js\";\nimport NoSolutionsPopup from \"./NoSolutionsPopup.js\";\n\n/**\n * Finds the root of a tree represented by an edge list.\n * @param {Array<Array<number>>} edgeList - The edge list representing the tree.\n * Each inner array should contain three elements: [u, v, weight].\n * @returns The root node of the tree, or null if the tree is empty or has disconnected components.\n */\nfunction findRoot(edgeList) {\n  // Create a map to store the indegree of each node\n  const indegreeMap = new Map();\n\n  // Traverse the edge list and populate the indegree map\n  for (const [src, dest] of edgeList) {\n    if (!indegreeMap.has(src)) {\n      indegreeMap.set(src, 0);\n    }\n    if (!indegreeMap.has(dest)) {\n      indegreeMap.set(dest, 0);\n    }\n    indegreeMap.set(dest, indegreeMap.get(dest) + 1);\n  }\n\n  // Find the root (node with indegree 0)\n  let root;\n  indegreeMap.forEach((indegree, node) => {\n    if (indegree === 0) {\n      if (root) {\n        // If there is more than one node with indegree 0, then the tree is invalid.\n        throw new Error('Invalid tree: multiple roots');\n      }\n      root = node;\n    }\n  });\n\n  if (root === undefined) {\n    // If there is no node with indegree 0, then the tree is invalid.\n    throw new Error('Invalid tree: no root found');\n  }\n\n  return root;\n}\n\n/**\n * Constructs a frequency dictionary from an array, where keys are elements in the array, \n * and values represent the number of occurrences of each element.\n *\n * @param {Array} arr - The input array from which to construct the frequency dictionary.\n * @returns {Object} An object representing the frequency dictionary, \n *                   where keys are elements and values are their occurrences.\n */\nfunction constructFrequencyDictionary(arr) {\n  const frequencyDict = {};\n  \n  for (const item of arr) {\n    if (frequencyDict[item]) {\n      frequencyDict[item]++;\n    } else {\n      frequencyDict[item] = 1;\n    }\n  }\n  \n  return frequencyDict;\n}\n\n/** Return location of clonal tree root\n * \n * @param {Array} tree tree represented as an edgelist\n * @param {Array} labeling anatomic labeling of clones\n *  - Each entry is an array of two containing [clone, location]\n */\nfunction fetchRootLocation(tree, labeling) {\n  var root = findRoot(tree);\n\n  for (const entry of labeling) {\n    if (entry[0] === root) {\n      return entry[1]\n    }\n  }\n\n  return null\n}\n\n/** Fetch tree roots across the data\n * \n * @param {Object} data filtered MACH2 output data\n */\nfunction fetchRoots(data) {\n  // Fetch each tree in the solution\n  var solutions = data['solutions'];\n  var trees = solutions.map((soln) => soln['tree']);\n\n  // Get the anatomic locations of the roots of each of the trees\n  var roots = trees.map((tree) => findRoot(tree));\n  var rootLocations = roots.map((root, index) => {\n    for (const entry of solutions[index]['labeling']) {\n      if (entry[0] === root) {\n        return entry[1]\n      }\n    }\n    // never reaches this\n    return 0;\n  })\n\n  // Construct a frequency mapping\n  return constructFrequencyDictionary(rootLocations);\n}\n\n/** Insert a URL parameter */\nfunction insertParam(key, value) {\n  // Change a url parameter using URLSearchParams\n  let urlParams = new URLSearchParams(window.location.hash.split(\"?\")[1]);\n  urlParams.set(key, value);\n\n  // Replace the URL\n  window.location.href = '#/viz?' + urlParams.toString();\n}\n\nfunction Viz(props) {\n  const [mu, setMu] = useState(0);\n  const [gamma, setGamma] = useState(0);\n  const [mu2, setMu2] = useState(0);\n  const [gamma2, setGamma2] = useState(0);\n  const [muSum, setMuSum] = useState(0);\n  const [gammaSum, setGammaSum] = useState(0);\n  const jsonContents = sessionStorage.getItem(\"json_data\");\n\n  // for filtering when selecting/unselecting edges on summary graph\n  const [deletedEdges, setDeletedEdges] = useState([]);\n  const [requiredEdges, setRequiredEdges] = useState([]);\n\n  // for refreshing when adding/removing panels\n  const [refreshCounter, setRefreshCounter] = useState(0);\n\n  // for switching between original and new clonal trees\n  // these exist per panel (left = L, right = R)\n  const [clonalL, setClonalL] = useState(false);\n  const [clonalR, setClonalR] = useState(false);\n\n  // Roots data\n  const [roots, setRoots] = useState([]);\n  const [requiredRoots, setRequiredRoots] = useState([]);\n  const [deletedRoots, setDeletedRoots] = useState([]);\n\n  // Summary filter operations stack\n  const [filterStack, setFilterStack] = useState([]);\n\n  // Use the clonalL field to set fontweight to bold according to the state\n  // Styles ending in L are for the left panel\n  // The leftText is for the original clonal tree\n  /*\n  const leftTextStyleL = {\n    fontWeight: !clonalL ? 'bold' : 'normal',\n  }\n  const rightTextStyleL = {\n    fontWeight: clonalL ? 'bold' : 'normal',\n  }*/\n\n  useEffect(() => {\n    updateUsedData();\n  }, [deletedEdges, requiredEdges, deletedRoots, requiredRoots]);\n\n  function onDeleteSummaryEdge(edge_id) {\n    let [source, target] = edge_id.split('->');\n    if (source !== 'roots') {\n      console.log(\"delete\");\n      // if the edge is currently required, unrequire it and then delete\n      if (requiredEdges.includes(edge_id)) {\n        const updatedEdges = requiredEdges.filter((edge) => edge !== edge_id);\n        setRequiredEdges(updatedEdges);\n        setFilterStack([...filterStack, `deletedrequired edge ${edge_id}`]);\n      } else {\n        setFilterStack([...filterStack, `deleted edge ${edge_id}`]);\n      }\n\n      setDeletedEdges([...deletedEdges, edge_id]);\n    } else {\n      console.log(\"delete root\");\n      console.log(deletedRoots)\n      setFilterStack([...filterStack, `deleted root ${target}`]);\n      setDeletedRoots([...deletedRoots, target]);\n    }\n  }\n\n  function onRequireSummaryEdge(edge_id) {\n    let [source, target] = edge_id.split('->')\n    if (source !== 'roots') {\n      if (requiredEdges.includes(edge_id)) {\n        console.log(\"relax\");\n        // If edge_id exists, remove all instances of edge_id from requiredEdges\n        const updatedEdges = requiredEdges.filter((edge) => edge !== edge_id);\n        setRequiredEdges(updatedEdges);\n        setFilterStack([...filterStack, `relaxed edge ${edge_id}`]);\n      } else {\n        console.log(\"require\");\n        setFilterStack([...filterStack, `required edge ${edge_id}`]);\n        setRequiredEdges([...requiredEdges, edge_id]);\n      }\n    } else {\n      console.log(\"require root\");\n      setFilterStack([...filterStack, `required root ${target}`]);\n      setRequiredRoots([...requiredRoots, target]);\n    }\n  }\n\n  function clearData() {\n    setDeletedEdges([])\n    setRequiredEdges([])\n    setDeletedRoots([])\n    setRequiredRoots([])\n    setFilterStack([])\n  }\n\n  function onToggleInputClonalL() {\n    if (!clonalL) setClonalL(!clonalL)\n  }\n\n  function onToggleOutputClonalL() {\n    if (clonalL) setClonalL(!clonalL)\n  }\n\n  function onToggleInputClonalR() {\n    if (!clonalR) setClonalR(!clonalR)\n  }\n\n  function onToggleOutputClonalR() {\n    if (clonalR) setClonalR(!clonalR)\n  }\n\n  const [usedData, setUsedData] = useState(JSON.parse(jsonContents));\n\n  function updateUsedData() {\n\n    const wholeData = JSON.parse(jsonContents);\n\n    let tempUsedData = {\n      \"name\": wholeData[\"name\"],\n      \"original\": wholeData[\"original\"],\n      \"solutions\": [],\n      \"summary\": {\n        \"migration\": [],\n      },\n    };\n\n    for (let i = 0; i < wholeData[\"solutions\"].length; i++) {\n      let treeEntry = wholeData[\"solutions\"][i][\"tree\"]\n      let labelingEntry = wholeData[\"solutions\"][i][\"labeling\"]\n      let migrationEntry = wholeData[\"solutions\"][i][\"migration\"]\n\n      let rootLocation = fetchRootLocation(treeEntry, labelingEntry);\n\n      let foundDeletedEdge = false;\n\n      // We'll accept a root if we aren't requiring an edge or it is within our required list\n      let foundRequiredRoot = requiredRoots.length === 0 || requiredRoots.includes(rootLocation);\n\n      // We'll blacklist a root if there even is a blacklist and it contains the root\n      let foundDeletedRoot  = deletedRoots.length !== 0 && deletedRoots.includes(rootLocation);\n\n      // let foundRequiredEdge = false;\n      let requiredEdgeCounter = 0;\n      \n      for (let j = 0; j < migrationEntry.length; j++) {\n        // check deleteEdges:\n        let migrationEdgeString = migrationEntry[j][0] \n          + \"->\" \n          + wholeData[\"solutions\"][i][\"migration\"][j][1];\n        for (let k = 0; k < deletedEdges.length; k++) {\n          // create string from wholeData:\n          if (migrationEdgeString === deletedEdges[k]) {\n            foundDeletedEdge = true;\n          }\n        }\n\n        for (let k = 0; k < requiredEdges.length; k++) {\n          if (migrationEdgeString === requiredEdges[k]) {\n            requiredEdgeCounter++;\n          }\n        }\n      }\n\n      if (!foundDeletedRoot && foundRequiredRoot && !foundDeletedEdge && (requiredEdgeCounter === requiredEdges.length)) {\n        const tempSolution = JSON.parse(JSON.stringify(wholeData[\"solutions\"][i]))\n        tempUsedData[\"solutions\"].push(tempSolution);\n      }\n    }\n\n    // check how to add summary in:\n    for (let i = 0; i < tempUsedData[\"solutions\"].length; i++) {\n      for (let j = 0; j < tempUsedData[\"solutions\"][i][\"migration\"].length; j++) {\n        let edgeInSummary = false;\n        // add edge to summary:\n        for (let k = 0; k < tempUsedData[\"summary\"][\"migration\"].length; k++) {\n          // check if edge matches any of the summary edges:\n          if (tempUsedData[\"summary\"][\"migration\"][k][0] === tempUsedData[\"solutions\"][i][\"migration\"][j][0]\n            && tempUsedData[\"summary\"][\"migration\"][k][1] === tempUsedData[\"solutions\"][i][\"migration\"][j][1]) {\n            edgeInSummary = true;\n            tempUsedData[\"summary\"][\"migration\"][k][2] += 1;\n          }\n        }\n        if (!edgeInSummary) {\n          let tempSummaryElement = [...tempUsedData[\"solutions\"][i][\"migration\"][j].slice(0, -1), 1];\n          tempUsedData[\"summary\"][\"migration\"].push(tempSummaryElement);\n        }\n      }\n    }\n\n    if (tempUsedData[\"summary\"][\"migration\"].length === 0){\n      // TODO: Ensure that the filter stack is updated before we reach this point in the code\n      // check the filter stack to revert everything back to normal:\n      const last_edit = filterStack[filterStack.length - 1];\n      setFilterStack(filterStack.slice(0, -1));\n      if (last_edit.slice(0, 12) === 'deleted edge') {\n        console.log(\"the last command was a delete edge command\");\n        setDeletedEdges(deletedEdges.slice(0, -1));\n      } else if (last_edit.slice(0, 12) === 'deleted root') {\n        console.log(\"the last command was a delete root command\");\n        setDeletedEdges(deletedRoots.slice(0, -1));\n      } else if (last_edit.slice(0, 13)  === 'required root') {\n        console.log(\"the last command was a require root command\");\n        setDeletedEdges(requiredRoots.slice(0, -1));\n      } else {\n        console.log(\"the last command was a require edge command\");\n        setRequiredEdges(requiredEdges.slice(0, -1));\n      }\n\n      toggleNoSolutionsPopup();\n      return -1;\n    }\n\n    if(wholeData[\"coloring\"]) {\n      tempUsedData[\"coloring\"] = JSON.parse(JSON.stringify(wholeData[\"coloring\"]));\n    }\n\n    setUsedData(tempUsedData);\n    setRoots(fetchRoots(tempUsedData));\n\n    let tempNames = tempUsedData[\"solutions\"].map((value, index) => { return value[\"name\"] })\n\n    if (!tempNames.includes(data[\"name\"])) {\n      setData(tempUsedData[\"solutions\"].filter((item) => { return item[\"name\"] === tempNames[0] })[0])\n    }\n\n    if (data2 !== undefined && !tempNames.includes(data2[\"name\"])) {\n      setData2(tempUsedData[\"solutions\"].filter((item) => { return item[\"name\"] === tempNames[0] })[0])\n    }\n\n    return 0;\n  }\n\n  const [labelNames, setLabelNames] = useState(usedData[\"solutions\"].map((value, index) => { return value[\"name\"] }));\n\n  const queryParameters = new URLSearchParams(window.location.hash.split(\"?\")[1]);\n\n  let labelName = queryParameters.get(\"labeling\");\n  let labelName2 = queryParameters.get(\"labeling2\");\n\n  const [labeling, setLabeling] = useState(labelName)\n  const [labeling2, setLabeling2] = useState(labelName2)\n\n  const [rotate, setRotate] = useState(queryParameters.get(\"rotated\") === \"true\");\n  const [rotate2, setRotate2] = useState(queryParameters.get(\"rotated2\") === \"true\");\n\n  const [type, setType] = useState(queryParameters.get(\"type\"))\n\n  if (labelName === \"undefined\") {\n    insertParam(\"labeling\", usedData[\"solutions\"][0][\"name\"]);\n    setLabeling(usedData[\"solutions\"][0][\"name\"])\n  }\n  if (labelName2 === \"undefined\") {\n    insertParam(\"labeling2\", usedData[\"solutions\"][0][\"name\"]);\n    setLabeling2(usedData[\"solutions\"][0][\"name\"])\n  }\n\n  sessionStorage.setItem(\"selected\", JSON.stringify(new DefaultDict(0)));\n  sessionStorage.setItem(\"violations\", JSON.stringify(new DefaultDict(0)));\n\n\n\n  const [data, setData] = useState(usedData[\"solutions\"].filter((item) => { return item[\"name\"] === labeling })[0]);\n  const [data2, setData2] = useState(usedData[\"solutions\"].filter((item) => { return item[\"name\"] === labeling2 })[0]);\n  const [tree, setTree] = useState(data[\"tree\"])\n  const [tree_labeling, setTreeLabeling] = useState(data[\"labeling\"])\n  const [migration, setMigration] = useState(data[\"migration\"])\n  const [tree2, setTree2] = useState([])\n  const [tree_labeling2, setTreeLabeling2] = useState([])\n  const [migration2, setMigration2] = useState([])\n  const [clonalMap, setClonalMap] = useState([])\n  const [clonalMap2, setClonalMap2] = useState([])\n\n  // Flag if the original tree exists in the data, \n  // and fetch the data if it exists\n  var origExists = true;\n  var originalTree;\n  var originalLabeling\n  try {\n    originalTree = usedData['original']['tree'];\n    originalLabeling = usedData['original']['labeling'];\n  } catch {\n    origExists = false;\n  }\n\n  // let coloring = usedData[\"coloring\"];\n  const [coloring, setColoring] = useState(usedData[\"coloring\"]);\n\n  const colorPalette = [\n    \"#a6cee3\",\n    \"#1f78b4\",\n    \"#b2df8a\",\n    \"#33a02c\",\n    \"#fb9a99\",\n    \"#e31a1c\",\n    \"#fdbf6f\",\n    \"#ff7f00\",\n    \"#cab2d6\",\n    \"#6a3d9a\",\n    \"#ffff99\",\n    \"#b15928\"\n  ]\n\n  if (coloring === undefined || coloring.length === 0) {\n\n    // Extract labels from the data\n    const labels = data[\"labeling\"].map((item) => item[1]);\n\n    // Get unique labels\n    const uniqueLabels = labels.filter((value, index, self) => {\n      return self.indexOf(value) === index;\n    });\n\n    // Map each unique label to a new format: [label, indexAsString]\n    const formattedLabels = uniqueLabels.map((label, index) => [label, `${colorPalette[index % colorPalette.length]}`]);\n\n    console.log(formattedLabels);\n\n    // Result\n    setColoring(formattedLabels);\n    // coloring = formattedLabels;\n  }\n\n  let coloringDict = {};\n\n  useEffect(() => {\n    for (var i = 0; i < coloring.length; i++) {\n      coloringDict[coloring[i][0]] = coloring[i][1];\n    }\n  }, [coloring])\n\n  useEffect(() => {\n    updateUsedData();\n    setTree(data[\"tree\"]);\n    setTreeLabeling(data[\"labeling\"]);\n    setMigration(data[\"migration\"]);\n    setMu(sessionStorage.getItem(\"mu\"));\n    setGamma(sessionStorage.getItem(\"gamma\"));\n\n    if (data[\"origin_node\"] !== undefined) {\n      setClonalMap(data[\"origin_node\"])\n    }\n  }, [labeling])\n\n  useEffect(() => {\n    setLabelNames(usedData[\"solutions\"].map((value, index) => { return value[\"name\"] }))\n  }, [usedData])\n\n  useEffect(() => {\n    if (!labelNames.includes(labeling)) {\n      insertParam(\"labeling\", labelNames[0])\n      setLabeling(labelNames[0])\n    }\n\n    if (!labelNames.includes(labeling2)) {\n      insertParam(\"labeling2\", labelNames[0])\n      setLabeling2(labelNames[0])\n    }\n  }, [labelNames])\n\n  let coord_map = usedData[\"map\"];\n\n  let handleLabelChange = (event) => {\n    insertParam(\"labeling\", event.target.value);\n    setLabeling(event.target.value)\n    setData(usedData[\"solutions\"].filter((item) => { return item[\"name\"] === event.target.value })[0]);\n  }\n\n  let handleLabelChange2 = (event) => {\n    insertParam(\"labeling2\", event.target.value);\n    setLabeling2(event.target.value)\n    setData2(usedData[\"solutions\"].filter((item) => { return item[\"name\"] === event.target.value })[0]);\n  }\n\n  let addTab = (event) => {\n    //window.location = `${window.location.protocol}//${window.location.host}/mach2-viz/#/dualviz?labeling=${queryParameters.get(\"labeling\")}&labeling2=${queryParameters.get(\"labeling\")}`;\n    if (type === 'sumviz') {\n      insertParam(\"type\", \"triviz\")\n      setType('triviz')\n    } else {\n      insertParam(\"type\", \"dualviz\")\n      setType('dualviz')\n    }\n    insertParam(\"labeling2\", labeling)\n    setLabeling2(labeling)\n    setData2(usedData[\"solutions\"].filter((item) => { return item[\"name\"] === labeling })[0]);\n    setMu2(sessionStorage.getItem(\"mu2\"));\n    setGamma2(sessionStorage.getItem(\"gamma2\"));\n  }\n\n  let closeTab = (tabIndex) => {\n    if (type === 'dualviz' || type === 'triviz') {\n      setType(type === 'dualviz' ? 'viz' : 'sumviz')\n      if (tabIndex === 1) {\n        setData(data2)\n        setLabeling(labeling2)\n        setRotate(rotate2)\n        setTree(data2[\"tree\"])\n        setTreeLabeling(data2[\"labeling\"])\n        setMigration(data2[\"migration\"])\n\n        if (data2[\"origin_node\"] !== undefined) {\n          setClonalMap(data[\"origin_node\"])\n        }\n      }\n      insertParam('type', 'viz')\n    } else {\n      window.location = `${window.location.protocol}//${window.location.host}/mach2-viz/#/`\n    }\n  }\n\n  useEffect(() => {\n    if (data2) {\n      setTree2(data2[\"tree\"])\n      setTreeLabeling2(data2[\"labeling\"])\n      setMigration2(data2[\"migration\"])\n\n      if (data2[\"origin_node\"] !== undefined) {\n        setClonalMap2(data[\"origin_node\"])\n      }\n    }\n  }, [data2])\n\n  useEffect(() => {\n    setMu2(sessionStorage.getItem(\"mu2\"));\n    setGamma2(sessionStorage.getItem(\"gamma2\"));\n  }, [tree2])\n\n  // refresh when type is changed\n  useEffect(() => {\n    setRefreshCounter(prevCounter => prevCounter + 1);\n  }, [type]);\n\n  let gotoSummary = (event) => {\n    if (type === 'dualviz') {\n      setType('triviz');\n      insertParam('type', 'triviz')\n    } else {\n      setType('sumviz');\n      insertParam('type', 'sumviz')\n    }\n  }\n\n  let rotateFn = (event) => {\n    let rotated = queryParameters.get(\"rotated\") === \"true\";\n    insertParam(\"rotated\", !rotated);\n    setRotate(!rotated)\n  }\n\n  let rotateFn2 = (event) => {\n    let rotated2 = queryParameters.get(\"rotated2\") === \"true\";\n    insertParam(\"rotated2\", !rotated2);\n    setRotate2(!rotated2)\n  }\n\n  let resetFn = (index) => {\n    evtBus.fireEvent('resetMigration', { index })\n  }\n\n  let resetClonal = (index) => {\n    evtBus.fireEvent('resetClonal', {index})\n  }\n\n  useEffect(() => {\n    setMu(sessionStorage.getItem(\"mu\"));\n    setGamma(sessionStorage.getItem(\"gamma\"));\n    setMu2(sessionStorage.getItem(\"mu2\"));\n    setGamma2(sessionStorage.getItem(\"gamma2\"));\n    setMuSum(sessionStorage.getItem(\"musum\"));\n    setGammaSum(sessionStorage.getItem(\"gammasum\"));\n    updateUsedData()\n\n    document.addEventListener(\"keydown\", handleKeyPress);\n  }, []);\n\n  // NOTE: This is a state because undos need to thicken and unthicken the edge\n  // Setting a state will allow the object to change on runtime (adding listeners and firing events)\n  const [evtBus, setEvtBus] = useState({\n    listeners: [],\n    addListener(callback) {\n      this.listeners.push(callback);\n    },\n    removeListener(callback) {\n      this.listeners = this.listeners.filter(listener => listener !== callback);\n    },\n    fireEvent(eventName, eventData) {\n      this.listeners.forEach((listener) => {\n        listener(eventName, eventData);\n      });\n    },\n  });\n\n  // Popups\n  const [isHelpPopupOpen, setIsHelpPopupOpen] = useState(false);\n  const [isNoSolutionsPopupOpen, setIsNoSolutionsPopupOpen] = useState(false);\n\n  function toggleNoSolutionsPopup() {\n    setIsNoSolutionsPopupOpen(!isNoSolutionsPopupOpen);\n  }\n\n  function toggleHelpPopup() {\n    setIsHelpPopupOpen(!isHelpPopupOpen);\n  }\n\n  /** TODO: Replace this with an actual window rather than just an alert message\n   * \n   * @param {*} event Event metadata\n   */\n  function handleKeyPress(event) {\n    if (event.key === '/') {\n      // alert('Instructions:\\n\\nToggle and move around the migration graph and clonal tree. Hover over nodes in the clonal tree to find the corresponding anatomical location for the node.\\n\\nSelect different solutions from the dropdown on the top left of the panel.\\n\\nTo compare with another solution, click the [+] on the right. To view the solution space summary, click the [+] on the left.\\n\\nYou can return home by clicking the [X].');\n      console.log(\"/ key pressed!\")\n      toggleHelpPopup();\n    }\n  }\n\n  // console.log(filterStack)\n  // keeping track of edges that are not used\n  // update unusedEdges whenever\n\n  return (\n    <div className=\"viz\">\n      <HelpPopup isPopupOpen={isHelpPopupOpen} togglePopup={toggleHelpPopup}></HelpPopup>\n      <NoSolutionsPopup isPopupOpen={isNoSolutionsPopupOpen} togglePopup={toggleNoSolutionsPopup}></NoSolutionsPopup>\n      {type !== 'sumviz' && type !== 'triviz' ?\n        <div className=\"panel tab_add2\" onClick={gotoSummary}><p className='addpanelp'><b>+</b></p></div>\n        : <></>}\n      {(type === 'sumviz' || type === 'triviz') ?\n        <SummaryPanel\n          key={refreshCounter}\n          type={type}\n          setType={setType}\n          insertParam={insertParam}\n          usedData={usedData}\n          coloring={coloring}\n          muSum={muSum}\n          gammaSum={gammaSum}\n          evtBus={evtBus}\n          onDeleteSummaryEdge={onDeleteSummaryEdge}\n          onRequireSummaryEdge={onRequireSummaryEdge}\n          clearData={clearData}\n          roots={roots}\n          deletedEdges={deletedEdges}\n          requiredEdges={requiredEdges}\n          deletedRoots={deletedRoots}\n          requiredRoots={requiredRoots}\n          setDeletedEdges={setDeletedEdges}\n          setRequiredEdges={setRequiredEdges}\n          setDeletedRoots={setDeletedRoots}\n          setRequiredRoots={setRequiredRoots}\n          filterStack={filterStack}\n          setFilterStack={setFilterStack}\n        /> : <></>}\n      <div className={`panel info ${type === 'dualviz' ? 'one' :\n        type === 'sumviz' ? 'one two' :\n          type === 'triviz' ? 'tri two' :\n            ''\n        }`}>\n        <div className=\"titlewrapper\">\n          <label className=\"titleelem left\" htmlFor=\"labelings\">\n            <p><b>Full Labeling:\n              <select \n                name=\"labelings\" \n                id=\"labelings\" \n                onChange={handleLabelChange} \n                value={labeling}  // Set the value prop here\n              >\n                {labelNames.map(l => <option key={l} value={l}>{l}</option>)}\n              </select>\n            </b></p>\n          </label>\n          {/* <h3 className=\"viztitle\"><b>{data[\"name\"]}</b></h3> */}\n          {(type !== 'dualviz' && type !== 'triviz' && type !== 'sumviz') ?\n            <p className=\"titleelem end\"><b>Press [/] for help &nbsp;&nbsp;</b></p> :\n            <></>}\n          {type !== 'sumviz' ?\n            <span onClick={closeTab.bind(null, 1)} style={{ textDecoration: 'none', color: 'black'}}><p className='panelclosebutton'><b>[X]</b></p></span>\n            : <></>}\n        </div>\n        <div className={coord_map === undefined ? \"leftcolumn nolegend\" : \"leftcolumn\"}>\n          <div className={`panel migration top ${(type === 'dualviz' || type === 'triviz') ? 'left' : ''}`}>\n            <p className=\"paneltitle\"><b>Migration Graph</b></p>\n            <p className=\"paneltitle mu\">{`\\u03BC: ${mu}`}</p>\n            <p className=\"paneltitle gamma\">{`\\u03B3: ${gamma}`}</p>\n            <button type=\"button\" className=\"paneltitle button\" onClick={rotateFn}>Rotate</button>\n            <button type=\"button\" className=\"paneltitle button under\" onClick={() => resetFn(1)}>Reset</button>\n            <Migration key={refreshCounter} tree={tree} labeling={tree_labeling} coloring={coloring} migration={migration} evtbus={evtBus} rotated={rotate}/>\n          </div>\n          <div className={`panel migration ${(type === 'dualviz' || type === 'triviz') ? 'left' : ''}`}>\n          <p className=\"paneltitle\">\n              {origExists ? (\n                // If origExists is true, render both Clonal Tree and View Input Tree links\n                <>\n                  <button\n                    style={{ fontWeight: !clonalL ? 'bold' : 'normal' }}\n                    onClick={onToggleOutputClonalL}\n                  >\n                    Clonal Tree\n                  </button>{\" \"}\n                  |{\" \"}\n                  <button\n                    style={{ fontWeight: clonalL ? 'bold' : 'normal' }}\n                    onClick={onToggleInputClonalL}\n                  >\n                    Input Tree\n                  </button>\n                </>\n              ) : (\n                // If origExists is false, render only Clonal Tree (fallback to <b> element)\n                <b>Clonal Tree</b>\n              )}\n            </p>\n            <button type=\"button\" className=\"paneltitle button clonal\" onClick={() => resetClonal(1)}>Reset</button>\n            <ClonalTree \n              key={refreshCounter} \n              tree={!clonalL ? tree : originalTree} \n              labeling={!clonalL ? tree_labeling : originalLabeling} \n              coloring={coloring} \n              evtbus={evtBus} \n              rightcol={type === 'sumviz' || type === 'triviz'} \n              index={1}\n              clonalMap={clonalMap}\n              clonal={clonalL}/>\n          </div>\n        </div>\n      </div>\n      {(type === 'dualviz' || type === 'triviz') ?\n        <div className={`panel info ${type === 'dualviz' ? 'one two' : 'tri three'}`}>\n          <div className=\"titlewrapper\">\n            <label className=\"titleelem left\" htmlFor=\"labelings\">\n              <p><b>Full Labeling:\n                <select \n                  name=\"labelings\" \n                  id=\"labelings\" \n                  onChange={handleLabelChange2}\n                  value={labeling2}  // Set the value prop here\n                >\n                  {labelNames.map(l => <option key={l} value={l}>{l}</option>)}\n                </select>\n              </b></p>\n            </label>\n            {/* <h3 className=\"viztitle\"><b>{data2[\"name\"]}</b></h3> */}\n            <span onClick={closeTab.bind(null, 2)} style={{ textDecoration: 'none', color: 'black' }}><p className='panelclosebutton'><b>[X]</b></p></span>\n          </div>\n          <div className={coord_map === undefined ? \"leftcolumn nolegend\" : \"leftcolumn\"}>\n            <div className={`panel migration top ${(type === 'dualviz' || type === 'triviz') ? 'left' : ''}`}>\n              <p className=\"paneltitle\"><b>Migration Graph</b></p>\n              <p className=\"paneltitle mu\">{`\\u03BC: ${mu2}`}</p>\n              <p className=\"paneltitle gamma\">{`\\u03B3: ${gamma2}`}</p>\n              <button type=\"button\" className=\"paneltitle button\" onClick={rotateFn2}>Rotate</button>\n              <button type=\"button\" className=\"paneltitle button under\" onClick={() => resetFn(2)}>Reset</button>\n              <Migration key={refreshCounter} tree={tree2} labeling={tree_labeling2} coloring={coloring} migration={migration2} evtbus={evtBus} rightcol={true} rotated={rotate2} />\n            </div>\n            <div className={`panel migration ${(type === 'dualviz' || type === 'triviz') ? 'left' : ''}`}>\n              <p className=\"paneltitle\">{origExists ? (\n                // If origExists is true, render both Clonal Tree and View Input Tree links\n                <>\n                  <button\n                    style={{ fontWeight: !clonalR ? 'bold' : 'normal' }}\n                    onClick={onToggleOutputClonalR}\n                  >\n                    Clonal Tree\n                  </button>{\" \"}\n                  |{\" \"}\n                  <button\n                    style={{ fontWeight: clonalR ? 'bold' : 'normal' }}\n                    onClick={onToggleInputClonalR}\n                  >\n                    Input Tree\n                  </button>\n                </>\n              ) : (\n                // If origExists is false, render only Clonal Tree (fallback to <b> element)\n                <b>Clonal Tree</b>\n              )}</p>\n              <button type=\"button\" className=\"paneltitle button clonal\" onClick={() => resetClonal(2)}>Reset</button>\n              <ClonalTree \n                key={refreshCounter} \n                tree={!clonalR ? tree2 : originalTree} \n                labeling={!clonalR ? tree_labeling2 : originalLabeling} \n                coloring={coloring} \n                evtbus={evtBus} \n                rightcol={true} \n                index={2}\n                clonalMap={clonalMap2}\n                clonal={clonalR}/>\n            </div>\n          </div>\n        </div> :\n        <></>}\n      {type !== 'dualviz' && type !== 'triviz' ?\n        <div className=\"panel tab_add\" onClick={addTab}><p className='addpanelp'><b>+</b></p></div>\n        : <></>\n      }\n    </div>\n  )\n}\n\nexport default Viz;","import React from 'react';\nimport {\n    Link\n  } from \"react-router-dom\";\n\nimport URLs from \"../utils/default_url.json\";\nimport download from \"../assets/download.png\";\n\nimport axios from 'axios'\nimport fileDownload from 'js-file-download'\n\nimport DefaultDict from \"../utils/DefaultDict.js\";\n\n// Import the patient sample datasets\nimport A7 from \"../samples/A7/A7.json\";\nimport A10 from \"../samples/A10/A10.json\";\nimport A22 from \"../samples/A22/A22.json\";\nimport A29 from \"../samples/A29/A29.json\";\nimport A31 from \"../samples/A31/A31.json\";\nimport A32 from \"../samples/A32/A32.json\";\nimport patient1_LOv from \"../samples/patient1_LOv/patient1_LOv.json\";\nimport patient1_ROv from \"../samples/patient1_ROv/patient1_ROv.json\";\nimport patient2 from \"../samples/patient2/patient2.json\";\nimport patient3_LOv from \"../samples/patient3_LOv/patient3_LOv.json\";\nimport patient3_ROv from \"../samples/patient3_ROv/patient3_ROv.json\";\nimport patient4_LOv from \"../samples/patient4_LOv/patient4_LOv.json\";\nimport patient4_ROv from \"../samples/patient4_ROv/patient4_ROv.json\";\nimport patient7_LOv from \"../samples/patient7_LOv/patient7_LOv.json\";\nimport patient7_ROv from \"../samples/patient7_ROv/patient7_ROv.json\";\nimport patient9_LOv from \"../samples/patient9_LOv/patient9_LOv.json\";\nimport patient9_ROv from \"../samples/patient9_ROv/patient9_ROv.json\";\nimport patient10 from \"../samples/patient10/patient10.json\";\nimport tracerx from \"../samples/tracerx/tracerx.json\";\n\n/** The home page for the visualizer\n * \n * @returns JSX/HTML\n */\nfunction Home() {\n    /** Download the json dataset when the icon is clicked\n     * \n     * @param {*} url (string) The url to download from \n     * @param {*} filename (string) The filename to alias as\n     */\n    let handleDownload = (url, filename) => {\n      axios.get(url, {\n        responseType: 'blob',\n      })\n      .then((res) => {\n        fileDownload(res.data, filename)\n      })\n    }\n\n    // Dictionary mapping dataset name to json object\n    var json_dict = {\n      \"A7\": A7,\n      \"A10\": A10,\n      \"A22\": A22,\n      \"A29\": A29,\n      \"A31\": A31,\n      \"A32\": A32,\n      \"patient1_LOv\": patient1_LOv,\n      \"patient1_ROv\": patient1_ROv,\n      \"patient2\": patient2,\n      \"patient3_LOv\": patient3_LOv,\n      \"patient3_ROv\": patient3_ROv,\n      \"patient4_LOv\": patient4_LOv,\n      \"patient4_ROv\": patient4_ROv,\n      \"patient7_LOv\": patient7_LOv,\n      \"patient7_ROv\": patient7_ROv,\n      \"patient9_LOv\": patient9_LOv,\n      \"patient9_ROv\": patient9_ROv,\n      \"patient10\": patient10,\n      \"tracerx\": tracerx,\n    }\n\n    // Table values\n    var default_patients = [\"A7\", \"A10\", \"A22\", \"A29\", \"A31\", \"A32\", \"patient1_LOv\", \"patient1_ROv\", \"patient2\", \"patient3_LOv\", \"patient3_ROv\", \"patient4_LOv\", \"patient4_ROv\", \"patient7_LOv\", \"patient7_ROv\", \"patient9_LOv\", \"patient9_ROv\", \"patient10\", \"tracerx\"]\n    var default_dirs = [\"hoadley_2016\", \"gundem_2015\", \"gundem_2015\", \"gundem_2015\", \"gundem_2015\", \"gundem_2015\", \"mcpherson_2016\", \"mcpherson_2016\", \"mcpherson_2016\", \"mcpherson_2016\", \"mcpherson_2016\", \"mcpherson_2016\", \"mcpherson_2016\", \"mcpherson_2016\", \"mcpherson_2016\", \"mcpherson_2016\", \"mcpherson_2016\", \"mcpherson_2016\", \"tracerx\"]\n    var div_elements = []\n    var which_color = true;\n    const color1 = \"#EBEBEB\";\n    const color2 = \"#A3A3A3\";\n\n    // TODO: Perhaps remove this since we're using a different filtration scheme\n    sessionStorage.setItem(\"selected\", JSON.stringify(new DefaultDict(0)));\n    sessionStorage.setItem(\"violations\", JSON.stringify(new DefaultDict(0)));\n    \n    // Construct div elements representing the table entries\n    for (let i = 0; i < default_patients.length; i++) {\n        var current_patient = default_patients[i];\n        var current_directory = default_dirs[i];\n        var current_color = (which_color ? color1 : color2)\n\n        var link = URLs[current_patient];\n\n        div_elements.push(\n          <Link to={link} className=\"patient-link\" onClick={() => {sessionStorage.setItem(\"json_data\", JSON.stringify(json_dict[default_patients[i]]))}}>\n            <div className=\"patient-container\">\n              <div className=\"patientitem\" style={{ backgroundColor: current_color }}>\n                  <p><b>{current_directory}</b></p>\n              </div>\n              <div className=\"patientitem2\" style={{ backgroundColor: current_color}}>\n                  <p className='leftli'><b>{current_patient}</b></p>\n                <img \n                  className='rightli' \n                  src={download}\n                  alt=\"download\"\n                  onClick={() => handleDownload(`https://raw.githubusercontent.com/vikramr2/machina-viz/main/src/samples/${default_patients[i]}/${default_patients[i]}.json`, `${default_patients[i]}.json`)}\n                >\n                </img>\n              </div>\n            </div>\n          </Link>\n\n        )\n        which_color = !which_color;\n    }\n\n    /** TODO: Maybe change the name of this funciton?\n     * But this handles the file upload\n     * \n     * @param {*} e (obj) Event metadata\n     */\n    let handleChange = (e) => {\n      // Get the filename from the metadata\n      const reader = new FileReader();\n      const file = e.target.files[0];\n      let json_contents;\n  \n      reader.onload = function(readerEvt) {\n        // Load the json data from the file\n        let jsonString = readerEvt.target.result;\n        json_contents = jsonString;\n        const data = JSON.parse(json_contents);\n\n        // Fetch the first label to default to on viz\n        let labelnames = data[\"solutions\"].map((value, index) => {return value[\"name\"]});\n\n        // Store the data in session storage so that the viz route can pull the data\n        sessionStorage.setItem(\"json_data\", json_contents);\n  \n        // Update the window location to the viz route\n        window.location = window.location + `viz?labeling=${labelnames[0]}`;\n      }\n      // Read the file as a text\n      reader.readAsText(file);\n      \n    }\n\n    return (\n        <div className='home'>\n            <div className='home-panel'>\n                <div className='home-column-1'>\n                  <h1><b>Welcome to MACH2!</b></h1>\n                  {/* <div className=\"aboutdir\"><Link to=\"about\" style={{ textDecoration: 'none', color: 'black'}}><h4 className='abouttext'>About</h4></Link></div> */}\n                  <div className=\"about-text\">\n                    <p><b>A lightweight visualizer for MACH2, <a href=\"https://www.nature.com/articles/s41588-018-0106-z\">MACHINA's</a> sequel.</b> Use this visualizer to examine a solution space for the parsimonious migration history problem and its respective summary for a given patient. Examples are provided below. You can also upload a JSON file to view a custom input. See the Instructions page for how to use this website:</p> \n                  </div>\n                  \n                    <Link to=\"about\" style={{ textDecoration: 'none', color: 'black'}}>\n                      <button className=\"about-button\">Instructions</button>\n                    </Link>\n\n                </div>\n\n                {/* <div className=\"line\"></div> */}\n\n                <div className=\"home-column-2\">\n                  <div className='patient-list-title-container'>\n                    <h3>Examples</h3>\n                    <div className=\"patient-container\">\n                        <div className=\"patientitem\" style={{ backgroundColor: \"#717171\" }}>\n                            <p className='datasettitle' style={{color: \"black\"}}><b>Dataset</b></p>\n                        </div>\n                        <div className=\"patientitem\" style={{ backgroundColor: \"#717171\" }}>\n                          <Link to={link} style={{ textDecoration: 'none', color: 'black'}}>\n                            <p className='datasettitle' style={{color: \"black\"}}><b>Patient</b></p>\n                          </Link>\n                        </div>\n                      </div>\n                  </div>\n                  <div className=\"patient-list-container\">\n\n                    {/* { \n                      div_elements.map(elem => (\n                        elem\n                      ))\n                    } */}\n\n                    { \n                      div_elements.map((elem, index) => (\n                        <React.Fragment key={index}>\n                          {elem}\n                        </React.Fragment>\n                      ))\n                    }\n                  </div>\n                </div>\n\n            </div>\n            <div>\n              <input \n                type=\"file\"\n                id=\"json_upload\" \n                name=\"json_upload\"\n                accept=\"application/JSON\"\n                onChange={handleChange}/>\n              <label htmlFor=\"json_upload\">\n                <div id=\"addnew\" className=\"dot\">\n                  <h1 className=\"plus\">+</h1>\n                  <span className=\"tooltiptext\"><b>Upload Patient JSON</b></span>\n                </div>\n                {/* <div id=\"addnew\">\n                  <img  src={upload_icon}></img>\n                  <span class=\"tooltiptext\"><b>Upload Patient JSON</b></span>\n                </div> */}\n              </label>\n            </div>\n        </div>\n    );\n}\n\nexport default Home;","import React from \"react\"\nimport './App.css';\n\nimport About from './components/About.js'\nimport Viz from './components/Viz.js'\nimport Home from './components/Home.js'\n\nimport {\n  Switch,\n  Route\n} from \"react-router-dom\";\n\nimport { createBrowserHistory } from 'history';\n\n\nfunction App() {\n  createBrowserHistory({\n    basename: '/mach2-viz/#' // Replace with your repository name\n  });\n\n  return (\n    <div className=\"App\">\n        <Switch>\n          <Route path=\"/about\">\n            <About/>\n          </Route>\n          <Route path=\"/viz\">\n            <Viz/>\n          </Route>\n          <Route path=\"/mach2-viz/about\">\n            <About/>\n          </Route>\n          <Route path=\"/mach2-viz/viz\">\n            <Viz/>\n          </Route>\n          <Route path=\"/mach2-viz\">\n            <Home/>\n          </Route>\n          <Route exact path=\"/\">\n            <Home/>\n          </Route>\n        </Switch>\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nimport { HashRouter as Router } from \"react-router-dom\";\n\nconst root = ReactDOM.createRoot(document.getElementById('root'));\nroot.render(\n  <React.StrictMode>\n    <Router basename=\"/mach2-viz\">\n      <App />\n    </Router>\n  </React.StrictMode>\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}